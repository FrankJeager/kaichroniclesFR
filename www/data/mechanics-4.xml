<?xml version="1.0" encoding="utf-8"?>

<mechanics book="4">

    <!-- LIST OF TRANSLATED IMAGES -->
    <translated-images>
        <image>map.png</image>
        <image>weapons.png</image>
        <image>ill16.png</image>
    </translated-images>

    <!-- GAME RULES -->
    <sections>

        <section id="tssf">
            <!-- No more Barnak oil on your skin! -->
            <drop objectId="baknaroil" />
            <!-- Hunting was not enabled on book 3 -->
            <huntStatus enabled="true" />
            <!-- Restore the endurace to the maximum -->
            <endurance count="+[MAXENDURANCE]" />
            <!-- Drop the previous books map -->
            <drop objectId="map" />
        </section>

        <section id="gamerulz">
            <!-- Select the player skills (weapons skill and endurance) UI -->
            <setSkills />
        </section>

        <section id="discplnz">
            <!-- Select the Kai disciplines UI -->
            <setDisciplines />
        </section>

        <section id="equipmnt">
            <!-- Do not pick 2 maps! -->
            <test not="true" hasObject="map" >
                <pick objectId="map" />
            </test>

            <randomTable>
                <pick class="money" count="[RANDOM] + 10" />
            </randomTable>

            <object objectId="warhammer" />
            <object objectId="dagger" />
            <object objectId="laumspurpotion4" index="0" />
            <object objectId="laumspurpotion4" index="1" />
            <object objectId="sword" />
            <object objectId="spear" />
            <object objectId="meal" index="0" />
            <object objectId="meal" index="1" />
            <object objectId="meal" index="2" />
            <object objectId="meal" index="3" />
            <object objectId="meal" index="4" />
            <object objectId="mace" />
            <object objectId="chainmail" />
            <object objectId="shield" />

            <chooseEquipment en-text="Pick the money and choose up to six objects before continue" />
        </section>

        <section id="sect2">
            <object objectId="sword" />
            <object objectId="mace" />
            <object objectId="dagger" />
            <object objectId="warhammer" />
            <pick class="money" count="12" />
            <object objectId="backpack" />
            <object objectId="meal" index="0" />
            <object objectId="meal" index="1" />
        </section>

        <section id="sect3">
            <endurance count="-1" />
        </section>

        <section id="sect10">
            <object objectId="onyxmedallion" />
        </section>

        <section id="sect11">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case from="0" to="4">
                    <choiceState section="sect97" set="enabled" />
                </case>
                <case from="5" to="9">
                    <choiceState section="sect190" set="enabled" />
                </case>
            </randomTable>
        </section>

        <section id="sect12">
            <!-- English footnote about the backpack -->
            <pick objectId="backpack" />

            <object objectId="meal" index="0" />
            <object objectId="meal" index="1" />
            <object objectId="meal" index="2" />
            <object objectId="rope" />
            <object objectId="laumspurpotion4" />
            <object objectId="sword" />
            <object objectId="spear" />
        </section>

        <section id="sect13">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case from="0" to="4">
                    <choiceState section="sect171" set="enabled" />
                </case>
                <case from="5" to="9">
                    <choiceState section="sect25" set="enabled" />
                </case>
            </randomTable>
        </section>

        <section id="sect14">
            <choiceState section="all" set="disabled" />
            <combat eludeTurn="0" />
            <afterCombats>
                <choiceState section="sect146" set="enabled" />
            </afterCombats>
            <afterElude>
                <choiceState section="sect31" set="enabled" />
            </afterElude>
        </section>

        <section id="sect15">
            <test not="true" hasDiscipline="tracking">
                <choiceState section="sect264" set="disabled" />
            </test>
            <test hasDiscipline="tracking">
                <choiceState section="sect134" set="disabled" />
            </test>
        </section>

        <section id="sect17">
            <death />
        </section>

        <section id="sect19">
            <meal />
        </section>

        <section id="sect21">
            <test not="true" hasDiscipline="tracking">
                <choiceState section="sect264" set="disabled" />
            </test>
        </section>

        <section id="sect22">
            <!-- I dont want to force any rule here... What if the player has no 
                 other backpack / weapon? -->
            <message en-text="Drop some object before continue" />
        </section>

        <section id="sect23">
            <test not="true" hasObject="brasskey">
                <choiceState section="sect282" set="disabled" />
            </test>
            <test hasObject="brasskey">
                <choiceState section="sect105" set="disabled" />
            </test>
        </section>

        <section id="sect24">
            <test not="true" hasDiscipline="healing">
                <choiceState section="sect238" set="disabled" />
            </test>
        </section>

        <section id="sect25">
            <huntStatus enabled="false" />
        </section>

        <section id="sect26">
            <choiceState section="all" set="disabled" />
            <combat noMindblast="true" />
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect29">
            <test not="true" hasObject="firesphere">
                <choiceState section="sect168" set="disabled" />
            </test>
        </section>

        <section id="sect31">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case from="0" to="4">
                    <choiceState section="sect272" set="enabled" />
                </case>
                <case from="5" to="9">
                    <choiceState section="sect329" set="enabled" />
                </case>
            </randomTable>
        </section>

        <section id="sect35">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case from="0" to="7">
                    <choiceState section="sect147" set="enabled" />
                </case>
                <case from="8" to="12">
                    <choiceState section="sect231" set="enabled" />
                </case>
            </randomTable>
            <test hasDiscipline="hunting" expression="[KAILEVEL] >= 7">
                <randomTableIncrement increment="+3" />
            </test>
        </section>

        <section id="sect36">
            <choiceState section="all" set="disabled" />
            <afterCombats>
                <test not="true" expression="[COMBATSDURATION] >= 4">
                    <choiceState section="sect155" set="enabled" />
                </test>
                <test expression="[COMBATSDURATION] >= 4">
                    <choiceState section="sect277" set="enabled" />
                </test>
            </afterCombats>
        </section>

        <section id="sect40">
            <test not="true" hasDiscipline="tracking" >
                <choiceState section="sect349" set="disabled" />
            </test>
            <test not="true" expression="[KAILEVEL] >= 6" >
                <choiceState section="sect349" set="disabled" />
            </test>
        </section>

        <section id="sect42">
            <death />
        </section>

        <section id="sect43">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case from="0" to="6">
                    <choiceState section="sect262" set="enabled" />
                </case>
                <case from="7" to="99">
                    <choiceState section="sect111" set="enabled" />
                </case>
            </randomTable>
            <test hasDiscipline="mindomtr|wepnskll">
                <randomTableIncrement increment="+1" />
            </test>
            <test hasDiscipline="hunting|sixthsns">
                <randomTableIncrement increment="+2" />
            </test>
        </section>

        <section id="sect44">
            <pick class="money" count="12" />
            <object objectId="meal" index="0" />
            <object objectId="meal" index="1" />

            <test not="true" hasDiscipline="healing">
                <choiceState section="sect149" set="disabled" />
            </test>
            <test hasDiscipline="healing">
                <choiceState section="sect188" set="disabled" />
            </test>
        </section>

        <section id="sect46">
            <choiceState section="all" set="disabled" />
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect47">
            <choiceState section="all" set="disabled" />
            <afterCombats>
                <test expression="[COMBATSDURATION] > 5">
                    <choiceState section="sect340" set="enabled" />
                </test>
                <test not="true" expression="[COMBATSDURATION] > 5">
                    <choiceState section="sect32" set="enabled" />
                </test>
            </afterCombats>
        </section>
        
        <section id="sect50">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case from="0" to="6">
                    <choiceState section="sect184" set="enabled" />
                </case>
                <case from="7" to="9">
                    <choiceState section="sect267" set="enabled" />
                </case>
            </randomTable>
        </section>

        <section id="sect51">
            <test not="true" hasDiscipline="anmlknsp">
                <choiceState section="sect227" set="disabled" />
            </test>
        </section>

        <section id="sect52">
            <endurance count="-1" />
        </section>

        <section id="sect53">
            <choiceState section="all" set="disabled" />
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>


        <!-- UP TO sect53 -->

    </sections>

</mechanics>