<?xml version="1.0" encoding="utf-8"?>

<mechanics book="4" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="https://raw.githubusercontent.com/cracrayol/kaichronicles/master/www/data/mechanics.xsd">

    <!-- GAME RULES -->
    <sections>

        <section id="tssf">
            <!-- No more Barnak oil on your skin! -->
            <drop objectId="baknaroil" />
            <!-- Hunting was not enabled on book 3 -->
            <huntStatus enabled="true" />
            <!-- Restore the endurance to the maximum -->
            <endurance count="+[MAXENDURANCE]" />
            <!-- Drop the previous books map -->
            <drop objectId="map" />
        </section>

        <section id="gamerulz">
            <!-- Select the player skills (weapons skill and endurance) UI -->
            <setSkills />
        </section>

        <section id="discplnz">
            <!-- Select the Kai disciplines UI -->
            <setDisciplines />
        </section>

        <section id="equipmnt" pickMaximum="6">
            <!-- Do not pick 2 maps! -->
            <test not="true" hasObject="map">
                <pick objectId="map" />
            </test>
            <test not="true" hasObject="backpack">
                <pick objectId="backpack" />
            </test>

            <randomTable>
                <pick class="money" count="[RANDOM] + 10" />
            </randomTable>

            <object objectId="warhammer" />
            <object objectId="dagger" />
            <object objectId="laumspurpotion4" index="0" />
            <object objectId="laumspurpotion4" index="1" />
            <object objectId="sword" />
            <object objectId="spear" />
            <object objectId="meal" index="0" />
            <object objectId="meal" index="1" />
            <object objectId="meal" index="2" />
            <object objectId="meal" index="3" />
            <object objectId="meal" index="4" />
            <object objectId="mace" />
            <object objectId="chainmail" />
            <object objectId="shield" />

            <chooseEquipment text="Click on the Random Table link to get money before continuing" />

            <message text="You may take up to six of the following (all meals count as one object):" />
        </section>

        <section id="sect2">
            <object objectId="sword" />
            <object objectId="mace" />
            <object objectId="dagger" />
            <object objectId="warhammer" />
            <pick class="money" count="12" />
            <object objectId="backpack" />
            <object objectId="meal" index="0" />
            <object objectId="meal" index="1" />
        </section>

        <section id="sect3">
            <endurance count="-1" />
        </section>

        <section id="sect10">
            <object objectId="onyxmedallion" />
        </section>

        <section id="sect11">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case from="0" to="4">
                    <choiceState section="sect97" set="enabled" />
                </case>
                <case from="5" to="9">
                    <choiceState section="sect190" set="enabled" />
                </case>
            </randomTable>
        </section>

        <section id="sect12">
            <!-- English footnote about the backpack -->
            <pick objectId="backpack" />

            <object objectId="meal" index="0" />
            <object objectId="meal" index="1" />
            <object objectId="meal" index="2" />
            <object objectId="rope" />
            <object objectId="laumspurpotion4" />
            <object objectId="sword" />
            <object objectId="spear" />
        </section>

        <section id="sect13">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case from="0" to="4">
                    <choiceState section="sect171" set="enabled" />
                </case>
                <case from="5" to="9">
                    <choiceState section="sect25" set="enabled" />
                </case>
            </randomTable>
        </section>

        <section id="sect14">
            <choiceState section="all" set="disabled" />
            <combat eludeTurn="0" />
            <afterCombats>
                <choiceState section="sect146" set="enabled" />
            </afterCombats>
            <afterElude>
                <choiceState section="sect31" set="enabled" />
            </afterElude>
        </section>

        <section id="sect15">
            <test not="true" hasDiscipline="tracking">
                <choiceState section="sect264" set="disabled" />
            </test>
            <test hasDiscipline="tracking">
                <choiceState section="sect134" set="disabled" />
            </test>
        </section>

        <section id="sect17">
            <death />
        </section>

        <section id="sect19">
            <meal />
        </section>

        <section id="sect21">
            <choiceState section="sect264" set="disabled" />
            <test hasDiscipline="tracking">
                <choiceState section="sect264" set="enabled" />
                <choiceState section="sect134" set="disabled" />
                <choiceState section="sect191" set="disabled" />
            </test>
        </section>

        <section id="sect22">
            <!-- TODO: Unsupported -->
            <!-- I dont want to force any rule here... What if the player has no 
                 other backpack / weapon? -->
            <message text="Drop some object before continuing" />
        </section>

        <section id="sect23">
            <test not="true" hasObject="brasskey">
                <choiceState section="sect282" set="disabled" />
            </test>
            <test hasObject="brasskey">
                <choiceState section="sect105" set="disabled" />
            </test>
        </section>

        <section id="sect24">
            <test not="true" hasDiscipline="healing">
                <choiceState section="sect238" set="disabled" />
            </test>
        </section>

        <section id="sect25">
            <huntStatus enabled="false" />
        </section>

        <section id="sect26">
            <choiceState section="all" set="disabled" />
            <combat noMindblast="true" />
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect29">
            <choiceState section="sect168" set="disabled" />
            <test hasObject="firesphere">
                <choiceState section="sect168" set="enabled" />
                <choiceState section="sect246" set="disabled" />
                <choiceState section="sect183" set="disabled" />
            </test>
        </section>

        <section id="sect31">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case from="0" to="4">
                    <choiceState section="sect272" set="enabled" />
                </case>
                <case from="5" to="9">
                    <choiceState section="sect329" set="enabled" />
                </case>
            </randomTable>
        </section>

        <section id="sect35">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case from="0" to="7">
                    <choiceState section="sect147" set="enabled" />
                </case>
                <case from="8" to="12">
                    <choiceState section="sect231" set="enabled" />
                </case>
            </randomTable>
            <test hasDiscipline="hunting" expression="[KAILEVEL] >= 7">
                <randomTableIncrement increment="+3" />
            </test>
        </section>

        <section id="sect36">
            <choiceState section="all" set="disabled" />
            <afterCombats>
                <test not="true" expression="[COMBATSDURATION] >= 4">
                    <choiceState section="sect155" set="enabled" />
                </test>
                <test expression="[COMBATSDURATION] >= 4">
                    <choiceState section="sect277" set="enabled" />
                </test>
            </afterCombats>
        </section>

        <section id="sect40">
            <choiceState section="sect349" set="disabled" />
            <test hasDiscipline="tracking">
                <test expression="[KAILEVEL] >= 6">
                    <choiceState section="sect349" set="enabled" />
                    <choiceState section="sect55" set="disabled" />
                    <choiceState section="sect291" set="disabled" />
                </test>
            </test>
        </section>

        <section id="sect42">
            <death />
        </section>

        <section id="sect43">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case from="0" to="6">
                    <choiceState section="sect262" set="enabled" />
                </case>
                <case from="7" to="99">
                    <choiceState section="sect111" set="enabled" />
                </case>
            </randomTable>
            <test hasDiscipline="mindomtr|wepnskll">
                <randomTableIncrement increment="+1" />
            </test>
            <test hasDiscipline="hunting|sixthsns">
                <randomTableIncrement increment="+2" />
            </test>
        </section>

        <section id="sect44">
            <pick class="money" count="12" />
            <object objectId="meal" index="0" />
            <object objectId="meal" index="1" />

            <test not="true" hasDiscipline="healing">
                <choiceState section="sect149" set="disabled" />
            </test>
            <test hasDiscipline="healing">
                <choiceState section="sect188" set="disabled" />
            </test>
        </section>

        <section id="sect46">
            <choiceState section="all" set="disabled" />
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect47">
            <choiceState section="all" set="disabled" />
            <afterCombats>
                <test expression="[COMBATSDURATION] > 5">
                    <choiceState section="sect340" set="enabled" />
                </test>
                <test not="true" expression="[COMBATSDURATION] > 5">
                    <choiceState section="sect32" set="enabled" />
                </test>
            </afterCombats>
        </section>

        <section id="sect50">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case from="0" to="6">
                    <choiceState section="sect184" set="enabled" />
                </case>
                <case from="7" to="9">
                    <choiceState section="sect267" set="enabled" />
                </case>
            </randomTable>
        </section>

        <section id="sect51">
            <choiceState section="sect227" set="disabled" />
            <test hasDiscipline="anmlknsp">
                <choiceState section="sect227" set="enabled" />
                <choiceState section="sect328" set="disabled" />
                <choiceState section="sect120" set="disabled" />
            </test>
        </section>

        <section id="sect52">
            <endurance count="-1" />
        </section>

        <section id="sect53">
            <choiceState section="all" set="disabled" />
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect54">
            <choiceState section="sect4" set="disabled" />
            <test hasDiscipline="tracking">
                <test expression="[KAILEVEL] >= 6">
                    <choiceState section="sect4" set="enabled" />
                    <choiceState section="sect65" set="disabled" />
                    <choiceState section="sect201" set="disabled" />
                </test>
            </test>
        </section>

        <section id="sect56">
            <choiceState section="all" set="disabled" />
            <afterCombats>
                <test not="true" expression="[COMBATSDURATION] >= 4">
                    <choiceState section="sect69" set="enabled" />
                </test>
                <test expression="[COMBATSDURATION] >= 4">
                    <choiceState section="sect203" set="enabled" />
                </test>
            </afterCombats>
        </section>

        <section id="sect57">
            <test not="true" hasObject="captaindvalsword">
                <choiceState section="sect327" set="disabled" />
            </test>
            <test hasObject="captaindvalsword">
                <choiceState section="sect289" set="disabled" />
            </test>
        </section>

        <section id="sect59">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case from="0" to="4">
                    <choiceState section="sect193" set="enabled" />
                </case>
                <case from="5" to="9">
                    <choiceState section="sect260" set="enabled" />
                </case>
            </randomTable>
        </section>

        <section id="sect62">
            <choiceState section="all" set="disabled" />
            <combat combatSkillModifier="-2" />
            <afterCombatTurn turn="3">
                <combat combatSkillModifier="0" />
            </afterCombatTurn>
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect63">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case from="0" to="4">
                    <choiceState section="sect259" set="enabled" />
                </case>
                <case from="5" to="9">
                    <choiceState section="sect95" set="enabled" />
                </case>
            </randomTable>
        </section>

        <section id="sect65">
            <choiceState section="all" set="disabled" />
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect67">
            <endurance count="-1" />
            <choiceState section="all" set="disabled" />
            <test hasObject="sommerswerd">
                <choiceState section="sect292" set="enabled" />
            </test>
            <test not="true" hasObject="sommerswerd">
                <randomTable>
                    <case from="0" to="4">
                        <choiceState section="sect242" set="enabled" />
                    </case>
                    <case from="5" to="8">
                        <choiceState section="sect263" set="enabled" />
                    </case>
                    <case from="9" to="11">
                        <choiceState section="sect278" set="enabled" />
                    </case>
                </randomTable>
                <test hasDiscipline="hunting|mindomtr">
                    <randomTableIncrement increment="+2" />
                </test>
            </test>
        </section>

        <section id="sect70">
            <choiceState section="all" set="disabled" />

            <test hasObject="onyxmedallion">
                <choiceState section="sect305" set="enabled" />
            </test>

            <test not="true" hasObject="onyxmedallion">
                <choiceState section="sect159" set="enabled" />
                <test hasDiscipline="camflage">
                    <test expression="[KAILEVEL] >= 7">
                        <choiceState section="sect159" set="disabled" />
                        <choiceState section="sect49" set="enabled" />
                    </test>
                </test>
            </test>
        </section>

        <section id="sect73">
            <test not="true" hasObject="flaskofholywater">
                <choiceState section="sect283" set="disabled" />
            </test>
            <test hasObject="flaskofholywater">
                <choiceState section="sect325" set="disabled" />
            </test>
        </section>

        <section id="sect74">
            <endurance count="+1" />
        </section>

        <section id="sect75">
            <endurance count="-2" />
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case from="0" to="5">
                    <choiceState section="sect192" set="enabled" />
                </case>
                <case from="6" to="12">
                    <choiceState section="sect16" set="enabled" />
                </case>
            </randomTable>
            <test hasDiscipline="camflage">
                <randomTableIncrement increment="+3" />
            </test>
        </section>

        <section id="sect77">
            <combat noMindblast="true" mindforceEP="-1" eludeTurn="2" />
            <choiceState section="all" set="disabled" />
            <afterCombats>
                <choiceState section="sect10" set="enabled" />
            </afterCombats>
            <afterElude>
                <choiceState section="sect98" set="enabled" />
            </afterElude>
        </section>

        <section id="sect78">
            <object objectId="flaskofholywater" />
            <meal />
        </section>

        <section id="sect79">
            <object objectId="torch" index="0" />
            <object objectId="torch" index="1" />
            <object objectId="torch" index="2" />
            <object objectId="torch" index="3" />
            <object objectId="torch" index="4" />
            <object objectId="tinderbox" />
        </section>

        <section id="sect84">
            <pick objectId="scrollpoetry" />
        </section>

        <section id="sect85">
            <death />
        </section>

        <section id="sect87">
            <choiceState section="sect60" set="disabled" />
            <test hasDiscipline="sixthsns|tracking">
                <choiceState section="sect60" set="enabled" />
                <choiceState section="sect199" set="disabled" />
                <choiceState section="sect208" set="disabled" />
            </test>
        </section>

        <section id="sect88">
            <combat noMindblast="true" />
            <choiceState section="all" set="disabled" />
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect89">
            <choiceState section="all" set="disabled" />
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect90">
            <choiceState section="all" set="disabled" />
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect92">
            <choiceState section="sect210" set="disabled" />
            <test hasDiscipline="sixthsns">
                <choiceState section="sect210" set="enabled" />
                <choiceState section="sect132" set="disabled" />
                <choiceState section="sect301" set="disabled" />
            </test>
        </section>

        <section id="sect93">
            <choiceState section="all" set="disabled" />
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect94">
            <drop objectId="backpack" />
        </section>

        <section id="sect96">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case from="0" to="4">
                    <choiceState section="sect47" set="enabled" />
                </case>
                <case from="5" to="8">
                    <choiceState section="sect234" set="enabled" />
                </case>
                <case value="9">
                    <choiceState section="sect334" set="enabled" />
                </case>
            </randomTable>
        </section>

        <section id="sect99">
            <death />
        </section>

        <section id="sect102">
            <pick class="money" count="12" />
            <object objectId="meal" index="0" />
            <object objectId="meal" index="1" />
            <test not="true" hasDiscipline="healing">
                <choiceState section="sect19" set="disabled" />
            </test>
            <test hasDiscipline="healing">
                <choiceState section="sect339" set="disabled" />
            </test>
        </section>

        <section id="sect103">
            <endurance count="-4" />
        </section>

        <section id="sect108">
            <choiceState section="all" set="disabled" />
            <combat eludeTurn="0" />
            <afterCombats>
                <choiceState section="sect28" set="enabled" />
            </afterCombats>
            <afterElude>
                <choiceState section="sect271" set="enabled" />
            </afterElude>
        </section>

        <section id="sect109">
            <pick class="money" count="3" />
            <object objectId="dagger" />
            <object objectId="sword" />
        </section>

        <section id="sect112">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case from="-3" to="4">
                    <choiceState section="sect42" set="enabled" />
                </case>
                <case from="5" to="12">
                    <choiceState section="sect303" set="enabled" />
                </case>
            </randomTable>
            <test expression="[ENDURANCE] &lt; 10">
                <randomTableIncrement increment="-3" />
            </test>
            <test expression="[ENDURANCE] > 20">
                <randomTableIncrement increment="+3" />
            </test>
        </section>

        <section id="sect113">
            <choiceState section="sect166" set="disabled" />
            <test expression="[KAILEVEL] >= 8">
                <choiceState section="sect166" set="enabled" />
                <choiceState section="sect14" set="disabled" />
                <choiceState section="sect316" set="disabled" />
                <choiceState section="sect232" set="disabled" />
            </test>
        </section>

        <section id="sect114">
            <choiceState section="all" set="disabled" />
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect117">
            <choiceState section="all" set="disabled" />
            <test hasObject="firesphere">
                <choiceState section="sect22" set="enabled" />
            </test>
            <test hasObject="tinderbox">
                <test hasObject="torch">
                    <choiceState section="sect22" set="enabled" />
                </test>
            </test>

            <test not="true" isChoiceEnabled="sect22">
                <randomTable>
                    <case from="0" to="6">
                        <choiceState section="sect99" set="enabled" />
                    </case>
                    <case from="7" to="12">
                        <choiceState section="sect256" set="enabled" />
                    </case>
                </randomTable>
                <test hasDiscipline="sixthsns|tracking">
                    <randomTableIncrement increment="+3" />
                </test>
            </test>
        </section>

        <section id="sect118">
            <object objectId="whip" />
            <test not="true" hasObject="ironkey">
                <choiceState section="sect308" set="disabled" />
            </test>
        </section>

        <section id="sect120">
            <huntStatus enabled="true" />
        </section>

        <section id="sect122">
            <endurance count="-1" />
            <choiceState section="all" set="disabled" />
            <combat noMindblast="true" mindforceCS="-4" />
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect123">
            <object objectId="torch" index="0" />
            <object objectId="torch" index="1" />
            <object objectId="torch" index="2" />
            <object objectId="torch" index="3" />
            <object objectId="torch" index="4" />
            <object objectId="torch" index="5" />
            <object objectId="tinderbox" />
        </section>

        <section id="sect125">
            <choiceState section="all" set="disabled" />
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect126">
            <meal />
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case from="0" to="4">
                    <choiceState section="sect25" set="enabled" />
                </case>
                <case from="5" to="9">
                    <choiceState section="sect171" set="enabled" />
                </case>
            </randomTable>
        </section>

        <section id="sect128">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case from="0" to="4">
                    <choiceState section="sect103" set="enabled" />
                </case>
                <case from="5" to="12">
                    <choiceState section="sect98" set="enabled" />
                </case>
            </randomTable>
            <test hasDiscipline="hunting">
                <randomTableIncrement increment="+3" />
            </test>
        </section>

        <section id="sect129">
            <meal huntDisabled="true" />
        </section>

        <section id="sect133">
            <choiceState section="all" set="disabled" />
            <combat eludeTurn="0" />
            <afterCombatTurn turn="any">
                <test expression="[COMBATSENDURANCELOST] > 0">
                    <disableCombats />
                    <choiceState section="sect17" set="enabled" />
                </test>
            </afterCombatTurn>
            <afterCombats>
                <test expression="[COMBATSENDURANCELOST] == 0">
                    <choiceState section="sect265" set="enabled" />
                </test>
            </afterCombats>
            <afterElude>
                <test expression="[COMBATSENDURANCELOST] == 0">
                    <choiceState section="sect307" set="enabled" />
                </test>
            </afterElude>
        </section>

        <section id="sect136">
            <test not="true" hasDiscipline="healing">
                <choiceState section="sect313" set="disabled" />
            </test>
            <test hasDiscipline="healing">
                <choiceState section="sect216" set="disabled" />
            </test>
        </section>

        <section id="sect137">
            <endurance count="+6" />
        </section>

        <section id="sect138">
            <choiceState section="all" set="disabled" />
            <combat eludeTurn="0" />
            <afterCombats>
                <choiceState section="sect152" set="enabled" />
            </afterCombats>
            <afterElude>
                <choiceState section="sect81" set="enabled" />
            </afterElude>
        </section>

        <section id="sect139">
            <meal />
        </section>

        <section id="sect141">
            <meal />
        </section>

        <section id="sect142">
            <tag id="maakentemple" />
        </section>

        <section id="sect143">
            <choiceState section="all" set="disabled" />
            <combat eludeTurn="0" index="1" />
            <afterCombats>
                <choiceState section="sect230" set="enabled" />
            </afterCombats>
            <afterElude>
                <choiceState section="sect87" set="enabled" />
            </afterElude>
        </section>

        <section id="sect144">
            <death />
        </section>

        <section id="sect147">
            <choiceState section="all" set="disabled" />
            <combat enemyMultiplier="0" />
            <afterCombatTurn turn="1">
                <combat enemyMultiplier="1" />
            </afterCombatTurn>
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect152">
            <object objectId="sword" />
            <pick class="money" count="6" />
            <object objectId="meal" index="0" />
            <object objectId="meal" index="1" />
            <object objectId="brasskey" />
        </section>

        <section id="sect153">
            <choiceState section="all" set="disabled" />
            <combat noWeapon="true" />
            <afterCombatTurn turn="2">
                <combat noWeapon="false" />
            </afterCombatTurn>
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect154">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case from="0" to="2">
                    <choiceState section="sect120" set="enabled" />
                </case>
                <case from="3" to="9">
                    <choiceState section="sect51" set="enabled" />
                </case>
            </randomTable>
        </section>

        <section id="sect157">
            <endurance count="+1" />
        </section>

        <section id="sect158">
            <endurance count="-3" />
            <drop objectId="backpack" />
        </section>

        <section id="sect159">
            <endurance count="-2" />
        </section>

        <section id="sect160">
            <tag id="raiderroadhut" />
        </section>

        <section id="sect165">
            <choiceSelected section="sect13">
                <!-- TODO: Meal rules does not work here, and this is not complete. 
                     You should drop any meal type object (laumpsur meal) -->
                <test expression="[MEALS] == 0">
                    <endurance count="-3" />
                </test>
                <test expression="[MEALS] > 0">
                    <drop objectId="meal" />
                </test>
            </choiceSelected>
        </section>

        <section id="sect167">
            <object objectId="backpack" />
            <object objectId="meal" />
            <object objectId="shovel" />
        </section>

        <section id="sect168">
            <test not="true" hasObject="sommerswerd">
                <choiceState section="sect34" set="disabled" />
            </test>
            <test hasObject="sommerswerd">
                <choiceState section="sect85" set="disabled" />
            </test>
        </section>

        <section id="sect169">
            <choiceState section="all" set="disabled" />
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect171">
            <huntStatus enabled="false" />
        </section>

        <section id="sect173">
            <choiceState section="all" set="disabled" />
            <test hasObject="sommerswerd">
                <choiceState section="sect275" set="enabled" />
            </test>
            <test not="true" hasObject="sommerswerd">
                <randomTable>
                    <case from="0" to="6">
                        <choiceState section="sect143" set="enabled" />
                    </case>
                    <case from="7" to="11">
                        <choiceState section="sect179" set="enabled" />
                    </case>
                </randomTable>
                <test hasObject="shovel|pick">
                    <randomTableIncrement increment="+2" />
                </test>
            </test>
        </section>

        <section id="sect176">
            <endurance count="-3" />
            <choiceState section="all" set="disabled" />
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect177">
            <death />
        </section>

        <section id="sect181">
            <death />
        </section>

        <section id="sect182">
            <test not="true" hasDiscipline="hunting|tracking">
                <choiceState section="sect332" set="disabled" />
            </test>
            <test hasDiscipline="hunting|tracking">
                <choiceState section="sect58" set="disabled" />
            </test>
        </section>

        <section id="sect183">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case from="0" to="6">
                    <choiceState section="sect198" set="enabled" />
                </case>
                <case from="7" to="13">
                    <choiceState section="sect338" set="enabled" />
                </case>
            </randomTable>
            <test hasDiscipline="camflage">
                <randomTableIncrement increment="+4" />
            </test>
        </section>

        <section id="sect185">
            <meal huntDisabled="true" />
        </section>

        <section id="sect186">
            <choiceState section="all" set="disabled" />
            <combat eludeTurn="0" />
            <afterCombats>
                <choiceState section="sect243" set="enabled" />
            </afterCombats>
            <afterElude>
                <choiceState section="sect66" set="enabled" />
            </afterElude>
        </section>

        <section id="sect188">
            <meal />
        </section>

        <section id="sect189">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case from="0" to="4">
                    <choiceState section="sect234" set="enabled" />
                </case>
                <case from="5" to="9">
                    <choiceState section="sect47" set="enabled" />
                </case>
            </randomTable>
        </section>

        <section id="sect192">
            <death />
        </section>

        <section id="sect193">
            <choiceState section="all" set="disabled" />
            <afterCombatTurn turn="2">
                <disableCombats />
                <choiceState section="all" set="enabled" />
            </afterCombatTurn>
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect194">
            <choiceState section="all" set="disabled" />
            <disableCombats />
            <combat turnLoss="0" />
            <randomTable zeroAsTen="true">
                <disableCombats disabled="false" />
                <afterCombatTurn turn="[RANDOM]">
                    <combat turnLoss="-2" />
                </afterCombatTurn>
            </randomTable>
            <test hasDiscipline="mindomtr">
                <randomTableIncrement increment="+2" />
            </test>
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect196">
            <choiceState section="all" set="disabled" />
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect198">
            <choiceState section="all" set="disabled" />
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect200">
            <choiceState section="sect45" set="disabled" />
            <test hasTag="gorncove" hasDiscipline="hunting">
                <choiceState section="sect45" set="enabled" />
                <choiceState section="sect133" set="disabled" />
                <choiceState section="sect307" set="disabled" />
            </test>
        </section>

        <section id="sect202">
            <choiceState section="all" set="disabled" />
            <combat eludeTurn="0" index="0" />
            <combat eludeTurn="0" index="1" />
            <combat eludeTurn="0" index="2" />
            <combat eludeTurn="0" index="3" />
            <combat eludeTurn="0" index="4" />
            <combat eludeTurn="0" index="5" />
            <afterCombats>
                <choiceState section="sect237" set="enabled" />
            </afterCombats>
            <afterElude>
                <choiceState section="sect342" set="enabled" />
            </afterElude>
        </section>

        <section id="sect204">
            <meal />
        </section>

        <section id="sect207">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case from="0" to="4">
                    <choiceState section="sect336" set="enabled" />
                </case>
                <case from="5" to="11">
                    <choiceState section="sect218" set="enabled" />
                </case>
            </randomTable>
            <test hasDiscipline="wepnskll">
                <randomTableIncrement increment="+2" />
            </test>
        </section>

        <section id="sect208">
            <choiceState section="all" set="disabled" />
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect209">
            <test not="true" expression="[KAILEVEL] >= 6">
                <choiceState section="sect111" set="disabled" />
            </test>
            <test expression="[KAILEVEL] >= 6">
                <choiceState section="sect43" set="disabled" />
            </test>
        </section>

        <section id="sect211">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case from="0" to="4">
                    <choiceState section="sect51" set="enabled" />
                </case>
                <case from="5" to="9">
                    <choiceState section="sect120" set="enabled" />
                </case>
            </randomTable>
        </section>

        <section id="sect212">
            <test not="true" hasDiscipline="anmlknsp">
                <choiceState section="sect41" set="disabled" />
            </test>
            <test hasDiscipline="anmlknsp">
                <choiceState section="sect276" set="disabled" />
            </test>
        </section>

        <section id="sect213">
            <object objectId="pick" />
            <object objectId="shovel" />
            <object objectId="axe" />
            <object objectId="torch" />
            <object objectId="tinderbox" />
            <object objectId="hourglass" />
        </section>

        <section id="sect222">
            <object objectId="captaindvalsword" />
        </section>

        <section id="sect224">
            <choiceState section="sect60" set="disabled" />
            <test hasDiscipline="sixthsns|tracking">
                <choiceState section="sect60" set="enabled" />
                <choiceState section="sect199" set="disabled" />
                <choiceState section="sect208" set="disabled" />
            </test>
        </section>

        <section id="sect225">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case from="1" to="5">
                    <choiceState section="sect20" set="enabled" />
                </case>
                <case from="6" to="9">
                    <choiceState section="sect300" set="enabled" />
                </case>
                <case value="0">
                    <choiceState section="sect181" set="enabled" />
                </case>
            </randomTable>
        </section>

        <section id="sect230">
            <object objectId="sword" />
            <object objectId="dagger" />
            <pick class="money" count="9" />
            <object objectId="meal" index="0" />
            <object objectId="meal" index="1" />
        </section>

        <section id="sect231">
            <pick class="money" count="3" />
            <object objectId="sword" />
            <object objectId="meal" />
        </section>

        <section id="sect233">
            <choiceState section="all" set="disabled" />
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect234">
            <choiceState section="all" set="disabled" />
            <disableCombats />
            <combat turnLoss="0" />
            <randomTable zeroAsTen="true">
                <disableCombats disabled="false" />
                <afterCombatTurn turn="[RANDOM]">
                    <combat turnLoss="-2" />
                </afterCombatTurn>
            </randomTable>
            <test hasDiscipline="mindomtr">
                <randomTableIncrement increment="+2" />
            </test>
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect236">
            <endurance count="-4" />
        </section>

        <section id="sect240">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case from="0" to="4">
                    <choiceState section="sect94" set="enabled" />
                </case>
                <case from="5" to="9">
                    <choiceState section="sect158" set="enabled" />
                </case>
            </randomTable>
        </section>

        <section id="sect242">
            <death />
        </section>

        <section id="sect244">
            <choiceState section="sect250" set="disabled" />
            <test hasDiscipline="sixthsns|tracking">
                <choiceState section="sect250" set="enabled" />
                <choiceState section="sect335" set="disabled" />
                <choiceState section="sect11" set="disabled" />
            </test>
        </section>

        <section id="sect246">
            <endurance count="-8" />
            <test not="true" hasObject="sommerswerd">
                <choiceState section="sect34" set="disabled" />
            </test>
            <test hasObject="sommerswerd">
                <choiceState section="sect85" set="disabled" />
            </test>
        </section>

        <section id="sect247">
            <meal />
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case from="0" to="4">
                    <choiceState section="sect171" set="enabled" />
                </case>
                <case from="5" to="9">
                    <choiceState section="sect25" set="enabled" />
                </case>
            </randomTable>
        </section>

        <section id="sect249">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case from="0" to="3">
                    <choiceState section="sect153" set="enabled" />
                </case>
                <case from="4" to="7">
                    <choiceState section="sect323" set="enabled" />
                </case>
                <case from="8" to="11">
                    <choiceState section="sect39" set="enabled" />
                </case>
            </randomTable>
            <test hasDiscipline="wepnskll">
                <randomTableIncrement increment="+2" />
            </test>
        </section>

        <section id="sect253">
            <test not="true" expression="[KAILEVEL] >= 8">
                <choiceState section="sect72" set="disabled" />
            </test>
            <test expression="[KAILEVEL] >= 8">
                <choiceState section="sect135" set="disabled" />
            </test>
        </section>

        <section id="sect254">
            <choiceState section="sect326" set="disabled" />
            <test hasDiscipline="tracking">
                <choiceState section="sect326" set="enabled" />
                <choiceState section="sect156" set="disabled" />
                <choiceState section="sect101" set="disabled" />
            </test>
        </section>

        <section id="sect258">
            <choiceState section="sect305" set="disabled" />
            <choiceState section="sect49" set="disabled" />

            <test hasObject="onyxmedallion">
                <choiceState section="sect305" set="enabled" />
                <choiceState section="sect159" set="disabled" />
            </test>

            <test not="true" hasObject="onyxmedallion">
                <test hasDiscipline="camflage">
                    <choiceState section="sect49" set="enabled" />
                    <choiceState section="sect159" set="disabled" />
                </test>
            </test>
        </section>

        <section id="sect260">
            <choiceState section="all" set="disabled" />
            <afterCombatTurn turn="3">
                <disableCombats />
                <choiceState section="all" set="enabled" />
            </afterCombatTurn>
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect261">
            <object objectId="meal" />
            <pick class="money" count="8" />
        </section>

        <section id="sect262">
            <death />
        </section>

        <section id="sect263">
            <endurance count="-4" />
        </section>

        <section id="sect267">
            <death />
        </section>

        <section id="sect268">
            <pick class="money" count="4" />
            <object objectId="spear" />
            <object objectId="sword" />
            <object objectId="ironkey" />
            <object objectId="brasskey" />
            <object objectId="meal" index="0" />
            <object objectId="meal" index="1" />
            <object objectId="laumspurpotion4" />
        </section>

        <section id="sect269">
            <meal huntDisabled="true" />
            <object objectId="shovel" />
        </section>

        <section id="sect270">
            <choiceState section="sect29" set="disabled" />
            <choiceState section="sect168" set="disabled" />

            <test hasObject="tinderbox">
                <test hasObject="torch">
                    <choiceState section="sect29" set="enabled" />
                    <choiceState section="sect246" set="disabled" />
                </test>
            </test>
            <test not="true" hasObject="tinderbox">
                <test hasObject="firesphere">
                    <choiceState section="sect168" set="enabled" />
                    <choiceState section="sect246" set="disabled" />
                </test>
            </test>
            <test not="true" hasObject="torch">
                <test hasObject="firesphere">
                    <choiceState section="sect168" set="enabled" />
                    <choiceState section="sect246" set="disabled" />
                </test>
            </test>
        </section>

        <section id="sect271">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case from="0" to="6">
                    <choiceState section="sect9" set="enabled" />
                </case>
                <case from="7" to="11">
                    <choiceState section="sect104" set="enabled" />
                </case>
            </randomTable>
            <test hasDiscipline="hunting">
                <randomTableIncrement increment="+2" />
            </test>
        </section>

        <section id="sect272">
            <endurance count="-5" />
            <message id="msg-drop-weapon" text="Drop a weapon before continuing" />
            <choiceState section="all" set="disabled" />
            <onInventoryEvent>
                <test expression="[WEAPON-ITEMS-CNT-ON-ACTIONCHART] == 0 || [WEAPON-ITEMS-CNT-ON-SECTION] > 0">
                    <message id="msg-drop-weapon" op="hide" />
                    <choiceState section="all" set="enabled" />
                </test>
                <test not="true" expression="[WEAPON-ITEMS-CNT-ON-ACTIONCHART] == 0 || [WEAPON-ITEMS-CNT-ON-SECTION] > 0">
                    <message id="msg-drop-weapon" op="show" />
                    <choiceState section="all" set="disabled" />
                </test>
            </onInventoryEvent>
        </section>

        <section id="sect274">
            <test not="true" hasObject="flaskofholywater">
                <choiceState section="sect283" set="disabled" />
            </test>
            <test hasObject="flaskofholywater">
                <choiceState section="sect325" set="disabled" />
            </test>
        </section>

        <section id="sect275">
            <endurance count="-1" />
        </section>

        <section id="sect277">
            <choiceState section="all" set="disabled" />
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect279">
            <test not="true" hasObject="captaindvalsword">
                <choiceState section="sect327" set="disabled" />
            </test>
            <test hasObject="captaindvalsword">
                <choiceState section="sect289" set="disabled" />
            </test>
        </section>

        <section id="sect280">
            <pick class="money" count="3" />
            <object objectId="meal" />
            <object objectId="sword" />
        </section>

        <section id="sect283">
            <drop objectId="flaskofholywater" />
            <endurance count="-3" />
        </section>

        <section id="sect284">
            <endurance count="-3" />
            <choiceState section="all" set="disabled" />
            <combat eludeTurn="0" />
            <afterCombats>
                <choiceState section="sect7" set="enabled" />
            </afterCombats>
            <afterElude>
                <choiceState section="sect89" set="enabled" />
            </afterElude>
        </section>

        <section id="sect285">
            <choiceState section="all" set="disabled" />
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect287">
            <choiceState section="all" set="disabled" />
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect289">
            <choiceState section="sect255" set="disabled" />
            <test expression="[KAILEVEL] >= 8">
                <choiceState section="sect255" set="enabled" />
                <choiceState section="sect5" set="disabled" />
                <choiceState section="sect86" set="disabled" />
            </test>
        </section>

        <section id="sect291">
            <test not="true" hasDiscipline="camflage">
                <choiceState section="sect172" set="disabled" />
            </test>
            <test hasDiscipline="camflage">
                <choiceState section="sect93" set="disabled" />
            </test>
        </section>

        <section id="sect293">
            <test not="true" hasDiscipline="tracking">
                <choiceState section="sect18" set="disabled" />
            </test>
            <test hasDiscipline="tracking">
                <choiceState section="sect150" set="disabled" />
            </test>
        </section>

        <section id="sect296">
            <test not="true" hasObject="sommerswerd">
                <choiceState section="sect122" set="disabled" />
            </test>
            <test hasObject="sommerswerd">
                <choiceState section="sect274" set="disabled" />
            </test>
        </section>

        <section id="sect299">
            <choiceState section="all" set="disabled" />
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect301">
            <test not="true" hasDiscipline="anmlknsp">
                <choiceState section="sect106" set="disabled" />
            </test>
            <test hasDiscipline="anmlknsp">
                <choiceState section="sect236" set="disabled" />
            </test>
        </section>

        <section id="sect302">
            <object objectId="laumspurpotion4" index="0" />
            <object objectId="laumspurpotion4" index="1" />
            <object objectId="potionofstrength" />
            <object objectId="flaskofholywater" />
        </section>

        <section id="sect303">
            <endurance count="-2" />
        </section>

        <section id="sect304">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case from="0" to="4">
                    <choiceState section="sect47" set="enabled" />
                </case>
                <case from="5" to="9">
                    <choiceState section="sect234" set="enabled" />
                </case>
            </randomTable>
        </section>

        <section id="sect308">
            <tag id="elix" />
            <choiceState section="all" set="disabled" />
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect309">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case from="0" to="7">
                    <choiceState section="sect138" set="enabled" />
                </case>
                <case from="8" to="13">
                    <choiceState section="sect244" set="enabled" />
                </case>
            </randomTable>
            <test hasDiscipline="camflage">
                <randomTableIncrement increment="+4" />
            </test>
        </section>

        <section id="sect310">
            <choiceState section="all" set="disabled" />
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect312">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case from="0" to="2">
                    <choiceState section="sect120" set="enabled" />
                </case>
                <case from="3" to="9">
                    <choiceState section="sect51" set="enabled" />
                </case>
            </randomTable>
        </section>

        <section id="sect315">
            <choiceState section="sect48" set="disabled" />
            <test hasDiscipline="tracking">
                <choiceState section="sect48" set="enabled" />
                <choiceState section="sect269" set="disabled" />
                <choiceState section="sect145" set="disabled" />
            </test>
        </section>

        <section id="sect316">
            <choiceState section="all" set="disabled" />
            <combat index="0" combatSkillModifier="-2" eludeTurn="0" />
            <afterCombats>
                <choiceState section="sect146" set="enabled" />
            </afterCombats>
            <afterElude>
                <choiceState section="sect31" set="enabled" />
            </afterElude>
        </section>

        <section id="sect318">
            <test not="true" hasObject="scrollpoetry">
                <choiceState section="sect279" set="disabled" />
            </test>
            <test hasObject="scrollpoetry">
                <choiceState section="sect57" set="disabled" />
            </test>
        </section>

        <section id="sect319">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case from="0" to="4">
                    <choiceState section="sect25" set="enabled" />
                </case>
                <case from="5" to="9">
                    <choiceState section="sect171" set="enabled" />
                </case>
            </randomTable>
        </section>

        <section id="sect322">
            <endurance count="+2" />
            <object objectId="pick" />
            <object objectId="shovel" />
        </section>

        <section id="sect324">
            <meal />
        </section>

        <section id="sect325">
            <choiceState section="all" set="disabled" />
            <combat noMindblast="true" />
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect327">
            <drop objectId="captaindvalsword" />
        </section>

        <section id="sect329">
            <death />
        </section>

        <section id="sect331">
            <test not="true" hasDiscipline="anmlknsp">
                <choiceState section="sect41" set="disabled" />
            </test>
            <test hasDiscipline="anmlknsp">
                <choiceState section="sect276" set="disabled" />
            </test>
        </section>

        <section id="sect333">
            <choiceState section="all" set="disabled" />
            <afterCombatTurn turn="1">
                <disableCombats />
                <test expression="[COMBATSENDURANCELOST] > [COMBATSENEMYLOST]">
                    <choiceState section="sect209" set="enabled" />
                </test>
                <test expression="[COMBATSENEMYLOST] > [COMBATSENDURANCELOST]">
                    <choiceState section="sect220" set="enabled" />
                </test>
                <test expression="[COMBATSENEMYLOST] == [COMBATSENDURANCELOST]">
                    <choiceState section="sect344" set="enabled" />
                </test>
            </afterCombatTurn>
        </section>

        <section id="sect334">
            <death />
        </section>

        <section id="sect335">
            <test not="true" hasDiscipline="camflage">
                <choiceState section="sect35" set="disabled" />
            </test>
            <test not="true" hasDiscipline="mindomtr">
                <choiceState section="sect317" set="disabled" />
            </test>
            <test hasDiscipline="camflage|mindomtr">
                <choiceState section="sect147" set="disabled" />
            </test>
        </section>

        <section id="sect339">
            <meal />
        </section>

        <section id="sect340">
            <endurance count="-2" />
        </section>

        <section id="sect341">
            <endurance count="-4" />
        </section>

        <section id="sect342">
            <drop objectId="backpack" />
        </section>

        <section id="sect343">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case from="-2" to="6">
                    <choiceState section="sect194" set="enabled" />
                </case>
                <case from="7" to="12">
                    <choiceState section="sect61" set="enabled" />
                </case>
            </randomTable>
            <test expression="[ENDURANCE] &lt;= 12">
                <randomTableIncrement increment="-2" />
            </test>
            <test expression="[ENDURANCE] >= 20">
                <randomTableIncrement increment="+3" />
            </test>
        </section>

        <section id="sect344">
            <test not="true" expression="[KAILEVEL] >= 6">
                <choiceState section="sect111" set="disabled" />
            </test>
            <test expression="[KAILEVEL] >= 6">
                <choiceState section="sect43" set="disabled" />
            </test>
        </section>

        <section id="sect345">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case from="0" to="6">
                    <choiceState section="sect51" set="enabled" />
                </case>
                <case from="7" to="9">
                    <choiceState section="sect120" set="enabled" />
                </case>
            </randomTable>
        </section>

        <section id="sect347">
            <death />
        </section>

        <section id="sect350">
            <pick objectId="daggerofvashna" />
        </section>

        <!-- UP TO  -->

    </sections>

</mechanics>