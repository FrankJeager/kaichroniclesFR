<?xml version="1.0" encoding="utf-8"?>

<mechanics book="20" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="https://raw.githubusercontent.com/cracrayol/kaichronicles/master/www/data/mechanics.xsd">

    <!-- GAME RULES -->
    <sections>

        <section id="tssf">
            <!-- Restore the endurance to the maximum -->
            <endurance count="+[MAXENDURANCE]" />
            <!-- Drop the previous books map -->
            <drop objectId="map" />
            <!-- Restore Deliverance use each X days -->
            <restoreDeliveranceUse />
        </section>

        <section id="gamerulz">
            <!-- Select the player skills (weapons skill and endurance) UI -->
            <setSkills />
        </section>

        <section id="discplnz">
            <!-- Select the Kai disciplines UI -->
            <setDisciplines />
        </section>

        <section id="equipmnt" pickMaximum="4">
            <!-- Do not pick 2 maps! -->
            <test not="true" hasObject="map">
                <pick objectId="map" />
            </test>
            <test not="true" hasObject="backpack">
                <pick objectId="backpack" />
            </test>

            <randomTable>
                <pick class="money" count="[RANDOM] + 20" excessToKaiMonastry="true" />
            </randomTable>

            <!-- Kai monastery safekeeping -->
            <kaiMonasteryStorage />

            <object objectId="quarterstaff" />
            <object objectId="broadsword" />
            <object objectId="bow" />
            <object objectId="quiver" count="6" />
            <object objectId="dagger" />
            <object objectId="sword" />
            <object objectId="meal" index="0" />
            <object objectId="meal" index="1" />
            <object objectId="rope" />
            <object objectId="laumspurpotion4" />
            <object objectId="axe" />

            <chooseEquipment text="Click on the Random Table link to get money before continuing" />
            <message text="You may take up to four of the following (all meals count as one object):" />
        </section>

        <section id="sect4">
            <endurance count="-3" />
            <choiceState section="sect92" set="disabled" />
            <test hasDiscipline="anmlmstr">
                <choiceState section="sect92" set="enabled" />
                <choiceState section="sect69" set="disabled" />
            </test>
        </section>

        <section id="sect6">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case to="3">
                    <choiceState section="sect346" set="enabled" />
                </case>
                <case from="4">
                    <choiceState section="sect12" set="enabled" />
                </case>
            </randomTable>
            <test hasDiscipline="alchemy">
                <randomTableIncrement increment="2" />
            </test>
            <test expression="[ENDURANCE] >= 15">
                <randomTableIncrement increment="1" />
            </test>
            <test expression="[ENDURANCE] &lt;= 8">
                <randomTableIncrement increment="-1" />
            </test>
        </section>

        <section id="sect8">
            <endurance count="-5" />
            <drop backpackItemSlots="1|2|3" />
            <choiceState section="sect269" set="disabled" />
            <test hasDiscipline="gnosis">
                <test expression="[KAILEVEL] >= 9">
                    <choiceState section="sect269" set="enabled" />
                    <choiceState section="sect348" set="disabled" />
                </test>
            </test>
        </section>

        <section id="sect9">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case to="4">
                    <choiceState section="sect241" set="enabled" />
                </case>
                <case from="5">
                    <choiceState section="sect196" set="enabled" />
                </case>
            </randomTable>
            <test hasDiscipline="assimila">
                <randomTableIncrement increment="1" />
            </test>
            <test hasDiscipline="hntmstry">
                <randomTableIncrement increment="1" />
            </test>
            <test expression="[ENDURANCE] &lt;= 10">
                <randomTableIncrement increment="-2" />
            </test>
        </section>

        <section id="sect13">
            <death />
        </section>

        <section id="sect15">
            <choiceState section="all" set="disabled" />
            <randomTable zeroAsTen="true">
                <test hasDiscipline="assimila">
                    <test expression="[RANDOM] > 1">
                        <endurance count="-[RANDOM] + 1" />
                    </test>
                </test>
                <test not="true" hasDiscipline="assimila">
                    <endurance count="-[RANDOM]" />
                </test>
                <choiceState section="all" set="enabled" />
            </randomTable>
        </section>

        <section id="sect17">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case to="5">
                    <choiceState section="sect93" set="enabled" />
                </case>
                <case from="6">
                    <choiceState section="sect235" set="enabled" />
                </case>
            </randomTable>
            <test hasDiscipline="pthmnshp">
                <randomTableIncrement increment="2" />
            </test>
        </section>

        <section id="sect18">
            <choiceState section="sect249" set="disabled" />
            <test hasDiscipline="kaiscrn">
                <choiceState section="sect249" set="enabled" />
                <choiceState section="sect4" set="disabled" />
            </test>
        </section>

        <section id="sect19">
            <test not="true" hasDiscipline="gnosis">
                <choiceState section="sect76" set="disabled" />
            </test>
        </section>

        <section id="sect21">
            <choiceState section="all" set="disabled" />
            <test expression="[KAILEVEL] &lt;= 6">
                <choiceState section="sect187" set="enabled" />
            </test>
            <test expression="[KAILEVEL] >= 7 &amp;&amp; [KAILEVEL] &lt;= 9">
                <choiceState section="sect219" set="enabled" />
            </test>
            <test expression="[KAILEVEL] >= 10">
                <choiceState section="sect82" set="enabled" />
            </test>
        </section>

        <section id="sect22">
            <choiceState section="sect267" set="disabled" />
            <test hasDiscipline="kaisurge">
                <test expression="[KAILEVEL] >= 5">
                    <choiceState section="sect267" set="enabled" />
                    <choiceState section="sect335" set="disabled" />
                </test>
            </test>
        </section>

        <section id="sect24">
            <endurance count="-3" />
            <choiceState section="all" set="disabled" />
            <combat noMindblast="true" noKaiSurge="true" noPsiSurge="true" />
            <test hasDiscipline="anmlmstr">
                <combat noMindblast="true" noKaiSurge="true" noPsiSurge="true" combatSkillModifier="2" />
            </test>
            <afterCombats>
                <choiceState section="sect19" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect25">
            <death />
        </section>

        <section id="sect26">
            <test not="true" hasDiscipline="nexus">
                <choiceState section="sect98" set="disabled" />
            </test>
            <test not="true" expression="[KAILEVEL] >= 10">
                <choiceState section="sect98" set="disabled" />
            </test>
            <test not="true" hasDiscipline="magi">
                <choiceState section="sect294" set="disabled" />
            </test>
            <test not="true" hasDiscipline="alchemy">
                <choiceState section="sect135" set="disabled" />
            </test>
        </section>

        <section id="sect27">
            <choiceState section="sect258" set="disabled" />
            <test hasObject="korliniumscabbard">
                <choiceState section="sect258" set="enabled" />
                <choiceState section="sect341" set="disabled" />
            </test>
        </section>

        <section id="sect29">
            <choiceState section="sect108" set="disabled" />
            <test hasObject="sommerswerd|skarnska">
                <choiceState section="sect108" set="enabled" />
                <choiceState section="sect6" set="disabled" />
            </test>
        </section>

        <section id="sect30">
            <choiceState section="all" set="disabled" />
            <combat noMindblast="true" noKaiSurge="true" noPsiSurge="true" noKaiBlast="true" />
            <test hasDiscipline="anmlmstr">
                <combat combatSkillModifier="2" />
            </test>
            <afterCombats>
                <choiceState section="sect316" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect32">
            <choiceState section="all" set="disabled" />
            <combat noMindblast="true" noKaiSurge="true" noPsiSurge="true" noKaiBlast="true" noKaiRay="true" />
            <afterCombats>
                <choiceState section="sect129" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect34">
            <endurance count="-2" />
        </section>

        <section id="sect35">
            <endurance count="-2" />
            <choiceState section="sect193" set="disabled" />
            <test hasObject="sommerswerd|skarnska">
                <choiceState section="sect193" set="enabled" />
                <choiceState section="sect261" set="disabled" />
            </test>
        </section>

        <section id="sect37">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case to="3">
                    <choiceState section="sect262" set="enabled" />
                </case>
                <case from="4">
                    <choiceState section="sect338" set="enabled" />
                </case>
            </randomTable>
            <test expression="[ENDURANCE] >= 16">
                <randomTableIncrement increment="1" />
            </test>
            <test expression="[ENDURANCE] &lt;= 10">
                <randomTableIncrement increment="-1" />
            </test>
        </section>

        <section id="sect38">
            <choiceState section="sect247" set="disabled" />
            <choiceState section="sect178" set="disabled" />
            <test hasDiscipline="kaisurge">
                <test expression="[KAILEVEL] >= 7">
                    <choiceState section="sect247" set="enabled" />
                    <choiceState section="sect101" set="disabled" />
                </test>
            </test>
            <test hasDiscipline="anmlmstr">
                <test expression="[KAILEVEL] >= 8">
                    <choiceState section="sect178" set="enabled" />
                    <choiceState section="sect101" set="disabled" />
                </test>
            </test>
        </section>

        <section id="sect40">
            <choiceState section="sect192" set="disabled" />
            <test hasDiscipline="gnosis">
                <test expression="[KAILEVEL] >= 6">
                    <choiceState section="sect192" set="enabled" />
                    <choiceState section="sect324" set="disabled" />
                </test>
            </test>
        </section>

        <section id="sect41">
            <choiceState section="sect109" set="disabled" />
            <test expression="[MONEY] > 0">
                <choiceState section="sect109" set="enabled" />
                <choiceState section="sect65" set="disabled" />
            </test>
        </section>

        <section id="sect42">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case to="4">
                    <choiceState section="sect148" set="enabled" />
                </case>
                <case from="5">
                    <choiceState section="sect14" set="enabled" />
                </case>
            </randomTable>
            <test expression="[ENDURANCE] >= 20">
                <randomTableIncrement increment="1" />
            </test>
            <test expression="[ENDURANCE] &lt;= 10">
                <randomTableIncrement increment="-1" />
            </test>
        </section>

        <section id="sect43">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case to="4">
                    <choiceState section="sect312" set="enabled" />
                </case>
                <case from="5">
                    <choiceState section="sect277" set="enabled" />
                </case>
            </randomTable>
            <test hasDiscipline="assimila">
                <randomTableIncrement increment="2" />
            </test>
        </section>

        <section id="sect46">
            <choiceState section="all" set="disabled" />
            <combat noMindblast="true" noKaiSurge="true" noPsiSurge="true" />
            <test hasDiscipline="anmlmstr">
                <combat noMindblast="true" noKaiSurge="true" noPsiSurge="true" combatSkillModifier="2" />
            </test>
            <afterCombats>
                <choiceState section="sect19" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect47">
            <choiceState section="sect127" set="disabled" />
            <test hasTag="torgar">
                <choiceState section="sect127" set="enabled" />
                <choiceState section="sect91" set="disabled" />
            </test>
        </section>

        <section id="sect48">
            <choiceState section="all" set="disabled" />
            <useDeliverance />
            <randomTable zeroAsTen="true">
                <endurance count="[RANDOM] * 2" />
                <choiceState section="sect215" set="enabled" />
                <test hasTag="torgar">
                    <choiceState section="sect125" set="enabled" />
                    <choiceState section="sect215" set="disabled" />
                </test>
            </randomTable>
        </section>

        <section id="sect49">
            <endurance count="-2" />
            <choiceState section="sect269" set="disabled" />
            <test hasDiscipline="gnosis">
                <test expression="[KAILEVEL] >= 9">
                    <choiceState section="sect269" set="enabled" />
                    <choiceState section="sect348" set="disabled" />
                </test>
            </test>
        </section>

        <section id="sect50">
            <pick objectId="skarnska" />
            <pick objectId="korliniumscabbard" />
        </section>

        <section id="sect51">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case to="7">
                    <choiceState section="sect175" set="enabled" />
                </case>
                <case from="8">
                    <choiceState section="sect203" set="enabled" />
                </case>
            </randomTable>
            <test hasWeaponskillWith="bow">
                <randomTableIncrement increment="5" />
            </test>
        </section>

        <section id="sect53">
            <pick objectId="tomeofdarkness" />
        </section>

        <section id="sect55">
            <death />
        </section>

        <section id="sect56">
            <death />
        </section>

        <section id="sect57">
            <drop objectId="nzapokamulet" />
            <drop objectId="kunaering" />
            <drop objectId="scarabwinglessdragon" />
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case to="3">
                    <choiceState section="sect189" set="enabled" />
                </case>
                <case from="4">
                    <choiceState section="sect116" set="enabled" />
                </case>
            </randomTable>
            <test hasDiscipline="assimila">
                <randomTableIncrement increment="2" />
            </test>
            <test hasDiscipline="hntmstry|pthmnshp">
                <randomTableIncrement increment="1" />
            </test>
            <test expression="[KAILEVEL] > 5">
                <randomTableIncrement increment="[KAILEVEL] - 5" />
            </test>
        </section>

        <section id="sect58">
            <test not="true" hasObject="sommerswerd|skarnska">
                <choiceState section="sect44" set="disabled" />
            </test>
        </section>

        <section id="sect59">
            <choiceState section="all" set="disabled" />
            <test expression="[KAILEVEL] &lt;= 6">
                <choiceState section="sect187" set="enabled" />
            </test>
            <test expression="[KAILEVEL] >= 7 &amp;&amp; [KAILEVEL] &lt;= 9">
                <choiceState section="sect219" set="enabled" />
            </test>
            <test expression="[KAILEVEL] >= 10">
                <choiceState section="sect82" set="enabled" />
            </test>
        </section>

        <section id="sect60">
            <choiceState section="sect315" set="disabled" />
            <test hasObject="shamathpotion">
                <choiceState section="sect315" set="enabled" />
                <choiceState section="sect218" set="disabled" />
            </test>
        </section>

        <section id="sect61">
            <choiceState section="sect299" set="disabled" />
            <test hasDiscipline="wpnmstry">
                <test expression="[KAILEVEL] >= 7">
                    <choiceState section="sect299" set="enabled" />
                    <choiceState section="sect226" set="disabled" />
                </test>
            </test>
        </section>

        <section id="sect62">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case to="2">
                    <choiceState section="sect45" set="enabled" />
                </case>
                <case from="3">
                    <choiceState section="sect114" set="enabled" />
                </case>
            </randomTable>
            <test expression="[ENDURANCE] >= 20">
                <randomTableIncrement increment="1" />
            </test>
            <test expression="[ENDURANCE] &lt;= 10">
                <randomTableIncrement increment="-1" />
            </test>
        </section>

        <section id="sect63">
            <choiceState section="sect97" set="disabled" />
            <test hasTag="ixia">
                <choiceState section="sect97" set="enabled" />
                <choiceState section="sect301" set="disabled" />
            </test>
        </section>

        <section id="sect64">
            <choiceState section="all" set="disabled" />
            <combat noMindblast="true" noKaiSurge="true" noPsiSurge="true" eludeTurn="3" />
            <test hasObject="bluediamond">
                <test hasObject="skarnska">
                    <combat noMindblast="true" noKaiSurge="true" noPsiSurge="true" eludeTurn="3" combatSkillModifier="5" />
                </test>
                <test not="true" hasObject="skarnska">
                    <combat noMindblast="true" noKaiSurge="true" noPsiSurge="true" eludeTurn="3" combatSkillModifier="3" />
                </test>
            </test>
            <test not="true" hasObject="bluediamond">
                <test hasObject="skarnska">
                    <combat noMindblast="true" noKaiSurge="true" noPsiSurge="true" eludeTurn="3" combatSkillModifier="2" />
                </test>
            </test>
            <afterCombatTurn turn="1">
                <test expression="[ENEMYENDURANCE] &lt;= 20">
                    <disableCombats />
                    <choiceState section="sect344" set="enabled" />
                </test>
            </afterCombatTurn>
            <afterCombats>
                <choiceState section="sect344" set="enabled" />
            </afterCombats>
            <afterElude>
                <choiceState section="sect155" set="enabled" />
            </afterElude>
        </section>

        <section id="sect65">
            <choiceState section="sect208" set="disabled" />
            <test hasDiscipline="alchemy">
                <choiceState section="sect208" set="enabled" />
                <choiceState section="sect190" set="disabled" />
            </test>
        </section>

        <section id="sect66">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case to="6">
                    <choiceState section="sect25" set="enabled" />
                </case>
                <case from="7">
                    <choiceState section="sect95" set="enabled" />
                </case>
            </randomTable>
            <test hasDiscipline="assimila">
                <randomTableIncrement increment="3" />
            </test>
            <test hasDiscipline="hntmstry">
                <randomTableIncrement increment="2" />
            </test>
            <test expression="[ENDURANCE] &lt;= 10">
                <randomTableIncrement increment="-1" />
            </test>
        </section>

        <section id="sect67">
            <choiceState section="sect263" set="disabled" />
            <test hasDiscipline="pthmnshp">
                <choiceState section="sect263" set="enabled" />
                <choiceState section="sect134" set="disabled" />
            </test>
        </section>

        <section id="sect68">
            <choiceState section="sect121" set="disabled" />
            <choiceState section="sect211" set="disabled" />
            <test hasObject="sommerswerd">
                <choiceState section="sect121" set="enabled" />
                <choiceState section="sect282" set="disabled" />
            </test>
            <test hasObject="skarnska">
                <choiceState section="sect211" set="enabled" />
                <choiceState section="sect282" set="disabled" />
            </test>
        </section>

        <section id="sect69">
            <choiceState section="all" set="disabled" />
            <combat />
            <afterCombats>
                <choiceState section="sect28" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect73">
            <endurance count="-1" />
        </section>

        <section id="sect74">
            <choiceState section="all" set="disabled" />
            <combat noMindblast="true" noPsiSurge="true" noKaiSurge="true" />
            <afterCombats>
                <choiceState section="sect36" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect76">
            <test not="true" expression="[KAILEVEL] >= 7">
                <endurance count="-2" />
            </test>
        </section>

        <section id="sect78">
            <choiceState section="sect49" set="disabled" />
            <test hasDiscipline="gnosis">
                <test expression="[KAILEVEL] >= 7">
                    <choiceState section="sect49" set="enabled" />
                    <choiceState section="sect8" set="disabled" />
                </test>
            </test>
            <test hasDiscipline="pthmnshp">
                <choiceState section="sect49" set="enabled" />
                <choiceState section="sect8" set="disabled" />
            </test>
        </section>

        <section id="sect81">
            <choiceState section="sect121" set="disabled" />
            <choiceState section="sect211" set="disabled" />
            <test hasObject="sommerswerd">
                <choiceState section="sect121" set="enabled" />
                <choiceState section="sect282" set="disabled" />
            </test>
            <test hasObject="skarnska">
                <choiceState section="sect211" set="enabled" />
                <choiceState section="sect282" set="disabled" />
            </test>
        </section>

        <section id="sect82">
            <endurance count="-1" />
        </section>

        <section id="sect83">
            <choiceState section="all" set="disabled" />
            <randomTable zeroAsTen="true">
                <test hasDiscipline="assimila">
                    <test expression="[RANDOM] > 1">
                        <endurance count="-[RANDOM] + 1" />
                    </test>
                </test>
                <test not="true" hasDiscipline="assimila">
                    <endurance count="-[RANDOM]" />
                </test>
                <choiceState section="all" set="enabled" />
            </randomTable>
        </section>

        <section id="sect85">
            <choiceState section="sect115" set="disabled" />
            <choiceState section="sect334" set="disabled" />
            <test hasDiscipline="pthmnshp">
                <test expression="[KAILEVEL] >= 10">
                    <choiceState section="sect115" set="enabled" />
                </test>
                <test not="true" expression="[KAILEVEL] >= 10">
                    <choiceState section="sect334" set="enabled" />
                </test>
                <choiceState section="sect255" set="disabled" />
            </test>
        </section>

        <section id="sect86">
            <choiceState section="sect194" set="disabled" />
            <test hasTag="tahou">
                <choiceState section="sect194" set="enabled" />
                <choiceState section="sect339" set="disabled" />
            </test>
        </section>

        <section id="sect88">
            <meal />
        </section>

        <section id="sect89">
            <pick objectId="platinumamulet" />
            <pick objectId="tomeofdarkness" />
        </section>

        <section id="sect90">
            <registerGlobalRule id="planeofdarknessb20">
                <test combatsActive="true">
                    <test currentWeapon="sommerswerd">
                        <combat combatSkillModifierIncrement="4" />
                    </test>
                </test>
            </registerGlobalRule>
        </section>

        <section id="sect92">
            <choiceState section="all" set="disabled" />
            <combat />
            <afterCombats>
                <choiceState section="sect28" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect93">
            <choiceState section="all" set="disabled" />
            <combat />
            <afterCombats>
                <choiceState section="sect119" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect94">
            <choiceState section="all" set="disabled" />
            <combat noMindblast="true" noPsiSurge="true" noKaiSurge="true" noKaiBlast="true" />
            <test hasDiscipline="anmlmstr">
                <combat noMindblast="true" noPsiSurge="true" noKaiSurge="true" noKaiBlast="true" combatSkillModifier="2" />
            </test>
            <afterCombats>
                <choiceState section="sect316" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect95">
            <meal />
        </section>

        <section id="sect96">
            <death />
        </section>

        <section id="sect97">
            <choiceState section="sect242" set="disabled" />
            <test hasDiscipline="kaiscrn">
                <choiceState section="sect242" set="enabled" />
                <choiceState section="sect59" set="disabled" />
            </test>
        </section>

        <section id="sect98">
            <choiceState section="sect310" set="disabled" />
            <test hasObject="sommerswerd|skarnska">
                <choiceState section="sect310" set="enabled" />
                <choiceState section="sect147" set="disabled" />
            </test>
        </section>

        <section id="sect99">
            <endurance count="-2" />
        </section>

        <section id="sect100">
            <pick objectId="kunaering" />
            <endurance count="-2" />
            <choiceState section="sect113" set="disabled" />
            <test hasDiscipline="hntmstry">
                <choiceState section="sect113" set="enabled" />
                <choiceState section="sect7" set="disabled" />
            </test>
        </section>

        <section id="sect103">
            <pick class="money" count="-2" />
            <endurance count="-6" />
        </section>

        <section id="sect106">
            <choiceState section="sect72" set="disabled" />
            <choiceState section="sect174" set="disabled" />
            <test hasDiscipline="assimila">
                <test expression="[KAILEVEL] >= 5">
                    <choiceState section="sect72" set="enabled" />
                </test>
                <test not="true" expression="[KAILEVEL] >= 5">
                    <choiceState section="sect174" set="enabled" />
                </test>
                <choiceState section="sect140" set="disabled" />
            </test>
            <test hasDiscipline="hntmstry">
                <choiceState section="sect174" set="enabled" />
                <choiceState section="sect140" set="disabled" />
            </test>
        </section>

        <section id="sect110">
            <endurance count="-3" />
        </section>

        <section id="sect111">
            <test not="true" hasDiscipline="gnosis">
                <choiceState section="sect76" set="disabled" />
            </test>
        </section>

        <section id="sect112">
            <object objectId="muntaaghoney" />
            <choiceState section="sect107" set="disabled" />
            <test hasTag="maakentemple">
                <choiceState section="sect107" set="enabled" />
                <choiceState section="sect252" set="disabled" />
            </test>
        </section>

        <section id="sect117">
            <endurance count="-4" />
        </section>

        <section id="sect117">
            <endurance count="-8" />
        </section>

        <section id="sect120">
            <test not="true" hasDiscipline="gnosis">
                <choiceState section="sect76" set="disabled" />
            </test>
        </section>

        <section id="sect121">
            <choiceState section="all" set="disabled" />
            <currentWeapon objectId="sommerswerd" />
            <combat dammageMultiplier="2" />
            <afterCombats>
                <choiceState section="sect29" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect122">
            <choiceState section="sect73" set="disabled" />
            <choiceState section="sect251" set="disabled" />
            <test hasDiscipline="alchemy">
                <test expression="[KAILEVEL] >= 10">
                    <choiceState section="sect73" set="enabled" />
                </test>
                <test not="true" expression="[KAILEVEL] >= 10">
                    <choiceState section="sect251" set="enabled" />
                </test>
                <choiceState section="sect166" set="disabled" />
            </test>
        </section>

        <section id="sect123">
            <choiceState section="sect269" set="disabled" />
            <test hasDiscipline="gnosis">
                <test expression="[KAILEVEL] >= 9">
                    <choiceState section="sect269" set="enabled" />
                    <choiceState section="sect348" set="disabled" />
                </test>
            </test>
        </section>

        <section id="sect125">
            <choiceState section="sect245" set="disabled" />
            <choiceState section="sect165" set="disabled" />
            <choiceState section="sect230" set="disabled" />
            <test hasDiscipline="alchemy">
                <test expression="[KAILEVEL] >= 10">
                    <choiceState section="sect245" set="enabled" />
                    <choiceState section="sect144" set="disabled" />
                </test>
            </test>
            <test hasDiscipline="gnosis">
                <test expression="[KAILEVEL] >= 7">
                    <choiceState section="sect165" set="enabled" />
                    <choiceState section="sect144" set="disabled" />
                </test>
            </test>
            <test hasDiscipline="hntmstry">
                <test expression="[KAILEVEL] >= 5">
                    <choiceState section="sect230" set="enabled" />
                    <choiceState section="sect144" set="disabled" />
                </test>
            </test>
        </section>

        <section id="sect126">
            <death />
        </section>

        <section id="sect127">
            <choiceState section="sect163" set="disabled" />
            <test hasDiscipline="deliver">
                <test expression="[KAILEVEL] >= 8">
                    <choiceState section="sect163" set="enabled" />
                    <choiceState section="sect138" set="disabled" />
                </test>
            </test>
        </section>

        <section id="sect128">
            <death />
        </section>

        <section id="sect129">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case to="4">
                    <onInventoryEvent>
                        <test expression="[BACKPACK-ITEMS-CNT-ON-SECTION] == 1 || [BACKPACK-ITEMS-ON-ACTIONCHART] == 0">
                            <choiceState section="sect63" set="enabled" />
                        </test>
                        <test not="true" expression="[BACKPACK-ITEMS-CNT-ON-SECTION] == 1 || [BACKPACK-ITEMS-ON-ACTIONCHART] == 0">
                            <choiceState section="sect63" set="disabled" />
                        </test>
                    </onInventoryEvent>
                </case>
                <case from="5">
                    <pick class="money" count="-[MONEY]" />
                    <choiceState section="sect63" set="enabled" />
                </case>
            </randomTable>
        </section>

        <section id="sect130">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case to="4">
                    <choiceState section="sect15" set="enabled" />
                </case>
                <case from="5">
                    <choiceState section="sect328" set="enabled" />
                </case>
            </randomTable>
            <test hasDiscipline="hntmstry">
                <randomTableIncrement increment="1" />
            </test>
        </section>

        <section id="sect131">
            <endurance count="-2" />
        </section>

        <section id="sect132">
            <test not="true" hasDiscipline="alchemy">
                <choiceState section="sect11" set="disabled" />
            </test>
            <test not="true" hasDiscipline="magi">
                <choiceState section="sect349" set="disabled" />
            </test>
        </section>

        <section id="sect133">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case to="2">
                    <choiceState section="sect262" set="enabled" />
                </case>
                <case from="3">
                    <choiceState section="sect338" set="enabled" />
                </case>
            </randomTable>
            <test expression="[ENDURANCE] >= 16">
                <randomTableIncrement increment="1" />
            </test>
            <test expression="[ENDURANCE] &lt;= 10">
                <randomTableIncrement increment="-1" />
            </test>
        </section>

        <section id="sect134">
            <choiceState section="sect238" set="disabled" />
            <test hasDiscipline="assimila">
                <test expression="[KAILEVEL] >= 5">
                    <choiceState section="sect238" set="enabled" />
                    <choiceState section="sect156" set="disabled" />
                </test>
            </test>
        </section>

        <section id="sect135">
            <choiceState section="sect254" set="disabled" />
            <test hasObject="sommerswerd|skarnska">
                <choiceState section="sect254" set="enabled" />
                <choiceState section="sect147" set="disabled" />
            </test>
        </section>

        <section id="sect136">
            <death />
        </section>

        <section id="sect138">
            <endurance count="-4" />
        </section>

        <section id="sect139">
            <pick objectId="nzapokamulet" />
        </section>

        <section id="sect141">
            <choiceState section="sect73" set="disabled" />
            <choiceState section="sect251" set="disabled" />
            <test hasDiscipline="alchemy">
                <test expression="[KAILEVEL] >= 10">
                    <choiceState section="sect73" set="enabled" />
                </test>
                <test not="true" expression="[KAILEVEL] >= 10">
                    <choiceState section="sect251" set="enabled" />
                </test>
                <choiceState section="sect166" set="disabled" />
            </test>
        </section>

        <section id="sect142">
            <test canUseBow="false">
                <choiceState section="sect317" set="disabled" />
            </test>
        </section>

        <section id="sect143">
            <pick class="money" count="-1" />
        </section>

        <section id="sect144">
            <choiceState section="sect86" set="disabled" />
            <randomTable>
                <case to="4">
                    <endurance count="-4" />
                </case>
                <case from="5">
                    <endurance count="-5" />
                </case>
                <choiceState section="sect86" set="enabled" />
            </randomTable>
        </section>

        <section id="sect146">
            <choiceState section="sect225" set="enabled" />
            <test hasDiscipline="nexus">
                <test expression="[KAILEVEL] >= 11">
                    <choiceState section="sect225" set="enabled" />
                    <choiceState section="sect313" set="disabled" />
                </test>
            </test>
            <test not="true" hasDiscipline="gnosis">
                <choiceState section="sect99" set="disabled" />
            </test>
        </section>

        <section id="sect147">
            <choiceState section="all" set="disabled" />
            <combat noMindblast="true" noPsiSurge="true" noKaiSurge="true" noKaiBlast="true" noKaiRay="true" />
            <afterCombats>
                <choiceState section="sect186" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect149">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case to="3">
                    <choiceState section="sect284" set="enabled" />
                </case>
                <case from="4">
                    <choiceState section="sect31" set="enabled" />
                </case>
            </randomTable>
            <test expression="[ENDURANCE] >= 20">
                <randomTableIncrement increment="1" />
            </test>
            <test expression="[ENDURANCE] &lt;= 10">
                <randomTableIncrement increment="-1" />
            </test>
        </section>

        <section id="sect150">
            <drop objectId="tomeofdarkness" />
        </section>

        <section id="sect151">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case to="4">
                    <onInventoryEvent>
                        <test expression="[BACKPACK-ITEMS-CNT-ON-SECTION] == 1 || [BACKPACK-ITEMS-ON-ACTIONCHART] == 0">
                            <choiceState section="sect63" set="enabled" />
                        </test>
                        <test not="true" expression="[BACKPACK-ITEMS-CNT-ON-SECTION] == 1 || [BACKPACK-ITEMS-ON-ACTIONCHART] == 0">
                            <choiceState section="sect63" set="disabled" />
                        </test>
                    </onInventoryEvent>
                </case>
                <case from="5">
                    <pick class="money" count="-[MONEY]" />
                    <choiceState section="sect63" set="enabled" />
                </case>
            </randomTable>
        </section>

        <section id="sect154">
            <endurance count="-1" />
        </section>

        <section id="sect155">
            <pick objectId="scarabwinglessdragon" />
            <choiceState section="sect84" set="disabled" />
            <test hasTag="helgor">
                <choiceState section="sect84" set="enabled" />
                <choiceState section="sect124" set="disabled" />
            </test>
        </section>

        <section id="sect157">
            <choiceState section="sect72" set="disabled" />
            <choiceState section="sect174" set="disabled" />
            <test hasDiscipline="assimila">
                <test expression="[KAILEVEL] >= 5">
                    <choiceState section="sect72" set="enabled" />
                </test>
                <test not="true" expression="[KAILEVEL] >= 5">
                    <choiceState section="sect174" set="enabled" />
                </test>
                <choiceState section="sect140" set="disabled" />
            </test>
            <test hasDiscipline="hntmstry">
                <choiceState section="sect174" set="enabled" />
                <choiceState section="sect140" set="disabled" />
            </test>
        </section>

        <section id="sect158">
            <meal />
        </section>

        <section id="sect161">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case to="4">
                    <choiceState section="sect136" set="enabled" />
                </case>
                <case from="5">
                    <choiceState section="sect340" set="enabled" />
                </case>
            </randomTable>
            <test hasDiscipline="assimila">
                <randomTableIncrement increment="1" />
            </test>
            <test hasDiscipline="hntmstry">
                <randomTableIncrement increment="1" />
            </test>
        </section>

        <section id="sect162">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case to="4">
                    <choiceState section="sect94" set="enabled" />
                </case>
                <case from="5">
                    <choiceState section="sect120" set="enabled" />
                </case>
            </randomTable>
            <test expression="[ENDURANCE] &lt;= 15">
                <randomTableIncrement increment="-2" />
            </test>
        </section>

        <section id="sect164">
            <drop objectId="dagger|bonedagger|luthadagger" />
            <endurance count="-4" />
        </section>

        <section id="sect165">
            <endurance count="-3" />
        </section>

        <section id="sect166">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case to="3">
                    <choiceState section="sect231" set="enabled" />
                </case>
                <case from="4">
                    <choiceState section="sect217" set="enabled" />
                </case>
            </randomTable>
            <test hasDiscipline="pthmnshp">
                <randomTableIncrement increment="2" />
            </test>
        </section>

        <section id="sect167">
            <endurance count="-4" />
        </section>

        <section id="sect168">
            <endurance count="-3" />
        </section>

        <section id="sect169">
            <endurance count="-2" />
        </section>

        <section id="sect170">
            <choiceState section="sect297" set="disabled" />
            <choiceState section="sect133" set="disabled" />
            <test hasDiscipline="kaiscrn">
                <test expression="[KAILEVEL] >= 10">
                    <choiceState section="sect297" set="enabled" />
                </test>
                <test not="true" expression="[KAILEVEL] >= 10">
                    <choiceState section="sect133" set="enabled" />
                </test>
                <choiceState section="sect37" set="disabled" />
            </test>
        </section>

        <section id="sect171">
            <death />
        </section>

        <section id="sect172">
            <death />
        </section>

        <section id="sect173">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case to="5">
                    <choiceState section="sect83" set="enabled" />
                </case>
                <case from="6">
                    <choiceState section="sect39" set="enabled" />
                </case>
            </randomTable>
            <test hasDiscipline="hntmstry|assimila">
                <randomTableIncrement increment="1" />
            </test>
        </section>

        <section id="sect175">
            <pick class="arrow" count="-1" />
            <choiceState section="sect137" set="disabled" />
            <test hasDiscipline="anmlmstr">
                <choiceState section="sect137" set="enabled" />
                <choiceState section="sect293" set="disabled" />
            </test>
        </section>

        <section id="sect178">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case to="5">
                    <choiceState section="sect323" set="enabled" />
                </case>
                <case from="6">
                    <choiceState section="sect191" set="enabled" />
                </case>
            </randomTable>
            <test hasDiscipline="kaisurge">
                <test hasDiscipline="nexus">
                    <randomTableIncrement increment="3" />
                </test>
            </test>
        </section>

        <section id="sect179">
            <test not="true" hasDiscipline="anmlmstr">
                <choiceState section="sect149" set="disabled" />
            </test>
            <test not="true" hasDiscipline="kaisurge">
                <choiceState section="sect62" set="disabled" />
            </test>
            <test not="true" hasDiscipline="kaiscrn">
                <choiceState section="sect205" set="disabled" />
            </test>
        </section>

        <section id="sect180">
            <pick objectId="tomeofdarkness" />
        </section>

        <section id="sect181">
            <endurance count="-2" />
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case to="2">
                    <choiceState section="sect342" set="enabled" />
                </case>
                <case from="3" to="7">
                    <choiceState section="sect117" set="enabled" />
                </case>
                <case from="8">
                    <choiceState section="sect221" set="enabled" />
                </case>
            </randomTable>
            <test hasDiscipline="pthmnshp">
                <randomTableIncrement increment="1" />
            </test>
            <test hasDiscipline="hntmstry">
                <randomTableIncrement increment="1" />
            </test>
        </section>

        <section id="sect184">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case to="4">
                    <choiceState section="sect206" set="enabled" />
                </case>
                <case from="5">
                    <choiceState section="sect154" set="enabled" />
                </case>
            </randomTable>
            <test hasDiscipline="assimila">
                <randomTableIncrement increment="2" />
            </test>
        </section>

        <section id="sect185">
            <choiceState section="all" set="disabled" />
            <combat noMindblast="true" noKaiSurge="true" noPsiSurge="true" />
            <test hasObject="bluediamond">
                <test hasObject="skarnska">
                    <combat noMindblast="true" noKaiSurge="true" noPsiSurge="true" combatSkillModifier="5" />
                </test>
                <test not="true" hasObject="skarnska">
                    <combat noMindblast="true" noKaiSurge="true" noPsiSurge="true" combatSkillModifier="3" />
                </test>
            </test>
            <test not="true" hasObject="bluediamond">
                <test hasObject="skarnska">
                    <combat noMindblast="true" noKaiSurge="true" noPsiSurge="true" combatSkillModifier="2" />
                </test>
            </test>
            <afterCombatTurn turn="1">
                <test expression="[ENEMYENDURANCE] &lt;= 20">
                    <disableCombats />
                    <choiceState section="sect70" set="enabled" />
                </test>
            </afterCombatTurn>
            <afterCombats>
                <choiceState section="sect70" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect186">
            <choiceState section="sect303" set="disabled" />
            <test expression="[ENDURANCE] >= 5">
                <choiceState section="sect303" set="enabled" />
                <choiceState section="sect276" set="disabled" />
            </test>
        </section>

        <section id="sect187">
            <endurance count="-6" />
        </section>

        <section id="sect189">
            <death />
        </section>

        <section id="sect190">
            <choiceState section="sect164" set="disabled" />
            <choiceState section="sect244" set="disabled" />
            <test hasObject="dagger">
                <choiceState section="sect164" set="enabled" />
                <choiceState section="sect199" set="disabled" />
            </test>
            <test expression="[ARROWS] > 0">
                <choiceState section="sect244" set="enabled" />
                <choiceState section="sect199" set="disabled" />
            </test>
        </section>

        <section id="sect191">
            <object objectId="muntaaghoney" />
            <choiceState section="sect107" set="disabled" />
            <test hasTag="maakentemple">
                <choiceState section="sect107" set="enabled" />
                <choiceState section="sect252" set="disabled" />
            </test>
        </section>

        <section id="sect193">
            <choiceState section="all" set="disabled" />
            <test hasObject="sommerswerd">
                <currentWeapon objectId="sommerswerd" />
            </test>
            <test hasObject="skarnska">
                <currentWeapon objectId="skarnska" />
            </test>
            <combat noMindblast="true" noPsiSurge="true" noKaiSurge="true" combatSkillModifier="2" />
            <test hasDiscipline="anmlmstr">
                <combat noMindblast="true" noPsiSurge="true" noKaiSurge="true" combatSkillModifier="4" />
            </test>
            <afterCombats>
                <choiceState section="sect19" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect195">
            <pick class="money" count="-1" />
        </section>

        <section id="sect196">
            <meal />
        </section>

        <section id="sect197">
            <choiceState section="all" set="disabled" />
            <combat noMindblast="true" noPsiSurge="true" noKaiSurge="true" noKaiBlast="true" />
            <test hasDiscipline="anmlmstr">
                <combat noMindblast="true" noPsiSurge="true" noKaiSurge="true" noKaiBlast="true" combatSkillModifier="2" />
            </test>
            <afterCombats>
                <choiceState section="sect316" set="enabled" />
            </afterCombats>
        </section>

        <section id="199">
            <endurance count="-2" />
        </section>

        <section id="sect200">
            <test canUseBow="false">
                <choiceState section="sect336" set="disabled" />
            </test>
        </section>

        <section id="sect201">
            <choiceState section="sect104" set="disabled" />
            <test hasDiscipline="gnosis">
                <choiceState section="sect104" set="enabled" />
                <choiceState section="sect198" set="disabled" />
            </test>
        </section>

        <section id="sect202">
            <choiceState section="sect123" set="disabled" />
            <test hasDiscipline="hntmstry">
                <test expression="[KAILEVEL] >= 5">
                    <choiceState section="sect123" set="enabled" />
                    <choiceState section="sect78" set="disabled" />
                </test>
            </test>
        </section>

        <section id="sect203">
            <pick class="arrow" count="-1" />
        </section>

        <section id="sect204">
            <meal />
        </section>

        <section id="sect205">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case to="2">
                    <choiceState section="sect305" set="enabled" />
                </case>
                <case from="3">
                    <choiceState section="sect102" set="enabled" />
                </case>
            </randomTable>
            <test expression="[ENDURANCE] &lt;= 10">
                <randomTableIncrement increment="-1" />
            </test>
            <test expression="[ENDURANCE] >= 20">
                <randomTableIncrement increment="1" />
            </test>
        </section>

        <section id="sect206">
            <endurance count="-3" />
        </section>

        <section id="sect208">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case to="6">
                    <choiceState section="sect169" set="enabled" />
                </case>
                <case from="7">
                    <choiceState section="sect87" set="enabled" />
                </case>
            </randomTable>
            <test expression="[KAILEVEL] >= 8">
                <randomTableIncrement increment="1" />
            </test>
            <test expression="[ENDURANCE] >= 20">
                <randomTableIncrement increment="1" />
            </test>
        </section>

        <section id="sect209">
            <death />
        </section>

        <section id="sect210">
            <endurance count="-1" />
            <choiceState section="sect265" set="disabled" />
            <test hasTag="mogaruith">
                <choiceState section="sect265" set="enabled" />
                <choiceState section="sect41" set="disabled" />
            </test>
        </section>

        <section id="sect211">
            <currentWeapon objectId="skarnska" />
            <choiceState section="all" set="disabled" />
            <combat combatSkillModifier="3" />
            <afterCombats>
                <choiceState section="sect29" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect212">
            <endurance count="-2" />
            <choiceState section="all" set="disabled" />
            <combat mindblastMultiplier="2" />
            <afterCombats>
                <choiceState section="sect285" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect214">
            <endurance count="-4" />
        </section>

        <section id="sect215">
            <choiceState section="sect245" set="disabled" />
            <choiceState section="sect165" set="disabled" />
            <choiceState section="sect230" set="disabled" />
            <test hasDiscipline="alchemy">
                <test expression="[KAILEVEL] >= 10">
                    <choiceState section="sect245" set="enabled" />
                    <choiceState section="sect144" set="disabled" />
                </test>
            </test>
            <test hasDiscipline="gnosis">
                <test expression="[KAILEVEL] >= 7">
                    <choiceState section="sect165" set="enabled" />
                    <choiceState section="sect144" set="disabled" />
                </test>
            </test>
            <test hasDiscipline="hntmstry">
                <test expression="[KAILEVEL] >= 5">
                    <choiceState section="sect230" set="enabled" />
                    <choiceState section="sect144" set="disabled" />
                </test>
            </test>
        </section>

        <section id="sect216">
            <test not="true" hasDiscipline="hntmstry">
                <choiceState section="sect162" set="disabled" />
            </test>
            <test not="true" expression="[KAILEVEL] >= 5">
                <choiceState section="sect162" set="disabled" />
            </test>
            <test not="true" hasDiscipline="gnosis">
                <choiceState section="sect240" set="disabled" />
            </test>
            <test not="true" expression="[KAILEVEL] >= 7">
                <choiceState section="sect240" set="disabled" />
            </test>
            <test not="true" hasDiscipline="alchemy">
                <choiceState section="sect283" set="disabled" />
            </test>
        </section>

        <section id="sect218">
            <choiceState section="sect176" set="disabled" />
            <test hasTag="yanis">
                <choiceState section="sect176" set="enabled" />
                <choiceState section="sect47" set="disabled" />
            </test>
        </section>

        <section id="sect219">
            <endurance count="-3" />
        </section>

        <section id="sect220">
            <choiceState section="sect295" set="disabled" />
            <test hasObject="bluediamond">
                <choiceState section="sect295" set="enabled" />
                <choiceState section="sect239" set="disabled" />
            </test>
        </section>

        <section id="sect221">
            <endurance count="-2" />
        </section>

        <section id="sect222">
            <choiceState section="sect76" set="disabled" />
            <test hasDiscipline="gnosis">
                <choiceState section="sect76" set="enabled" />
                <choiceState section="sect177" set="disabled" />
            </test>
        </section>

        <section id="sect223">
            <choiceState section="sect27" set="disabled" />
            <test hasObject="sommerswerd">
                <choiceState section="sect27" set="enabled" />
                <choiceState section="sect307" set="disabled" />
            </test>
        </section>

        <section id="sect224">
            <choiceState section="sect254" set="disabled" />
            <test hasObject="sommerswerd|skarnska">
                <choiceState section="sect254" set="enabled" />
                <choiceState section="sect147" set="disabled" />
            </test>
        </section>

        <section id="sect226">
            <choiceState section="all" set="disabled" />
            <combat noMindblast="true" noKaiSurge="true" noPsiSurge="true" />
            <test hasDiscipline="anmlmstr">
                <combat noMindblast="true" noKaiSurge="true" noPsiSurge="true" combatSkillModifier="2" />
            </test>
            <afterCombats>
                <choiceState section="sect19" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect227">
            <choiceState section="sect267" set="disabled" />
            <test hasDiscipline="kaisurge">
                <test expression="[KAILEVEL] >= 5">
                    <choiceState section="sect267" set="enabled" />
                    <choiceState section="sect335" set="disabled" />
                </test>
            </test>
        </section>

        <!-- 239 -> 10 -->

        <!-- 297/338 -> 57 -->

        <!-- 317 -> arrow -->

        <section id="sect350">
            <unregisterGlobalRule id="planeofdarknessb20" />
        </section>
    </sections>
</mechanics>