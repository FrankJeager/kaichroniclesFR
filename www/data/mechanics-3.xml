<?xml version="1.0" encoding="utf-8"?>

<mechanics book="3">

    <!-- LIST OF TRANSLATED IMAGES -->
    <translated-images>
        <image>map.png</image>
        <image>weapons.png</image>
    </translated-images>

    <!-- GAME RULES -->
    <sections>

        <section id="tssf">
            <!-- Drop the previous books map -->
            <drop objectId="map" />
            <!-- Hunt is not available on Kalte (see section "equipmnt") -->
            <huntStatus enabled="false" />
        </section>

        <section id="gamerulz">
            <!-- Select the player skills (weapons skill and endurance) UI -->
            <setSkills />
        </section>

        <section id="discplnz">
            <!-- Select the Kai disciplines UI -->
            <setDisciplines />
        </section>

        <section id="equipmnt">
            <!-- Do not pick 2 maps! -->
            <test not="true" hasObject="map" >
                <pick objectId="map" />
            </test>

            <randomTable>
                <pick class="money" count="[RANDOM] + 10" />
            </randomTable>

            <object objectId="sword" />
            <object objectId="shortsword" />
            <object objectId="leatherwaistcoat" />
            <object objectId="spear" />
            <object objectId="mace" />
            <object objectId="warhammer" />
            <object objectId="axe" />
            <object objectId="laumspurpotion4" />
            <object objectId="quarterstaff" />
            <object objectId="meal" />
            <object objectId="broadsword" />

            <message en-text="Pick the money and choose two objects before continue" />
        </section>

        <section id="sect4">
            <object objectId="bonesword" />
            <object objectId="bluestonedisc" />
        </section>

        <section id="sect8">
            <pick objectId="baknaroil" />
        </section>

        <section id="sect9">
            <death />
        </section>

        <section id="sect10">
            <test sectionVisited="sect90">
                <choiceState section="sect90" set="disabled" />
            </test>
            <test sectionVisited="sect171">
                <choiceState section="sect171" set="disabled" />
            </test>
            <test sectionVisited="sect289">
                <choiceState section="sect289" set="disabled" />
            </test>
            <test sectionVisited="sect225">
                <choiceState section="sect225" set="disabled" />
            </test>
            <object objectId="backpack" />
        </section>

        <section id="sect12">
            <pick objectId="meal" index="0" />
            <pick objectId="meal" index="1" />
            <!-- You pick 3 and eat one, so no third -->
            <!--pick objectId="meal" index="2" /-->
            <pick objectId="sleepingfurs" />
            <pick objectId="largerope" />
        </section>

        <section id="sect14">
            <choiceState section="all" set="disabled" />
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect15">
            <test not="true" hasDiscipline="mindomtr">
                <choiceState section="sect185" set="disabled" />
            </test>
            <test not="true" hasObject="bonesword|bonedagger">
                <choiceState section="sect86" set="disabled" />
            </test>
            <test hasDiscipline="mindomtr" hasObject="bonesword|bonedagger">
                <choiceState section="sect323" set="disabled" />
            </test>
        </section>

        <section id="sect16">
            <message id="msg-drop-object" en-text="Drop two backpack items before continue" />
            <choiceState section="all" set="disabled" />
            <onInventoryEvent>
                <test expression="[BACKPACK-ITEMS-CNT-ON-ACTIONCHART] == 0 || [BACKPACK-ITEMS-CNT-ON-SECTION] >= 2">
                    <message id="msg-drop-object" op="hide" />
                    <choiceState section="all" set="enabled" />
                </test>
                <test not="true" expression="[BACKPACK-ITEMS-CNT-ON-ACTIONCHART] == 0 || [BACKPACK-ITEMS-CNT-ON-SECTION] >= 2">
                    <message id="msg-drop-object" op="show" />
                    <choiceState section="all" set="disabled" />
                </test>
            </onInventoryEvent>
        </section>

        <section id="sect18">
            <endurance count="-3" />
            <drop objectId="currentweapon" />
        </section>

        <section id="sect21">
            <endurance count="-2" />
            <endurance count="-1" />
        </section>

        <section id="sect24">
            <drop objectId="diamond" />
        </section>

        <section id="sect25">
            <object objectId="trianglebluestone" />
        </section>
        
        <section id="sect25">
            <object objectId="trianglebluestone" />
        </section>

        <section id="sect26">
            <object objectId="bonesword" index="0" />
            <object objectId="bonesword" index="1" />
            <object objectId="bonedagger" />
            <object objectId="mace" />

            <test hasDiscipline="sixthsns">
                <choiceState section="sect187" set="disabled" />
                <choiceState section="sect63" set="disabled" />
            </test>
            <test not="true" hasDiscipline="sixthsns">
                <choiceState section="sect231" set="disabled" />
            </test>
            <choiceSelected section="sect187">
                <pick objectId="bracelet" />
            </choiceSelected>
        </section>

        <section id="sect27">
            <test not="true" hasObject="baknaroil">
                <endurance count="-2" />
            </test>
        </section>

        <section id="sect29">
            <test not="true" hasObject="sommerswerd">
                <choiceState section="sect43" set="disabled" />
            </test>
            <test not="true" hasDiscipline="mindomtr">
                <choiceState section="sect121" set="disabled" />
            </test>

            <test hasObject="sommerswerd" hasDiscipline="mindomtr">
                <choiceState section="sect226" set="disabled" />
                <choiceState section="sect266" set="disabled" />
                <choiceState section="sect312" set="disabled" />
            </test>

            <test not="true" hasObject="sommerswerd" hasDiscipline="mindomtr">
                <choiceState section="all" set="disabled" />
                <randomTable>
                    <case from="1" to="4">
                        <choiceState section="sect226" set="enabled" />
                    </case>
                    <case from="5" to="9">
                        <choiceState section="sect266" set="enabled" />
                    </case>
                    <case value="0">
                        <choiceState section="sect312" set="enabled" />
                    </case>
                </randomTable>
            </test>
        </section>

        <section id="sect32">
            <!-- TODO: Pending to implement foot note about 3th enemy -->
            <choiceState section="all" set="disabled" />
            <afterCombatTurn turn="any">
                <test expression="[COMBATSENDURANCELOST] > 0">
                    <disableCombats />
                    <choiceState section="sect66" set="enabled" />
                </test>
            </afterCombatTurn>
            <afterCombats>
                <choiceState section="sect25" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect33">
            <endurance count="-1" />

            <test not="true" hasDiscipline="tracking|sixthsns">
                <choiceState section="sect348" set="disabled" />
            </test>
            <test hasDiscipline="tracking|sixthsns">
                <choiceState section="sect27" set="disabled" />
                <choiceState section="sect314" set="disabled" />
            </test>
        </section>

        <section id="sect36">
            <test not="true" hasDiscipline="sixthsns">
                <choiceState section="sect341" set="disabled" />
                <choiceState section="sect124" set="disabled" />
            </test>
            <test hasDiscipline="sixthsns">
                <choiceState section="sect264" set="disabled" />
                <test expression="[KAILEVEL] >= 7">
                    <choiceState section="sect124" set="disabled" />
                </test>
                <test not="true" expression="[KAILEVEL] >= 7">
                    <choiceState section="sect341" set="disabled" />
                </test>
            </test>
        </section>

        <section id="sect37">
            <death />
        </section>

        <section id="sect38">
            <object objectId="backpack" />
            <object objectId="largerope" />
        </section>
        
        <section id="sect40">
            <test not="true" hasDiscipline="tracking">
                <choiceState section="sect255" set="disabled" />
            </test>
            <test hasDiscipline="tracking">
                <choiceState section="sect125" set="disabled" />
                <choiceState section="sect184" set="disabled" />
            </test>
        </section>

        <section id="sect43">
            <endurance count="-1" />
        </section>

        <section id="sect44">
            <test not="true" hasObject="potionblackgraveweed">
                <choiceState section="sect79" set="disabled" />
            </test>
            <test not="true" hasObject="potiongreengallowbrush">
                <choiceState section="sect157" set="disabled" />
            </test>
            <test hasObject="potionblackgraveweed|potiongreengallowbrush">
                <choiceState section="sect270" set="disabled" />
            </test>
        </section>

        <section id="sect45">
            <test not="true" hasObject="silverkeybook3">
                <choiceState section="sect303" set="disabled" />
            </test>
            <test hasObject="silverkeybook3">
                <choiceState section="sect15" set="disabled" />
            </test>
        </section>
       
        <section id="sect49">
            <drop objectId="backpack" />

            <test not="true" hasDiscipline="tracking">
                <choiceState section="sect342" set="disabled" />
            </test>
            <test hasDiscipline="tracking">
                <choiceState section="sect284" set="disabled" />
                <choiceState section="sect199" set="disabled" />
            </test>
        </section>

        <section id="sect50">
            <test not="true" hasObject="glowingcrystal">
                <choiceState section="sect139" set="disabled" />
            </test>
            <test hasObject="glowingcrystal">
                <choiceState section="sect189" set="disabled" />
            </test>
        </section>

        <section id="sect53">
            <death />
        </section>

        <section id="sect54">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case from="0" to="4">
                    <choiceState section="sect250" set="enabled" />
                </case>
                <case from="5" to="12">
                    <choiceState section="sect268" set="enabled" />
                </case>
            </randomTable>
            <test hasDiscipline="mindomtr|mndblst">
                <randomTableIncrement increment="+3" />
            </test>
        </section>

        <section id="sect55">
            <endurance count="-5" />
            <combatSkill count="-2" />
        </section>

        <section id="sect57">
            <test not="true" hasDiscipline="healing">
                <choiceState section="sect17" set="disabled" />
            </test>
            <test hasDiscipline="healing">
                <choiceState section="sect251" set="disabled" />
            </test>
        </section>

        <section id="sect59">
            <object objectId="trianglebluestone" />
        </section>

        <section id="sect61">
            <death />
        </section>

        <section id="sect62">
            <endurance count="-3" />
        </section>

        <section id="sect66">
            <death />
        </section>

        <section id="sect67">
            <test not="true" hasObject="rope|largerope">
                <choiceState section="sect328" set="disabled" />
            </test>
        </section>

        <section id="sect68">
            <choiceState section="all" set="disabled" />
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect69">
            <test not="true" hasDiscipline="camflage">
                <choiceState section="sect222" set="disabled" />
            </test>
            <test hasDiscipline="camflage">
                <choiceState section="sect108" set="disabled" />
                <choiceState section="sect198" set="disabled" />
            </test>
        </section>

        <section id="sect70">
            <test not="true" hasObject="baknaroil">
                <choiceState section="sect209" set="disabled" />
            </test>
            <test hasObject="baknaroil">
                <choiceState section="sect339" set="disabled" />
            </test>
        </section>

        <section id="sect73">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case from="0" to="7">
                    <choiceState section="sect119" set="enabled" />
                </case>
                <case from="8" to="9">
                    <choiceState section="sect136" set="enabled" />
                </case>
            </randomTable>
        </section>

        <section id="sect74">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case from="0" to="4">
                    <choiceState section="sect48" set="enabled" />
                </case>
                <case from="5" to="9">
                    <choiceState section="sect287" set="enabled" />
                </case>
            </randomTable>
        </section>

        <!-- UP TO SECTION 74 -->

    </sections>

</mechanics>