<?xml version="1.0" encoding="utf-8"?>

<mechanics book="11">

    <!-- LIST OF TRANSLATED IMAGES -->
    <translated-images>
        <image>weapons.png</image>
    </translated-images>

    <!-- GAME RULES -->
    <sections>

        <section id="tssf">
            <!-- Restore the endurance to the maximum -->
            <!-- TODO: Sure??? -->
            <endurance count="+[MAXENDURANCE]" />
            <!-- Drop the previous books map -->
            <drop objectId="map" />
        </section>

        <section id="gamerulz">
            <!-- Select the player skills (weapons skill and endurance) UI -->
            <setSkills />
        </section>

        <section id="discplnz">
            <!-- Select the Kai disciplines UI -->
            <setDisciplines />
        </section>

        <section id="equipmnt" pickMaximum="6">
            <!-- No map / backpack / Kai monastery safekeeping at the start of this book -->
            <!-- TODO: It seems there is no map at this book. The book map is the "Northern Magnamund" map -->

            <!-- You can pick equipment only if it's your first book -->
            <test expression="[KAILEVEL] == 3">
                <!-- There are two free meals -->
                <pick objectId="meal" index="0"/>
                <pick objectId="meal" index="1"/>

                <randomTable>
                    <pick class="money" count="[RANDOM] + 10" />
                </randomTable>

                <object objectId="sword" />
                <object objectId="bow" />
                <object objectId="quiver" count="6" />
                <object objectId="rope" />
                <object objectId="laumspurpotion4" />
                <object objectId="lantern" />
                <object objectId="mace" />
                <object objectId="meal" index="0" />
                <object objectId="meal" index="1" />
                <object objectId="meal" index="2" />
                <object objectId="dagger" />

                <chooseEquipment
                    en-text="Click on the Random Table link to get money before continuing"
                    es-text="Haz click en el link de la Tabla de la Suerte para obtener dinero antes de continuar"
                />

                <message
                    en-text="You may take up to six of the following (all meals count as one object):"
                    es-text="Puedes elegir hasta seis de los objetos (todas las comidas cuentan como un objeto):"
                />
            </test>
        </section>

        <section id="sect1">
            <choiceState section="all" set="disabled" />
            <randomTable zeroAsTen="true">
                <endurance count="-[RANDOM]" />
                <choiceState section="all" set="enabled" />
            </randomTable>
        </section>

        <section id="sect2">
            <drop objectId="fireseed" />
        </section>

        <section id="sect5">
            <choiceState section="all" set="disabled" />

            <object objectId="meal" index="0" />
            <object objectId="meal" index="1" />
            <object objectId="meal" index="2" />

            <randomTable>
                <case from="0" to="6">
                    <choiceState section="sect202" set="enabled" />
                </case>
                <case from="7" to="9">
                    <choiceState section="sect318" set="enabled" />
                </case>
            </randomTable>
        </section>

        <section id="sect7">
            <object objectId="ironheartbroadsword" />
        </section>

        <section id="sect8">
            <object objectId="sword" />
        </section>

        <section id="sect10">
            <choiceState section="all" set="disabled" />
            <combat noMindblast="true" noWeapon="2" />
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect11">
            <death />
        </section>

        <section id="sect12">
            <!-- TODO: Drop objects like meal -->
            <!-- TODO: Bug here. I got a state.actionChart.meals == -1 after executing this -->
            <!-- TODO: Use pick class="meal" count="-4" ?? -->
            <drop objectId="meal" index="0" />
            <drop objectId="meal" index="1" />
            <drop objectId="meal" index="2" />
            <drop objectId="meal" index="3" />
        </section>

        <section id="sect13">
            <choiceState section="all" set="disabled" />

            <randomTable>
                <case from="0" to="8">
                    <choiceState section="sect271" set="enabled" />
                </case>
                <case from="9" to="99">
                    <choiceState section="sect199" set="enabled" />
                </case>
            </randomTable>
            <randomTableIncrement increment="+[KAILEVEL]" />
        </section>

        <section id="sect14">
            <choiceState section="sect223" set="disabled" />
            <test hasDiscipline="curing">
                <test expression="[KAILEVEL] >= 7">
                    <choiceState section="sect223" set="enabled" />
                    <choiceState section="sect99" set="disabled" />
                </test>
            </test>
        </section>

        <section id="sect17">
            <!-- TODO: Drop arrow on sect151 -->
        </section>

        <section id="sect18">
            <object objectId="ookorcharm" />
        </section>

        <section id="sect20">
            <choiceState section="sect145" set="disabled" />
            <test hasDiscipline="dvnation">
                <test expression="[KAILEVEL] >= 5">
                    <choiceState section="sect145" set="enabled" />
                    <choiceState section="sect297" set="disabled" />
                </test>
            </test>
        </section>

        <section id="sect21">
            <!-- TODO: Drop arrow on sect284 -->
        </section>

        <section id="sect22">
            <choiceState section="all" set="disabled" />

            <afterCombatTurn turn="any">
                <test expression="[COMBATSENEMYLOST] >= 18">
                    <test combatsActive="true">
                        <disableCombats />
                        <choiceState section="sect306" set="enabled" />
                    </test>
                </test>
            </afterCombatTurn>

            <afterCombats>
                <choiceState section="sect123" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect24">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case from="0" to="3">
                    <choiceState section="sect172" set="enabled" />
                </case>
                <case from="4" to="6">
                    <choiceState section="sect307" set="enabled" />
                </case>
                <case from="7" to="9">
                    <choiceState section="sect224" set="enabled" />
                </case>
            </randomTable>
        </section>

        <section id="sect25">
            <!-- There are loops here, reset destination section states -->
            <resetSectionState sectionId="sect216" />
            <resetSectionState sectionId="sect344" />
            <resetSectionState sectionId="sect169" />

            <!-- TODO: Display illustration on sect131 -->
        </section>

        <section id="sect26">
            <choiceState section="sect252" set="disabled" />
            <test hasDiscipline="pthmnshp">
                <test expression="[KAILEVEL] >= 8">
                    <choiceState section="sect252" set="enabled" />
                    <choiceState section="sect280" set="disabled" />
                </test>
            </test>
        </section>

        <section id="sect28">
            <choiceState section="sect129" set="disabled" />
            <test hasDiscipline="curing">
                <choiceState section="sect129" set="enabled" />
                <choiceState section="sect180" set="disabled" />
            </test>
        </section>

        <section id="sect29">
            <choiceState section="sect92" set="disabled" />
            <test hasDiscipline="dvnation">
                <test hasDiscipline="hntmstry">
                    <choiceState section="sect92" set="enabled" />
                    <choiceState section="sect316" set="disabled" />
                </test>
            </test>
        </section>

        <section id="sect30">
            <endurance count="-5" />
        </section>

        <section id="sect31">
            <choiceState section="all" set="disabled" />
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect32">
            <!-- TODO: Drop arrow on sections 76, 151 and 333 -->
        </section>

        <section id="sect33">
            <choiceState section="sect85" set="disabled" />
            <test hasDiscipline="anmlctrl">
                <choiceState section="sect85" set="enabled" />
                <choiceState section="sect299" set="disabled" />
            </test>
        </section>

        <section id="sect34">
            <choiceState section="all" set="disabled" />

            <combat turnLoss="-2" />
            <test hasDiscipline="curing">
                <test expression="[KAILEVEL] >= 7">
                    <combat turnLoss="0" />
                </test>
            </test>

            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect35">
            <meal />
        </section>

        <section id="sect36">
            <object objectId="khetuspores" />
        </section>

        <section id="sect37">
            <choiceState section="all" set="disabled" />
            <combat eludeTurn="3" noMindblast="true" />
            <afterCombats>
                <choiceState section="sect254" set="enabled" />
            </afterCombats>
            <afterElude>
                <choiceState section="sect303" set="enabled" />
            </afterElude>
        </section>

        <section id="sect38">
            <choiceState section="sect308" set="disabled" />
            <test hasDiscipline="invsblty">
                <choiceState section="sect308" set="enabled" />
                <choiceState section="sect259" set="disabled" />
            </test>
        </section>

        <section id="sect39">
            <choiceState section="all" set="disabled" />

            <randomTable>
                <case from="0" to="2">
                    <choiceState section="sect328" set="enabled" />
                </case>
                <case from="3" to="99">
                    <choiceState section="sect191" set="enabled" />
                </case>
            </randomTable>
            <test hasCircle="circleFire">
                <randomTableIncrement increment="+2" />
            </test>
        </section>

        <section id="sect40">
            <choiceState section="sect341" set="disabled" />
            <test hasObject="sommerswerd">
                <!-- TODO: Set sommerswerd as current weapon at sect341 -->
                <choiceState section="sect341" set="enabled" />
                <choiceState section="sect111" set="disabled" />
            </test>

            <choiceState section="sect204" set="disabled" />
            <test hasObject="ironheartbroadsword">
                <choiceState section="sect204" set="enabled" />
                <choiceState section="sect111" set="disabled" />
            </test>
        </section>

        <section id="sect41">
            <choiceState section="all" set="disabled" />
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect43">
            <choiceState section="sect92" set="disabled" />
            <test hasDiscipline="dvnation">
                <test hasDiscipline="hntmstry">
                    <choiceState section="sect92" set="enabled" />
                    <choiceState section="sect316" set="disabled" />
                </test>
            </test>
        </section>

        <section id="sect46">
            <death />
        </section>

        <section id="sect48">
            <choiceState section="sect69" set="disabled" />
            <test hasDiscipline="pthmnshp">
                <test expression="[KAILEVEL] >= 5">
                    <choiceState section="sect69" set="enabled" />
                    <choiceState section="sect196" set="disabled" />
                </test>
            </test>
        </section>

        <section id="sect54">
            <choiceState section="sect107" set="disabled" />
            <test hasObject="sommerswerd">
                <choiceState section="sect107" set="enabled" />
                <choiceState section="sect221" set="disabled" />
            </test>
        </section>

        <section id="sect57">
            <death />
        </section>

        <section id="sect59">
            <test canUseBow="false">
                <choiceState section="sect339" set="disabled" />
            </test>
        </section>

        <section id="sect60">
            <endurance count="-2" />

            <choiceState section="all" set="disabled" />
            <randomTable>
                <case from="0" to="2">
                    <choiceState section="sect73" set="enabled" />
                </case>
                <case from="3" to="6">
                    <choiceState section="sect179" set="enabled" />
                </case>
                <case from="7" to="9">
                    <choiceState section="sect338" set="enabled" />
                </case>
            </randomTable>
        </section>

        <section id="sect62">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case from="0" to="5">
                    <choiceState section="sect310" set="enabled" />
                </case>
                <case from="6" to="99">
                    <choiceState section="sect49" set="enabled" />
                </case>
            </randomTable>
            <test hasDiscipline="nexus|hntmstry">
                <randomTableIncrement increment="+4" />
            </test>
        </section>

        <section id="sect65">
            <choiceState section="sect255" set="disabled" />
            <test hasDiscipline="curing">
                <test expression="[KAILEVEL] >= 7">
                    <choiceState section="sect255" set="enabled" />
                    <choiceState section="sect324" set="disabled" />
                </test>
            </test>
        </section>

        <section id="sect66">
            <!-- TODO: Silver Flask available on sect261 -->
        </section>
        
        <section id="sect67">
            <test not="true" hasDiscipline="dvnation">
                <choiceState section="sect347" set="disabled" />
            </test>
        </section>

        <section id="sect68">
            <choiceState section="all" set="disabled" />

            <combat noMindblast="true"/>
            <test not="true" hasDiscipline="hntmstry">
                <combat combatSkillModifier="-3" />
                <afterCombatTurn turn="2">
                    <combat combatSkillModifier="0" />
                </afterCombatTurn>
            </test>

            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect72">
            <pick class="arrow" count="-1" />
            <choiceState section="all" set="disabled" />
            <combat noMindblast="true"/>
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect73">
            <pick class="meal" count="-([MEALS]/2)" />
            <drop specialItemSlots="2|4" />
        </section>

        <section id="sect74">
            <object objectId="haina" />
            <meal huntDisabled="true" />
        </section>

        <section id="sect75">
            <choiceState section="all" set="disabled" />
            <test hasDiscipline="invsblty">
                <choiceState section="sect167" set="enabled" />
            </test>
            <test not="true" hasDiscipline="invsblty">
                <randomTable>
                    <case from="0" to="4">
                        <choiceState section="sect142" set="enabled" />
                    </case>
                    <case from="5" to="9">
                        <choiceState section="sect240" set="enabled" />
                    </case>
                </randomTable>
            </test>
        </section>

        <section id="sect76">
            <pick class="arrow" count="-1" />
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case from="-99" to="4">
                    <choiceState section="sect249" set="enabled" />
                </case>
                <case from="5" to="8">
                    <choiceState section="sect171" set="enabled" />
                </case>
                <case from="9" to="99">
                    <choiceState section="sect113" set="enabled" />
                </case>
            </randomTable>
            <randomTableIncrement increment="+[BOWBONUS]" />
        </section>

        <section id="sect77">
            <pick class="arrow" count="-1" />

            <choiceState section="all" set="disabled" />

            <combat noMindblast="true"/>
            <test not="true" hasDiscipline="hntmstry">
                <combat combatSkillModifier="-3" />
                <afterCombatTurn turn="2">
                    <combat combatSkillModifier="0" />
                </afterCombatTurn>
            </test>

            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect78">
            <test not="true" expression="[MEALS] >= 1">
                <choiceState section="sect231" set="disabled" />
            </test>
            <choiceSelected section="sect231">
                <pick class="meal" count="-1" />
            </choiceSelected>
        </section>

        <section id="sect79">
            <choiceState section="sect270" set="disabled" />
            <test hasDiscipline="psisurge">
                <choiceState section="sect270" set="enabled" />
                <choiceState section="sect41" set="disabled" />
            </test>
        </section>

        <section id="sect81">
            <endurance count="-5" />

            <choiceState section="sect270" set="disabled" />
            <test hasDiscipline="psisurge">
                <choiceState section="sect270" set="enabled" />
                <choiceState section="sect41" set="disabled" />
            </test>
        </section>

        <section id="sect83">
            <endurance count="-2" />
        </section>

        <section id="sect84">
            <choiceState section="all" set="disabled" />
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect86">
            <endurance count="-2" />

            <choiceState section="sect311" set="disabled" />
            <test hasDiscipline="psiscrn">
                <test expression="[KAILEVEL] >= 5">
                    <choiceState section="sect311" set="enabled" />
                    <choiceState section="sect58" set="disabled" />
                </test>
            </test>
        </section>

        <section id="sect87">
            <drop objectId="obsidianseal" />
        </section>

        <section id="sect88">
            <choiceState section="sect223" set="disabled" />
            <test hasDiscipline="curing">
                <test expression="[KAILEVEL] >= 7">
                    <choiceState section="sect223" set="enabled" />
                    <choiceState section="sect99" set="disabled" />
                </test>
            </test>
        </section>

        <section id="sect92">
            <test canUseBow="false">
                <choiceState section="sect296" set="disabled" />
            </test>
        </section>

        <section id="sect93">
            <choiceState section="sect291" set="disabled" />
            <test hasDiscipline="dvnation">
                <choiceState section="sect291" set="enabled" />
                <choiceState section="sect152" set="disabled" />
            </test>
        </section>

        <section id="sect95">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case from="0" to="5">
                    <choiceState section="sect310" set="enabled" />
                </case>
                <case from="6" to="99">
                    <choiceState section="sect49" set="enabled" />
                </case>
            </randomTable>
            <test hasDiscipline="nexus|hntmstry">
                <randomTableIncrement increment="+4" />
            </test>
        </section>

        <section id="sect97">
            <choiceState section="all" set="disabled" />

            <afterCombatTurn turn="any">
                <test expression="[COMBATSENEMYLOST] >= 14">
                    <test combatsActive="true">
                        <disableCombats />
                        <choiceState section="sect306" set="enabled" />
                    </test>
                </test>
            </afterCombatTurn>

            <afterCombats>
                <choiceState section="sect123" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect98">
            <death />
        </section>

        <section id="sect99">
            <death />
        </section>

        <section id="sect101">
            <endurance count="+[MAXENDURANCE]" />
        </section>

        <section id="sect102">
            <endurance count="-3" />
        </section>

        <section id="sect103">
            <choiceState section="all" set="disabled" />
            <combat eludeTurn="3" noMindblast="true" />
            <afterCombats>
                <choiceState section="sect71" set="enabled" />
            </afterCombats>
            <afterElude>
                <choiceState section="sect298" set="enabled" />
            </afterElude>
        </section>

        <section id="sect104">
            <death />
        </section>

        <section id="sect105">
            <!-- TODO: Drop arrow in sect322 -->
            <choiceState section="all" set="disabled" />
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect108">
            <choiceState section="all" set="disabled" />
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect109">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case from="-99" to="6">
                    <choiceState section="sect130" set="enabled" />
                </case>
                <case from="7" to="99">
                    <choiceState section="sect295" set="enabled" />
                </case>
            </randomTable>
            <randomTableIncrement increment="[KAILEVEL] - 3" />
        </section>

        <section id="sect111">
            <death />
        </section>

        <section id="sect114">
            <choiceState section="sect150" set="disabled" />
            <test hasDiscipline="dvnation|pthmnshp">
                <choiceState section="sect150" set="enabled" />
                <choiceState section="sect63" set="disabled" />
            </test>
        </section>

        <section id="sect117">
            <choiceState section="sect48" set="disabled" />
            <test hasDiscipline="hntmstry">
                <test expression="[KAILEVEL] >= 6">
                    <choiceState section="sect48" set="enabled" />
                    <choiceState section="sect321" set="disabled" />
                </test>
            </test>
        </section>

        <section id="sect118">
            <!-- This is tricky -->
            <test not="true" hasDiscipline="curing">
                <test not="true" hasDiscipline="nexus">
                    <endurance count="-5" />
                </test>
                <test hasDiscipline="nexus">
                    <test not="true" expression="[KAILEVEL] >= 4">
                        <endurance count="-5" />
                    </test>
                </test>
            </test>
            <test hasDiscipline="curing">
                <test not="true" expression="[KAILEVEL] >= 7">
                    <test not="true" hasDiscipline="nexus">
                        <endurance count="-5" />
                    </test>
                    <test hasDiscipline="nexus">
                        <test not="true" expression="[KAILEVEL] >= 4">
                            <endurance count="-5" />
                        </test>
                    </test>
                </test>
            </test>
        </section>

        <section id="sect119">
            <endurance count="+3" />
            <object objectId="meal3" />
        </section>

        <section id="sect120">
            <endurance count="-5" />
            <choiceState section="all" set="disabled" />
            <combat noMindblast="true" noPsiSurge="true" />
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect121">
            <object objectId="khetuspores" />
        </section>
        
        <section id="sect125">
            <choiceState section="sect223" set="disabled" />
            <test hasDiscipline="curing">
                <test expression="[KAILEVEL] >= 7">
                    <choiceState section="sect223" set="enabled" />
                    <choiceState section="sect99" set="disabled" />
                </test>
            </test>
        </section>

        <section id="sect126">
            <choiceState section="sect61" set="disabled" />
            <test hasObject="lantern|firesphere">
                <choiceState section="sect61" set="enabled" />
            </test>
            <test hasObject="torch">
                <test hasObject="tinderbox">
                    <choiceState section="sect61" set="enabled" />
                </test>
            </test>
        </section>

        <section id="sect127">
            <!-- TODO: Drop arrow in sect284 -->
            <choiceState section="all" set="disabled" />
            <combat noMindblast="true" />
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect128">
            <choiceState section="all" set="disabled" />
            <combat noMindblast="true" />
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect129">
            <object objectId="mealofsenara" unlimited="true" useOnSection="true" />
        </section>

        <section id="sect131">
            <choiceState section="sect116" set="disabled" />
            <test hasDiscipline="pthmnshp|dvnation">
                <choiceState section="sect116" set="enabled" />
                <choiceState section="sect25" set="disabled" />
            </test>
        </section>

        <section id="sect132">
            <test not="true" hasDiscipline="dvnation">
                <choiceState section="sect347" set="disabled" />
            </test>
        </section>

        <section id="sect134">
            <test not="true" hasObject="rope|largerope">
                <choiceState section="sect198" set="disabled" />
            </test>
        </section>

        <section id="sect135">
            <test canUseBow="false">
                <choiceState section="sect256" set="disabled" />
                <!-- TODO: Drop arrow at sect256 -->
            </test>
        </section>

        <section id="sect137">
            <choiceState section="sect85" set="disabled" />
            <test hasDiscipline="anmlctrl">
                <choiceState section="sect85" set="enabled" />
                <choiceState section="sect332" set="disabled" />
            </test>
        </section>

        <section id="sect138">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case from="0" to="2">
                    <choiceState section="sect318" set="enabled" />
                </case>
                <case from="3" to="9">
                    <choiceState section="sect202" set="enabled" />
                </case>
            </randomTable>
            <meal />
        </section>

        <section id="sect140">
            <choiceState section="sect3" set="disabled" />
            <test hasDiscipline="anmlctrl">
                <choiceState section="sect3" set="enabled" />
                <choiceState section="sect168" set="disabled" />
            </test>
        </section>

        <section id="sect141">
            <test canUseBow="false">
                <choiceState section="sect284" set="disabled" />
                <!-- TODO: Drop arrow at sect284 -->
            </test>
        </section>

        <section id="sect143">
            <meal huntDisabled="true" />
        </section>

        <section id="sect144">
            <drop objectId="ironheartbroadsword" />
        </section>

        <section id="sect146">
            <endurance count="-4" />
            <object objectId="baylonboughfungi" />
        </section>

        <section id="sect151">
            <pick class="arrow" count="-1" />
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case from="-99" to="4">
                    <choiceState section="sect147" set="enabled" />
                </case>
                <case from="5" to="8">
                    <choiceState section="sect326" set="enabled" />
                </case>
                <case from="9" to="99">
                    <choiceState section="sect17" set="enabled" />
                </case>
            </randomTable>
            <randomTableIncrement increment="+[BOWBONUS]" />
        </section>

        <section id="sect155">
            <choiceState section="all" set="disabled" />
            <combat noMindblast="true" />
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect157">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case from="0" to="8">
                    <choiceState section="sect349" set="enabled" />
                </case>
                <case from="9" to="99">
                    <choiceState section="sect230" set="enabled" />
                </case>
            </randomTable>
            <test hasDiscipline="invsblty">
                <randomTableIncrement increment="+[KAILEVEL]" />
            </test>
        </section>

        <section id="sect158">
            <test canUseBow="false">
                <choiceState section="sect77" set="disabled" />
            </test>
        </section>

        <section id="sect160">
            <choiceState section="sect312" set="disabled" />
            <test hasCircle="circleSpirit">
                <choiceState section="sect312" set="enabled" />
                <choiceState section="sect106" set="disabled" />
            </test>
        </section>

        <section id="sect161">
            <choiceState section="sect13" set="disabled" />
            <test hasDiscipline="anmlctrl">
                <test expression="[KAILEVEL] >= 4">
                    <choiceState section="sect13" set="enabled" />
                    <choiceState section="sect271" set="disabled" />
                </test>
            </test>
        </section>

        <section id="sect165">
            <choiceState section="sect69" set="disabled" />
            <test hasDiscipline="pthmnshp">
                <test expression="[KAILEVEL] >= 5">
                    <choiceState section="sect69" set="enabled" />
                    <choiceState section="sect196" set="disabled" />
                </test>
            </test>
        </section>

        <section id="sect166">
            <choiceState section="sect197" set="disabled" />
            <test hasDiscipline="pthmnshp|dvnation">
                <choiceState section="sect197" set="enabled" />
                <choiceState section="sect315" set="disabled" />
            </test>
        </section>

        <section id="sect168">
            <choiceState section="sect12" set="disabled" />
            <!-- TODO: What about isMeal="true" objects ??? -->
            <test expression="[MEALS] >= 4">
                <choiceState section="sect12" set="enabled" />
                <choiceState section="sect327" set="disabled" />
            </test>
        </section>

        <section id="sect169">
            <endurance count="-10" />
        </section>

        <section id="sect170">
            <test not="true" hasDiscipline="curing">
                <choiceState section="sect78" set="disabled" />
            </test>
            <choiceSelected section="sect231">
                <!-- TODO: What about isMeal="true" objects ??? -->
                <test not="true" expression="[MEALS] > 0">
                    <endurance count="-3" />
                </test>
                <test expression="[MEALS] > 0">
                    <pick class="meal" count="-1" />
                </test>
            </choiceSelected>
        </section>

        <section id="sect174">
            <endurance count="-1" />
        </section>

        <section id="sect176">
            <choiceState section="sect29" set="disabled" />
            <test hasDiscipline="nexus">
                <choiceState section="sect29" set="enabled" />
                <choiceState section="sect134" set="disabled" />
            </test>
        </section>

        <section id="sect177">
            <object objectId="silverrod" />
        </section>

        <section id="sect179">
            <drop backpackItemSlots="3|4|5" />
        </section>

        <section id="sect183">
            <choiceState section="sect235" set="disabled" />
            <test hasDiscipline="dvnation">
                <choiceState section="sect235" set="enabled" />
                <choiceState section="sect292" set="disabled" />
            </test>
        </section>

        <section id="sect184">
            <test canUseBow="false">
                <choiceState section="sect72" set="disabled" />
            </test>
        </section>

        <section id="sect187">
            <choiceState section="all" set="disabled" />
            <combat eludeTurn="3" noMindblast="true" />
            <afterCombats>
                <choiceState section="sect71" set="enabled" />
            </afterCombats>
            <afterElude>
                <choiceState section="sect298" set="enabled" />
            </afterElude>
        </section>

        <section id="sect189">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case from="0" to="2">
                    <choiceState section="sect104" set="enabled" />
                </case>
                <case from="3" to="7">
                    <choiceState section="sect269" set="enabled" />
                </case>
                <case from="8" to="99">
                    <choiceState section="sect342" set="enabled" />
                </case>
            </randomTable>
            <test hasDiscipline="hntmstry">
                <randomTableIncrement increment="[KAILEVEL] - 3" />
            </test>
        </section>

        <section id="sect190">
            <choiceState section="sect79" set="disabled" />
            <test expression="[KAILEVEL] >= 8">
                <choiceState section="sect79" set="enabled" />
                <choiceState section="sect336" set="disabled" />
            </test>
        </section>

        <section id="sect191">
            <drop objectId="silverrod" />
            <endurance count="-3" />
        </section>

        <section id="sect192">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case from="0" to="3">
                    <choiceState section="sect65" set="enabled" />
                </case>
                <case from="4" to="7">
                    <choiceState section="sect146" set="enabled" />
                </case>
                <case from="8" to="99">
                    <choiceState section="sect304" set="enabled" />
                </case>
            </randomTable>
            <test hasDiscipline="hntmstry">
                <randomTableIncrement increment="[KAILEVEL] - 3" />
            </test>
        </section>

        <section id="sect193">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <pick class="arrow" count="-1" />
                <case from="-99" to="4">
                    <choiceState section="sect95" set="enabled" />
                </case>
                <case from="5" to="8">
                    <choiceState section="sect19" set="enabled" />
                </case>
                <case from="9" to="99">
                    <choiceState section="sect241" set="enabled" />
                </case>
            </randomTable>
            <randomTableIncrement increment="+[BOWBONUS]" />
        </section>

        <section id="sect194">
            <choiceState section="all" set="disabled" />
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect198">
            <drop objectId="backpack" />
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case from="0" to="3">
                    <choiceState section="sect214" set="enabled" />
                </case>
                <case from="4" to="99">
                    <choiceState section="sect128" set="enabled" />
                </case>
            </randomTable>
            <test hasDiscipline="anmlctrl">
                <randomTableIncrement increment="+3" />
            </test>
        </section>

        <section id="sect199">
            <choiceState section="all" set="disabled" />
            <combat combatSkillModifier="+3" />
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect200">
            <test canUseBow="false">
                <choiceState section="sect32" set="disabled" />
            </test>
        </section>

        <section id="sect201">
            <endurance count="-3" />
            <choiceState section="all" set="disabled" />

            <onInventoryEvent>
                <combat combatSkillModifier="0" />
                <!-- Sommerswerd can be used as any "sword", and this includes the "broadsword", avoid the comparison -->
                <test not="true" currentWeapon="sommerswerd">
                    <test currentWeapon="quarterstaff|broadsword|spear">
                        <combat combatSkillModifier="-2" />
                    </test>
                </test>
            </onInventoryEvent>

            <combat noMindblast="true" disabledObjects="shield" />
            <afterCombats>
                <test not="true" expression="[COMBATSDURATION] > 3">
                    <choiceState section="sect254" set="enabled" />
                </test>
                <test expression="[COMBATSDURATION] > 3">
                    <choiceState section="sect37" set="enabled" />
                </test>
            </afterCombats>
        </section>

        <section id="sect203">
            <object objectId="spear" index="0" />
            <object objectId="spear" index="1" />
            <object objectId="spear" index="2" />
            <object objectId="spear" index="3" />
            <object objectId="spear" index="4" />
            <object objectId="spear" index="5" />
            <object objectId="sword" index="0" />
            <object objectId="sword" index="1" />
            <object objectId="axe" />
            <object objectId="meal" index="0" />
            <object objectId="meal" index="1" />
            <object objectId="meal" index="2" />
            <object objectId="conchshell" index="2" />
        </section>

        <section id="sect204">
            <choiceState section="all" set="disabled" />

            <currentWeapon objectId="ironheartbroadsword" />
            <onInventoryEvent>
                <combat combatSkillModifier="0" />
                <test currentWeapon="ironheartbroadsword">
                    <combat combatSkillModifier="+8" />
                </test>
            </onInventoryEvent>

            <combat noMindblast="true" />
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect206">
            <choiceState section="all" set="disabled" />

            <afterCombatTurn turn="any">
                <test expression="[COMBATSENEMYLOST] >= 10">
                    <test combatsActive="true">
                        <disableCombats />
                        <choiceState section="sect306" set="enabled" />
                    </test>
                </test>
            </afterCombatTurn>

            <afterCombats>
                <choiceState section="sect123" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect207">
            <choiceState section="sect159" set="disabled" />
            <test hasDiscipline="psiscrn">
                <choiceState section="sect159" set="enabled" />
                <choiceState section="sect293" set="disabled" />
            </test>
        </section>

        <section id="sect208">
            <endurance count="-3" />
        </section>

        <section id="sect209">
            <choiceState section="sect290" set="disabled" />
            <test hasDiscipline="psiscrn">
                <choiceState section="sect290" set="enabled" />
                <choiceState section="sect30" set="disabled" />
            </test>
        </section>

        <section id="sect210">
            <pick objectId="obsidianseal" />
        </section>

        <section id="sect212">
            <choiceState section="sect44" set="disabled" />
            <test hasDiscipline="pthmnshp">
                <choiceState section="sect44" set="enabled" />
                <choiceState section="sect260" set="disabled" />
            </test>
        </section>

        <section id="sect214">
            <death />
        </section>

        <section id="sect215">
            <choiceState section="sect325" set="disabled" />
            <test hasDiscipline="pthmnshp">
                <test expression="[KAILEVEL] >= 8">
                    <choiceState section="sect325" set="enabled" />
                    <choiceState section="sect337" set="disabled" />
                </test>
            </test>
            <test hasDiscipline="anmlctrl">
                <choiceState section="sect325" set="enabled" />
                <choiceState section="sect337" set="disabled" />
            </test>
        </section>

        <section id="sect216">
            <endurance count="-10" />
        </section>

        <section id="sect217">
            <test not="true" hasDiscipline="nexus">
                <endurance count="-3" />
            </test>
        </section>

        <section id="sect220">
            <!-- TODO: Drop arrow at sect284 -->
            <choiceState section="all" set="disabled" />
            <combat noMindblast="true" noWeapon="1" />
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect225">
            <choiceState section="all" set="disabled" />
            <combat noMindblast="true" />
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect226">
            <choiceState section="all" set="disabled" />
            <combat noMindblast="true" />
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect227">
            <choiceState section="all" set="disabled" />
            <combat mindblastMultiplier="2" />
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect228">
            <choiceState section="sect64" set="disabled" />
            <test hasDiscipline="hntmstry">
                <test expression="[KAILEVEL] >= 6">
                    <choiceState section="sect64" set="enabled" />
                    <choiceState section="sect148" set="disabled" />
                </test>
            </test>
        </section>

        <section id="sect231">
            <object objectId="sword" />
        </section>

        <section id="sect233">
            <!-- TODO: This is really the "book map". Show it on the map page -->
            <pick objectId="map" />
        </section>

        <!-- Up to sect233 -->

    </sections>

</mechanics>
