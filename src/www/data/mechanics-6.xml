<?xml version="1.0" encoding="utf-8"?>

<mechanics book="6">

    <!-- LIST OF TRANSLATED IMAGES -->
    <translated-images>
        <image>weapons.png</image>
    </translated-images>

    <!-- GAME RULES -->
    <sections>

        <section id="tssf">
            <!-- Restore the endurace to the maximum -->
            <endurance count="+[MAXENDURANCE]" />
            <!-- Drop the previous books map -->
            <drop objectId="map" />
            <!-- Drop all kai disciplines, now we use magnakai disciplines -->
            <dropDisciplines />
        </section>

        <section id="gamerulz">
            <!-- Select the player skills (weapons skill and endurance) UI -->
            <setSkills />
        </section>

        <section id="discplnz">
            <!-- Select the Kai disciplines UI -->
            <setDisciplines />
        </section>
        
        <section id="equipmnt" pickMaximum="5" pickMaximumMealsFactor="4">
            <!-- Do not pick 2 maps! -->
            <test not="true" hasObject="map" >
                <pick objectId="map" />
            </test>

            <randomTable>
                <pick class="money" count="[RANDOM] + 10" />
            </randomTable>

            <object objectId="sword" />
            <object objectId="laumspurpotion4" />
            <object objectId="warhammer" />
            <object objectId="bow" />
            <object objectId="quiver" arrows="6" />
            <object objectId="meal" index="0" />
            <object objectId="meal" index="1" />
            <object objectId="meal" index="2" />
            <object objectId="meal" index="3" />
            <object objectId="quarterstaff" />
            <object objectId="leatherwaistcoat" />
            <object objectId="rope" />
            <object objectId="dagger" />
            <object objectId="tinderbox" />
            <object objectId="axe" />

            <chooseEquipment 
                en-text="Pick the money and choose up to five objects before continue (all meals count as one object)" 
                es-text="Escoge el dinero y elige hasta cinco objetos antes de continuar (todas las comidas cuentan como un objeto)"
            />
        </section>

        <section id="sect1">
            <test not="true" hasDiscipline="pthmnshp">
                <choiceState section="sect308" set="disabled" />
            </test>
        </section>

        <section id="sect2">
            <object objectId="laumspurpotion4" price="5" />
            <object objectId="potiongallowbrush" price="2" />
            <object objectId="rendalimelixir" price="7" />
            <object objectId="potionofstrength" price="4" />
            <object objectId="potionblackgraveweed" price="4" />
        </section>

        <section id="sect3">
            <object objectId="torch" />
        </section>

        <section id="sect4">
            <message id="msg-drop-weapon" 
                en-text="Drop a weapon before continue" 
                es-text="Deja un arma antes de continuar"
            />
            <choiceState section="all" set="disabled" />
            <onInventoryEvent>
                <test expression="[WEAPONLIKE-CNT-ON-ACTIONCHART] == 0 || [WEAPONLIKE-CNT-ON-SECTION] > 0">
                    <message id="msg-drop-weapon" op="hide" />
                    <choiceState section="all" set="enabled" />
                </test>
                <test not="true" expression="[WEAPONLIKE-CNT-ON-ACTIONCHART] == 0 || [WEAPONLIKE-CNT-ON-SECTION] > 0">
                    <message id="msg-drop-weapon" op="show" />
                    <choiceState section="all" set="disabled" />
                </test>
            </onInventoryEvent>
        </section>

        <section id="sect5">
            <test not="true" expression="[MONEY] >= 2">
                <choiceState section="sect141" set="disabled" />
            </test>
            <choiceSelected section="sect141">
                <pick class="money" count="-2" />
            </choiceSelected>
        </section>

        <section id="sect8">
            <pick class="money" count="10" />
            <object objectId="laumspurpotion3" />
            <object objectId="mapvaretta" />
        </section>

        <section id="sect9">
            <test not="true" expression="[MONEY] >= 10">
                <choiceState section="sect332" set="disabled" />
            </test>
            <choiceSelected section="sect332">
                <pick class="money" count="-10" />
            </choiceSelected>
        </section>

        <section id="sect10">
            <object objectId="luyenticket" price="10" />
            <object objectId="rhemticket" price="15" />
            <object objectId="eulaticket" price="20" />
            <onInventoryEvent>
                <test hasObject="luyenticket|rhemticket|eulaticket">
                    <choiceState section="all" set="enabled" />
                </test>
                <test not="true" hasObject="luyenticket|rhemticket|eulaticket">
                    <choiceState section="all" set="disabled" />
                </test>
            </onInventoryEvent>
        </section>

        <section id="sect12">
            <choiceState section="all" set="disabled" />
            <combat eludeTurn="0" enemyMultiplier="0" />
            <afterCombatTurn turn="2">
                <combat enemyMultiplier="1" />
            </afterCombatTurn>
            <afterCombats>
                <choiceState section="sect112" set="enabled" />
            </afterCombats>
            <afterElude>
                <choiceState section="sect305" set="enabled" />
            </afterElude>
        </section>

        <section id="sect13">
            <test not="true" canUseBow="true">
                <choiceState section="sect56" set="disabled" />
            </test>
        </section>

        <section id="sect16">
            <test not="true" hasObject="mapvaretta">
                <pick objectId="mapvaretta" />
            </test>
        </section>

        <section id="sect17">
            <test not="true" expression="[MONEY] >= 3">
                <choiceState section="sect202" set="disabled" />
            </test>
            <test not="true" expression="[MONEY] >= 5">
                <choiceState section="sect251" set="disabled" />
            </test>

            <test not="true" expression="[MONEY] >= 2">
                <choiceState section="sect144" set="disabled" />
                <message id="msg-drop-object" 
                    en-text="Drop one Backpack Item or Weapon in lieu of payment for a night in the dormitory" 
                    es-text="Deja un Arma u Objeto de Mochila en pago por una noche en el dormitorio"
                />
                <onInventoryEvent>
                    <test expression="( [WEAPON-ITEMS-CNT-ON-ACTIONCHART] + [BACKPACK-ITEMS-CNT-ON-ACTIONCHART] ) == 0 || ( [WEAPON-ITEMS-CNT-ON-SECTION] + [BACKPACK-ITEMS-CNT-ON-SECTION] ) > 0">
                        <message id="msg-drop-object" op="hide" />
                        <choiceState section="sect144" set="enabled" />
                    </test>
                    <test not="true" expression="( [WEAPON-ITEMS-CNT-ON-ACTIONCHART] + [BACKPACK-ITEMS-CNT-ON-ACTIONCHART] ) == 0 || ( [WEAPON-ITEMS-CNT-ON-SECTION] + [BACKPACK-ITEMS-CNT-ON-SECTION] ) > 0">
                        <message id="msg-drop-object" op="show" />
                        <choiceState section="sect144" set="disabled" />
                    </test>
                </onInventoryEvent>
            </test>

            <choiceSelected section="sect144">
                <test expression="[MONEY] >= 2">
                    <pick class="money" count="-2" />
                </test>
            </choiceSelected>
            <choiceSelected section="sect202">
                <pick class="money" count="-3" />
            </choiceSelected>
            <choiceSelected section="sect251">
                <pick class="money" count="-5" />
            </choiceSelected>

        </section>

        <section id="sect18">
            <test not="true" hasDiscipline="hntmstry">
                <choiceState section="sect205" set="disabled" />
            </test>
        </section>
        
        <section id="sect20">
            <pick class="arrow" count="-1" />
        </section>

        <section id="sect22">
            <test not="true" hasDiscipline="dvnation">
                <choiceState section="sect41" set="disabled" />
            </test>
        </section>

        <section id="sect24">
            <test not="true" hasDiscipline="nexus">
                <choiceState section="sect276" set="disabled" />
            </test>
            <test not="true" hasObject="rope|largerope">
                <choiceState section="sect101" set="disabled" />
            </test>
        </section>

        <section id="sect26">
            <textToChoice 
                text-en="turn immediately to 335"
                text-es="pasa inmediatamente al 335"
                section="sect335"
            />
            <choiceState section="all" set="disabled" />
            <combat bow="true" />
            <book6sect26 />
            <test hasObject="jakan">
                <afterCombatTurn turn="any">
                    <test expression="[COMBATRANDOM] == 0">
                        <disableCombats />
                        <choiceState section="sect335" set="enabled" />
                    </test>
                </afterCombatTurn>
            </test>
            <afterCombats>
                <test combatsWon="true">
                    <choiceState section="sect252" set="enabled" />
                </test>
                <test combatsWon="false">
                    <choiceState section="sect183" set="enabled" />
                </test>
            </afterCombats>
        </section>

        <section id="sect27">
            <test not="true" expression="[MONEY] >= 3">
                <choiceState section="sect304" set="disabled" />
            </test>
            <choiceSelected section="sect304">
                <pick class="money" count="-3" />
                <pick objectId="cess" />
            </choiceSelected>
        </section>

        <section id="sect29">
            <death />
        </section>

        <section id="sect30">
            <test not="true" expression="[MONEY] >= 8">
                <choiceState section="sect230" set="disabled" />
            </test>
            <choiceSelected section="sect230">
                <pick class="money" count="-8" />
            </choiceSelected>
        </section>

        <section id="sect34">
            <randomTable>
                <pick class="money" count="[RANDOM] + 5" />
            </randomTable>
        </section>

        <section id="sect35">
            <drop objectId="allmeals" />
        </section>
        
        <section id="sect36">
            <death />
        </section>

        <section id="sect37">
            <endurance count="-12" />
            <choiceState section="all" set="disabled" />
            <combat eludeTurn="0" />
            <afterCombats>
                <choiceState section="sect8" set="enabled" />
            </afterCombats>
            <afterElude>
                <choiceState section="sect279" set="enabled" />
            </afterElude>
        </section>

        <section id="sect39">
            <test not="true" hasDiscipline="pthmnshp">
                <choiceState section="sect117" set="disabled" />
            </test>
        </section>

        <section id="sect40">
            <pick class="money" count="27" />
            <object objectId="bottlewine" />
            <object objectId="mirror" />
        </section>

        <section id="sect42">
            <choiceState section="all" set="disabled" />
            <combat eludeTurn="0" />
            <afterCombats>
                <choiceState section="sect86" set="enabled" />
            </afterCombats>
            <afterElude>
                <choiceState section="sect70" set="enabled" />
            </afterElude>
        </section>

        <section id="sect44">
            <endurance count="-2" />
        </section>

        <section id="sect47">
            <choiceState section="all" set="disabled" />
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect48">
            <pick class="money" count="5" />
            <object objectId="maptekaro" />
        </section>

        <section id="sect50">
            <!-- TODO: Descuenta las Coronas de oro que ha apostado -->
        </section>

        <section id="sect51">
            <endurance count="-2" />
        </section>

        <section id="sect52">
            <death />
        </section>

        <section id="sect54">
            <endurance count="-2" />
        </section>

        <section id="sect56">
            <pick class="arrow" count="-1" />
            <choiceState section="all" set="disabled" />
            <randomTable zeroAsTen="true">
                <endurance count="-[RANDOM]" />
                <choiceState section="all" set="enabled" />
            </randomTable>
        </section>

        <section id="sect57">
            <death />
        </section>

        <section id="sect62">
            <!-- TODO: El prestidigitador te paga la cantidad de coronas de oro que has apostado -->
        </section>

        <section id="sect63">
            <test not="true" hasDiscipline="hntmstry">
                <choiceState section="sect162" set="disabled" />
            </test>
            <test hasDiscipline="hntmstry">
                <choiceState section="sect278" set="disabled" />
            </test>
        </section>

        <!-- UP TO sect64 -->
        
    </sections>

</mechanics>