<?xml version="1.0" encoding="utf-8"?>

<mechanics book="12">

    <!-- LIST OF TRANSLATED IMAGES -->
    <translated-images>
        <image>weapons.png</image>
    </translated-images>

    <!-- GAME RULES -->
    <sections>

        <section id="tssf">
            <!-- Restore the endurance to the maximum -->
            <endurance count="+[MAXENDURANCE]" />
            <!-- Drop the previous books map -->
            <drop objectId="map" />
        </section>

        <section id="gamerulz">
            <!-- Select the player skills (weapons skill and endurance) UI -->
            <setSkills />
        </section>

        <section id="discplnz">
            <!-- Select the Kai disciplines UI -->
            <setDisciplines />
        </section>
        
        <section id="equipmnt" pickMaximum="6">
            <!-- Do not pick 2 maps! -->
            <test not="true" hasObject="map" >
                <pick objectId="map" />
            </test>
            <test not="true" hasObject="backpack" >
                <pick objectId="backpack" />
            </test>

            <randomTable>
                <pick class="money" count="[RANDOM] + 10" />
            </randomTable>

            <!-- Kai monastery safekeeping -->
            <kaiMonasteryStorage />

            <object objectId="sword" />
            <object objectId="bow" />
            <object objectId="quiver" count="6" />
            <object objectId="rope" />
            <object objectId="laumspurpotion4" />
            <object objectId="lantern" />
            <object objectId="mace" />
            <object objectId="meal" index="0" />
            <object objectId="meal" index="1" />
            <object objectId="meal" index="2" />
            <object objectId="meal" index="3" />
            <object objectId="dagger" />
            <object objectId="quarterstaff" />
            <object objectId="axe" />

            <chooseEquipment 
                en-text="Click on the Random Table link to get money before continuing" 
                es-text="Haz click en el link de la Tabla de la Suerte para obtener dinero antes de continuar"
            />

            <message 
                en-text="You may take up to six of the following (all meals count as one object):" 
                es-text="Puedes elegir hasta seis de los objetos (todas las comidas cuentan como un objeto):" 
            />

        </section>

        <section id="sect1">
            <choiceState section="all" set="disabled" />
            <randomTable zeroAsTen="true">
                <endurance count="-[RANDOM]" />
                <choiceState section="all" set="enabled" />
            </randomTable>
        </section>

        <section id="sect2">
            <choiceState section="all" set="disabled" />
            <combat mindblastMultiplier="2" />
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect3">
            <death />
        </section>

        <section id="sect4">
            <choiceState section="all" set="disabled" />
            <combat eludeTurn="2" noMindblast="true" />
            <afterCombats>
                <choiceState section="sect91" set="enabled" />
            </afterCombats>
            <afterElude>
                <choiceState section="sect58" set="enabled" />
            </afterElude>
        </section>

        <section id="sect5">
            <pick class="arrow" count="-1" />
            <!-- TODO: Drop a bow. It should be the current bow, but it's not stored what is the current bow. Drop the worst -->
            <drop objectId="jakan|tournamentbow|bow|silverbowduadon" />

            <choiceState section="all" set="disabled" />
            <combat noWeapon="1" />
            <afterCombats>
                <test not="true" expression="[COMBATSDURATION] > 4">
                    <choiceState section="sect232" set="enabled" />
                </test>
                <test expression="[COMBATSDURATION] > 4">
                    <choiceState section="sect148" set="enabled" />
                </test>
            </afterCombats>
        </section>

        <section id="sect6">
            <!-- TODO: Drop sommerswerd here? -->
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case from="0" to="5">
                    <choiceState section="sect275" set="enabled" />
                </case>
                <case from="6" to="99">
                    <choiceState section="sect75" set="enabled" />
                </case>
            </randomTable>
            <test hasCircle="circleSolaris">
                <randomTableIncrement increment="+2" />
                <test hasCircle="circleFire">
                    <randomTableIncrement increment="+1" />
                </test>
            </test>
        </section>

        <section id="sect7">
            <choiceState section="all" set="disabled" />
            <combat noMindblast="true" />
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect8">
            <choiceState section="all" set="disabled" />

            <test not="true" hasDiscipline="dvnation|hntmstry">
                <combat combatSkillModifier="-2" />
                <afterCombatTurn turn="2">
                    <combat combatSkillModifier="0" />
                </afterCombatTurn>
            </test>

            <afterCombats>
                <test not="true" expression="[COMBATSDURATION] > 3">
                    <choiceState section="sect311" set="enabled" />
                </test>
                <test expression="[COMBATSDURATION] > 3">
                    <choiceState section="sect252" set="enabled" />
                </test>
            </afterCombats>
        </section>

        <section id="sect9">
            <endurance count="-3" />
        </section>

        <section id="sect10">
            <choiceState section="sect127" set="disabled" />
            <test hasDiscipline="hntmstry">
                <test expression="[KAILEVEL] >= 6">
                    <choiceState section="sect127" set="enabled" />
                    <choiceState section="sect301" set="disabled" />
                </test>
            </test>
        </section>

        <section id="sect12">
            <!-- you draw a fresh Arrow... (drop previous) -->
            <pick class="arrow" count="-1" />

            <endurance count="-2" />
        </section>

        <section id="sect13">
            <endurance count="-5" />
        </section>

        <section id="sect14">
            <choiceState section="sect215" set="disabled" />
            <test hasDiscipline="invsblty">
                <test expression="[KAILEVEL] >= 5">
                    <choiceState section="sect215" set="enabled" />
                    <choiceState section="sect111" set="disabled" />
                </test>
            </test>
        </section>

        <section id="sect15">
            <choiceState section="all" set="disabled" />
            <message id="msg-sommerswerd" 
                en-text="You cannot use the Sommerswerd on this combat" 
                es-text="No puedes usar la Sommerswerd en este combate"
            />
            <combat noMindblast="true" noPsiSurge="true" disabledObjects="sommerswerd"/>
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect16">
            <choiceState section="all" set="disabled" />

            <test not="true" hasDiscipline="hntmstry">
                <combat combatSkillModifier="-4" />
                <afterCombatTurn turn="2">
                    <combat combatSkillModifier="0" />
                </afterCombatTurn>
            </test>

            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect18">
            <test canUseBow="false">
                <choiceState section="sect264" set="disabled" />
            </test>
        </section>

        <section id="sect19">
            <death />
        </section>

        <section id="sect21">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case from="0" to="6">
                    <choiceState section="sect244" set="enabled" />
                </case>
                <case from="7" to="99">
                    <choiceState section="sect152" set="enabled" />
                </case>
            </randomTable>
            <randomTableIncrement increment="+[KAILEVEL]" />
        </section>

        <section id="sect22">
            <choiceState section="all" set="disabled" />

            <!-- Sommerswerd stuff -->
            <!-- TODO: Disable sommerswerd on sect247 -->
            <message id="msg-sommerswerd" 
                en-text="If you don't want to go to section 247, change the current weapon to other than Sommerswerd" 
                es-text="Si no quieres ir a la secciÃ³n 247, cambia la arma actual a otra que no sea la Sommerswerd"
            />
            <onInventoryEvent>
                <disableCombats disabled="false" />
                <choiceState section="sect247" set="disabled" />
                <test currentWeapon="sommerswerd">
                    <test combatsActive="true">
                        <disableCombats />
                        <choiceState section="sect247" set="enabled" />
                    </test>
                </test>
            </onInventoryEvent>

            <combat eludeTurn="0" />
            <afterCombats>
                <choiceState section="sect349" set="enabled" />
            </afterCombats>
            <afterElude>
                <choiceState section="sect96" set="enabled" />
            </afterElude>
        </section>

        <section id="sect23">
            <choiceState section="all" set="disabled" />

            <combat noMindblast="true" noPsiSurge="true" />
            <test not="true" hasDiscipline="hntmstry">
                <combat noWeapon="1" />
            </test>

            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect25">
            <!-- TODO: Drop arrow? -->
            <test not="true" hasObject="sommerswerd">
                <choiceState section="sect208" set="disabled" />
            </test>
        </section>

        <section id="sect27">
            <choiceState section="all" set="disabled" />
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect29">
            <choiceState section="sect141" set="disabled" />
            <test hasDiscipline="psiscrn">
                <test expression="[KAILEVEL] >= 8">
                    <choiceState section="sect141" set="enabled" />
                    <choiceState section="sect291" set="disabled" />
                </test>
            </test>
        </section>

        <section id="sect32">
            <choiceState section="all" set="disabled" />
            <combat noWeapon="2" />
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect35">
            <choiceState section="all" set="disabled" />
            <combat noMindblast="true" eludeTurn="0" />
            <afterCombats>
                <choiceState section="sect66" set="enabled" />
            </afterCombats>
            <afterElude>
                <choiceState section="sect277" set="enabled" />
            </afterElude>
        </section>

        <section id="sect36">
            <meal />
        </section>

        <section id="sect37">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case from="0" to="3">
                    <choiceState section="sect118" set="enabled" />
                </case>
                <case from="4" to="99">
                    <choiceState section="sect304" set="enabled" />
                </case>
            </randomTable>
            <test hasDiscipline="invsblty">
                <randomTableIncrement increment="+4" />
            </test>
        </section>

        <section id="sect38">
            <death />
        </section>

        <section id="sect39">
            <choiceState section="all" set="disabled" />
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect40">
            <death />
        </section>

        <section id="sect42">
            <endurance count="-4" />
        </section>

        <section id="sect43">
            <!-- TODO: Do not come to this section if you don't have money -->
            <!-- TODO: We should keep the count of the different currencies (Lunes, Gold Crows,...). Unimplemented -->
            <pick class="money" count="-1" />
        </section>

        <section id="sect44">
            <endurance count="-6" />
        </section>

        <section id="sect45">
            <choiceState section="all" set="disabled" />
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect46">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case from="0" to="5">
                    <choiceState section="sect348" set="enabled" />
                </case>
                <case from="6" to="99">
                    <choiceState section="sect70" set="enabled" />
                </case>
            </randomTable>
            <test hasDiscipline="invsblty">
                <test hasDiscipline="psiscrn">
                    <randomTableIncrement increment="+4" />
                </test>
            </test>
        </section>

        <section id="sect47">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case from="0" to="5">
                    <choiceState section="sect204" set="enabled" />
                </case>
                <case from="6" to="99">
                    <choiceState section="sect129" set="enabled" />
                </case>
            </randomTable>
            <test hasCircle="circleSpirit">
                <randomTableIncrement increment="+3" />
            </test>
        </section>

        <section id="sect48">
            <test canUseBow="false">
                <choiceState section="sect324" set="disabled" />
                <!-- TODO: Drop arrow? -->
            </test>
        </section>

        <section id="sect49">
            <pick class="arrow" count="-1" />
            <test canUseBow="false">
                <choiceState section="sect107" set="disabled" />
            </test>
        </section>

        <section id="sect50">
            <endurance count="+[MAXENDURANCE]" />
            <test not="true" hasDiscipline="dvnation">
                <choiceState section="sect203" set="disabled" />
            </test>
            <test hasDiscipline="dvnation">
                <choiceState section="sect102" set="disabled" />
            </test>
        </section>

        <section id="sect52">
            <object objectId="shortsword" />
            <object objectId="dagger" />
            <pick class="money" count="20" currency="kika" />
            <object objectId="rope" />
        </section>

        <section id="sect53">
            <endurance count="-3" />
        </section>

        <section id="sect54">
            <test not="true" hasObject="blackcube">
                <choiceState section="sect40" set="disabled" />
            </test>
            <test hasObject="blackcube">
                <choiceState section="sect320" set="disabled" />
            </test>
        </section>
        
        <section id="sect55">
            <choiceState section="all" set="disabled" />

            <combat turnLoss="-1" />
            <test hasDiscipline="nexus">
                <test expression="[KAILEVEL] >= 9">
                    <combat turnLoss="0" />
                </test>
            </test>

            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect56">
            <test not="true" hasObject="sommerswerd">
                <choiceState section="sect208" set="disabled" />
            </test>
        </section>

        <section id="sect57">
            <currentWeapon objectId="sommerswerd" />
            <!-- TODO: Force to use sommerswerd on this combat? -->
            <choiceState section="all" set="disabled" />
            <afterCombats>
                <test not="true" expression="[COMBATSDURATION] > 3">
                    <choiceState section="sect6" set="enabled" />
                </test>
                <test expression="[COMBATSDURATION] > 3">
                    <choiceState section="sect195" set="enabled" />
                </test>
            </afterCombats>
        </section>

        <section id="sect58">
            <choiceState section="all" set="disabled" />

            <test not="true" hasDiscipline="hntmstry">
                <combat combatSkillModifier="-2" />
                <afterCombatTurn turn="1">
                    <combat combatSkillModifier="0" />
                </afterCombatTurn>
            </test>

            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect59">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case from="0" to="4">
                    <choiceState section="sect233" set="enabled" />
                </case>
                <case from="5" to="99">
                    <choiceState section="sect205" set="enabled" />
                </case>
            </randomTable>
            <test hasCircle="circleLight">
                <test hasCircle="circleSolaris">
                    <randomTableIncrement increment="+3" />
                </test>
            </test>
        </section>

        <section id="sect60">
            <test canUseBow="false">
                <choiceState section="sect270" set="disabled" />
                <!-- TODO: Drop arrow? -->
            </test>
            <test not="true" hasObject="sommerswerd">
                <choiceState section="sect192" set="disabled" />
            </test>
        </section>

        <section id="sect61">
            <!-- TODO: We should keep the count of the different currencies (Lunes, Gold Crows,...). Unimplemented -->
            <numberPicker 
                en-text="Decide how many Gold Crowns you wish to bet"
                es-text="Decide cuÃ¡ntas Coronas de Oro vas a apostar"
                min="1"
                money="true"
                />
            <choiceSelected section="sect265">
                <pick class="money" count="[NUMBERPICKER]*2" />
            </choiceSelected>
            <choiceSelected section="sect225">
                <pick class="money" count="-[NUMBERPICKER]" />
            </choiceSelected>
        </section>

        <section id="sect62">
            <death />
        </section>

        <section id="sect63">
            <pick objectId="kagonitechainmail" />
        </section>

        <section id="sect64">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case from="0" to="3">
                    <choiceState section="sect237" set="enabled" />
                </case>
                <case from="4" to="99">
                    <choiceState section="sect149" set="enabled" />
                </case>
            </randomTable>
            <test hasDiscipline="hntmstry">
                <randomTableIncrement increment="+3" />
            </test>
        </section>

        <section id="sect67">
            <endurance count="-3" />
            <choiceState section="all" set="disabled" />

            <!-- Sommerswerd stuff -->
            <message id="msg-sommerswerd" 
                en-text="If you don't want to go to section 208, change the current weapon to other than Sommerswerd" 
                es-text="Si no quieres ir a la secciÃ³n 208, cambia la arma actual a otra que no sea la Sommerswerd"
            />
            <onInventoryEvent>
                <disableCombats disabled="false" />
                <choiceState section="sect208" set="disabled" />
                <test currentWeapon="sommerswerd">
                    <test combatsActive="true">
                        <disableCombats />
                        <choiceState section="sect208" set="enabled" />
                    </test>
                </test>
            </onInventoryEvent>

            <afterCombats>
                <test not="true" expression="[COMBATSDURATION] > 4">
                    <choiceState section="sect228" set="enabled" />
                </test>
                <test expression="[COMBATSDURATION] > 4">
                    <choiceState section="sect121" set="enabled" />
                </test>
            </afterCombats>
        </section>

        <section id="sect68">
            <choiceState section="all" set="disabled" />

            <combat eludeTurn="1" />
            <onInventoryEvent>
                <combat combatSkillModifier="0" />
                <!-- TODO: Sommerswerd is like a broadword. OK? -->
                <test not="true" currentWeapon="broadsword|spear|quarterstaff">
                    <combat combatSkillModifier="-2" />
                </test>
            </onInventoryEvent>

            <afterCombats>
                <choiceState section="sect51" set="enabled" />
            </afterCombats>
            <afterElude>
                <choiceState section="sect169" set="enabled" />
            </afterElude>
        </section>

        <section id="sect69">
            <death />
        </section>

        <section id="sect72">
            <death />
        </section>

        <section id="sect73">
            <death />
        </section>

        <section id="sect74">
            <choiceState section="all" set="disabled" />
            <test hasDiscipline="nexus">
                <test expression="[KAILEVEL] >= 6">
                    <choiceState section="sect177" set="enabled" />
                </test>
            </test>
            <test not="true" isChoiceEnabled="sect177">
                <randomTable>
                    <case from="0" to="3">
                        <choiceState section="sect42" set="enabled" />
                    </case>
                    <case from="4" to="6">
                        <choiceState section="sect288" set="enabled" />
                    </case>
                    <case from="7" to="9">
                        <choiceState section="sect332" set="enabled" />
                    </case>
                </randomTable>
            </test>
        </section>

        <section id="sect75">
            <choiceState section="all" set="disabled" />

            <!-- Drop / recover Sommerswerd -->
            <drop objectId="sommerswerd" />
            <combat noMindblast="true" />
            <afterCombatTurn turn="3">
                <executeOnce>
                    <pick objectId="sommerswerd" />
                    <currentWeapon objectId="sommerswerd" />
                    <runInventoryEvent />
                </executeOnce>
            </afterCombatTurn>

            <!-- Dammage / CS modifiers -->
            <onInventoryEvent>
                <combat dammageMultiplier="1" />
                <test not="true" currentWeapon="sommerswerd|daggerofvashna">
                    <combat dammageMultiplier="0" />
                </test>

                <combat combatSkillModifier="0" />
                <test currentWeapon="daggerofvashna">
                    <combat combatSkillModifier="+7" />
                </test>
            </onInventoryEvent>

            <afterCombats>
                <choiceState section="all" set="enabled" />
                <!-- Recover sommerswerd if we did not reach turn 3 -->
                <test not="true" hasObject="sommerswerd">
                    <pick objectId="sommerswerd" />
                    <currentWeapon objectId="sommerswerd" />
                </test>
            </afterCombats>

            <test bookLanguage="es">
                <!-- Miss English foot page 2 -->
                <message 
                    es-text="Solo la Daga de Vashna o la Sommerswerd pueden herirle. Si no tienes la Daga, no podrÃ¡s herirle durante los tres primeros turnos" 
                    en-text="This text will not appear" 
                />
            </test>

        </section>

        <section id="sect76">
            <!-- TODO: Crystal Explosive ??? -->
        </section>

        <section id="sect77">
            <choiceState section="sect163" set="disabled" />
            <test hasDiscipline="dvnation">
                <test expression="[KAILEVEL] >= 5">
                    <choiceState section="sect163" set="enabled" />
                    <choiceState section="sect5" set="disabled" />
                </test>
            </test>
        </section>

        <section id="sect79">
            <object objectId="sword" />
            <object objectId="dagger" />
            <object objectId="bow" />
            <object objectId="quiver" />
            <object objectId="arrow" count="4" />
            <pick class="money" count="30" currency="kika" />
        </section>

        <section id="sect80">
            <choiceState section="sect33" set="disabled" />
            <test hasDiscipline="hntmstry">
                <test expression="[KAILEVEL] >= 9">
                    <choiceState section="sect33" set="enabled" />
                    <choiceState section="sect249" set="disabled" />
                </test>
            </test>
        </section>

        <section id="sect82">
            <pick class="arrow" count="-1" />
        </section>

        <section id="sect83">
            <choiceState section="all" set="disabled" />
            <combat immuneTurns="2" />

            <!-- Sommerswerd stuff -->
            <message id="msg-sommerswerd" 
                en-text="If you don't want to go to section 208, change the current weapon to other than Sommerswerd" 
                es-text="Si no quieres ir a la secciÃ³n 208, cambia la arma actual a otra que no sea la Sommerswerd"
            />
            <onInventoryEvent>
                <disableCombats disabled="false" />
                <choiceState section="sect208" set="disabled" />
                <test currentWeapon="sommerswerd">
                    <test combatsActive="true">
                        <disableCombats />
                        <choiceState section="sect208" set="enabled" />
                    </test>
                </test>
            </onInventoryEvent>

            <afterCombats>
                <choiceState section="sect228" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect86">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case from="0" to="6">
                    <choiceState section="sect22" set="enabled" />
                </case>
                <case from="7" to="99">
                    <choiceState section="sect227" set="enabled" />
                </case>
            </randomTable>
            <test hasDiscipline="invsblty">
                <randomTableIncrement increment="+2" />
            </test>
            <test hasDiscipline="hntmstry">
                <test expression="[KAILEVEL] >= 4">
                    <randomTableIncrement increment="+3" />
                </test>
            </test>
        </section>

        <section id="sect88">
            <!-- TODO: Force use Dagger of Vashna or Helshezag on this section? -->
            <choiceState section="all" set="disabled" />
            <combat noMindblast="true" combatSkillModifier="+12" />
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect90">
            <death />
        </section>

        <section id="sect91">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case from="0" to="4">
                    <choiceState section="sect16" set="enabled" />
                </case>
                <case from="5" to="9">
                    <choiceState section="sect194" set="enabled" />
                </case>
            </randomTable>
        </section>

        <section id="sect92">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case from="0" to="6">
                    <choiceState section="sect189" set="enabled" />
                </case>
                <case from="7" to="99">
                    <choiceState section="sect65" set="enabled" />
                </case>
            </randomTable>
            <test hasDiscipline="invsblty">
                <randomTableIncrement increment="+3" />
            </test>
            <test expression="[KAILEVEL] >= 7">
                <randomTableIncrement increment="+2" />
            </test>
        </section>

        <section id="sect93">
            <object objectId="gnallia" useOnSection="true" index="0" />
            <object objectId="gnallia" useOnSection="true" index="1" />
            <object objectId="gnallia" useOnSection="true" index="2" />
            <object objectId="gnallia" useOnSection="true" index="3" />
            <object objectId="gnallia" useOnSection="true" index="4" />
            <object objectId="gnallia" useOnSection="true" index="5" />
            <object objectId="gnallia" useOnSection="true" index="6" />
            <object objectId="gnallia" useOnSection="true" index="7" />
            <object objectId="gnallia" useOnSection="true" index="8" />
            <object objectId="gnallia" useOnSection="true" index="9" />
        </section>

        <section id="sect95">
            <test not="true" hasObject="blackcube">
                <choiceState section="sect40" set="disabled" />
            </test>
            <test hasObject="blackcube">
                <choiceState section="sect320" set="disabled" />
            </test>
        </section>

        <section id="sect96">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case from="0" to="4">
                    <choiceState section="sect72" set="enabled" />
                </case>
                <case from="5" to="99">
                    <choiceState section="sect161" set="enabled" />
                </case>
            </randomTable>
            <test hasCircle="circleLight">
                <test hasCircle="circleSolaris">
                    <randomTableIncrement increment="+3" />
                </test>
            </test>
        </section>

        <section id="sect98">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case from="0" to="4">
                    <choiceState section="sect233" set="enabled" />
                </case>
                <case from="5" to="99">
                    <choiceState section="sect205" set="enabled" />
                </case>
            </randomTable>
            <test hasCircle="circleLight">
                <test hasCircle="circleSolaris">
                    <randomTableIncrement increment="+3" />
                </test>
            </test>
        </section>
        
        <section id="sect99">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <pick class="arrow" count="-1" />
                <case from="-99" to="4">
                    <choiceState section="sect336" set="enabled" />
                </case>
                <case from="5" to="99">
                    <choiceState section="sect212" set="enabled" />
                </case>
            </randomTable>
            <randomTableIncrement increment="+[BOWBONUS]" />
        </section>

        <section id="sect100">
            <choiceState section="all" set="disabled" />
            <combat eludeTurn="0" />
            <afterCombats>
                <choiceState section="sect248" set="enabled" />
            </afterCombats>
            <afterElude>
                <choiceState section="sect7" set="enabled" />
            </afterElude>
        </section>

        <section id="sect101">
            <choiceState section="sect4" set="disabled" />
            <test hasDiscipline="dvnation|hntmstry">
                <choiceState section="sect4" set="enabled" />
                <choiceState section="sect224" set="disabled" />
            </test>
        </section>

        <section id="sect102">
            <choiceState section="all" set="disabled" />
            <combat mindblastMultiplier="2" />
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>
        
        <section id="sect103">
            <choiceSelected section="all">
                <pick class="arrow" count="-1" />
            </choiceSelected>
        </section>

        <section id="sect104">
            <!-- TODO: If you possess the sword Helshezag... -->
            <choiceState section="all" set="disabled" />

            <!-- Sommerswerd stuff -->
            <message id="msg-sommerswerd" 
                en-text="If you don't want to go to section 208, change the current weapon to other than Sommerswerd" 
                es-text="Si no quieres ir a la secciÃ³n 208, cambia la arma actual a otra que no sea la Sommerswerd"
            />
            <onInventoryEvent>
                <disableCombats disabled="false" />
                <choiceState section="sect208" set="disabled" />
                <test currentWeapon="sommerswerd">
                    <test combatsActive="true">
                        <disableCombats />
                        <choiceState section="sect208" set="enabled" />
                    </test>
                </test>
            </onInventoryEvent>

            <afterCombats>
                <choiceState section="sect164" set="enabled" />
            </afterCombats>

        </section>

        <section id="sect107">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <pick class="arrow" count="-1" />
                <case from="-99" to="6">
                    <choiceState section="sect245" set="enabled" />
                </case>
                <case from="7" to="99">
                    <choiceState section="sect211" set="enabled" />
                </case>
            </randomTable>
            <randomTableIncrement increment="+[BOWBONUS]" />
        </section>

        <section id="sect108">
            <choiceState section="all" set="disabled" />
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect109">
            <choiceState section="all" set="disabled" />
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect110">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case from="0" to="4">
                    <choiceState section="sect194" set="enabled" />
                </case>
                <case from="5" to="9">
                    <choiceState section="sect16" set="enabled" />
                </case>
            </randomTable>
        </section>

        <section id="sect111">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case from="-99" to="7">
                    <choiceState section="sect8" set="enabled" />
                </case>
                <case from="8" to="99">
                    <choiceState section="sect279" set="enabled" />
                </case>
            </randomTable>
            <randomTableIncrement increment="[KAILEVEL] - 3" />
        </section>

        <section id="sect113">
            <test canUseBow="false">
                <choiceState section="sect131" set="disabled" />
            </test>
        </section>

        <section id="sect114">
            <choiceState section="all" set="disabled" />
            <combat mindblastMultiplier="2" />
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect117">
            <choiceState section="sect34" set="disabled" />
            <test hasDiscipline="hntmstry">
                <test expression="[KAILEVEL] >= 9">
                    <choiceState section="sect34" set="enabled" />
                    <choiceState section="sect143" set="disabled" />
                </test>
            </test>
        </section>

        <section id="sect118">
            <test canUseBow="false">
                <choiceState section="sect231" set="disabled" />
            </test>
        </section>

        <section id="sect119">
            <pick class="arrow" count="-1" />
        </section>

        <section id="sect120">
            <choiceState section="sect13" set="disabled" />
            <test hasDiscipline="curing">
                <test expression="[KAILEVEL] >= 7">
                    <choiceState section="sect13" set="enabled" />
                    <choiceState section="sect38" set="disabled" />
                </test>
            </test>
        </section>

        <section id="sect121">
            <!-- TODO: Drop Golden Amulet??? -->
            <choiceState section="sect220" set="disabled" />
            <test hasDiscipline="nexus">
                <test expression="[KAILEVEL] >= 9">
                    <choiceState section="sect220" set="enabled" />
                    <choiceState section="sect331" set="disabled" />
                </test>
            </test>
        </section>

        <section id="sect122">
            <death />
        </section>

        <section id="sect124">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case from="0" to="4">
                    <choiceState section="sect342" set="enabled" />
                </case>
                <case from="5" to="99">
                    <choiceState section="sect48" set="enabled" />
                </case>
            </randomTable>
            <test hasCircle="circleSolaris">
                <randomTableIncrement increment="+4" />
            </test>
        </section>

        <section id="sect125">
            <choiceState section="sect296" set="disabled" />
            <test hasDiscipline="hntmstry">
                <test expression="[KAILEVEL] >= 6">
                    <choiceState section="sect296" set="enabled" />
                    <choiceState section="sect327" set="disabled" />
                </test>
            </test>
        </section>

        <section id="sect129">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case from="0" to="6">
                    <choiceState section="sect20" set="enabled" />
                </case>
                <case from="7" to="9">
                    <choiceState section="sect180" set="enabled" />
                </case>
            </randomTable>
        </section>

        <section id="sect130">
            <test hasObject="blackkeybook12">
                <choiceState section="sect29" set="disabled" />
            </test>
            <test not="true" hasObject="blackkeybook12">
                <choiceState section="sect278" set="disabled" />
            </test>
        </section>

        <section id="sect131">
            <pick class="arrow" count="-1" />

            <choiceState section="sect259" set="disabled" />
            <test canUseBow="true">
                <test expression="[ARROWS] >= 2">
                    <choiceState section="sect259" set="enabled" />
                </test>
            </test>
        </section>

        <section id="sect132">
            <death />
        </section>

        <section id="sect133">
            <!-- TODO: Implement Helshezag loss. Don't apply loss on this combat! -->
            <pick objectId="helshezag" />
            <currentWeapon objectId="helshezag" />
            <message id="msg-drop-weapon" 
                en-text="You must use the Helshezag as current weapon on this combat" 
                es-text="Debes usar la Helshezag como arma actual en este combate"
            />

            <onInventoryEvent>
                <disableCombats />
                <test currentWeapon="helshezag">
                    <disableCombats disabled="false" />
                </test>
            </onInventoryEvent>

            <choiceState section="all" set="disabled" />
            <!-- +2 to get +7 with Helshezag -->
            <combat combatSkillModifier="+2" noMindblast="true" />
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>

        </section>

        <section id="sect135">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <pick class="arrow" count="-1" />
                <case from="-99" to="8">
                    <choiceState section="sect313" set="enabled" />
                </case>
                <case from="9" to="99">
                    <choiceState section="sect105" set="enabled" />
                </case>
            </randomTable>
            <randomTableIncrement increment="+[BOWBONUS]" />
        </section>

        <section id="sect136">
            <endurance count="-4" />
            <choiceState section="all" set="disabled" />
            <combat noMindblast="true" noPsiSurge="true" />
            <test not="true" hasDiscipline="hntmstry">
                <combat noWeapon="1" />
            </test>
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect137">
            <meal />
        </section>

        <section id="sect139">
            <object objectId="spear" />
            <object objectId="dagger" />
            <object objectId="axe" />
            <object objectId="pouchtobacco" />
            <object objectId="bottlewine" />
            <object objectId="pipe" />
            <pick class="money" count="60" currency="kika" />
            <object objectId="ironkey" />
            <object objectId="meal" />
        </section>

        <section id="sect141">
            <test not="true" hasObject="blackcube">
                <choiceState section="sect40" set="disabled" />
            </test>
            <test hasObject="blackcube">
                <choiceState section="sect320" set="disabled" />
            </test>
        </section>

        <section id="sect143">
            <test not="true" hasDiscipline="curing">
                <choiceState section="sect93" set="disabled" />
            </test>
            <test hasDiscipline="curing">
                <choiceState section="sect303" set="disabled" />
            </test>
        </section>

        <section id="sect144">
            <choiceState section="sect273" set="disabled" />
            <test hasDiscipline="anmlctrl">
                <test expression="[KAILEVEL] >= 7">
                    <choiceState section="sect273" set="enabled" />
                    <choiceState section="sect98" set="disabled" />
                </test>
            </test>
            <meal />
        </section>

        <section id="sect145">
            <object objectId="pouchadgana" />
        </section>
        
        <section id="sect146">
            <test canUseBow="false">
                <choiceState section="sect99" set="disabled" />
            </test>
        </section>

        <section id="sect148">
            <choiceState section="all" set="disabled" />
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect155">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case from="0" to="2">
                    <choiceState section="sect341" set="enabled" />
                </case>
                <case from="3" to="8">
                    <choiceState section="sect9" set="enabled" />
                </case>
                <case from="9" to="99">
                    <choiceState section="sect319" set="enabled" />
                </case>
            </randomTable>
            <test hasDiscipline="hntmstry">
                <randomTableIncrement increment="+1" />
            </test>
            <test hasCircle="circleSolaris">
                <randomTableIncrement increment="+3" />
            </test>
        </section>

        <section id="sect156">
            <test not="true" hasCircle="circleSolaris">
                <choiceState section="sect190" set="disabled" />
            </test>
            <test hasCircle="circleSolaris">
                <choiceState section="sect56" set="disabled" />
            </test>
        </section>

        <section id="sect157">
            <meal />
            <choiceState section="sect234" set="disabled" />
            <test hasDiscipline="anmlctrl">
                <test hasDiscipline="dvnation">
                    <choiceState section="sect234" set="enabled" />
                    <choiceState section="sect307" set="disabled" />
                </test>
            </test>
        </section>

        <section id="sect158">
            <choiceState section="all" set="disabled" />
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect159">
            <object objectId="broninvest" />
            <object objectId="silverbracers" />
        </section>

        <section id="sect160">
            <choiceState section="all" set="disabled" />
            <combat mindforceEP="-1" />
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect161">
            <choiceState section="all" set="disabled" />
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect162">
            <!-- TODO: We should keep the count of the different currencies (Lunes, Gold Crows,...). Unimplemented -->
            <test not="true" expression="[MONEY] > 0">
                <choiceState section="sect43" set="disabled" />
            </test>
        </section>

        <section id="sect165">
            <choiceState section="sect323" set="disabled" />
            <test hasDiscipline="dvnation">
                <test expression="[KAILEVEL] >= 7">
                    <choiceState section="sect323" set="enabled" />
                    <choiceState section="sect191" set="disabled" />
                </test>
            </test>
        </section>

        <section id="sect166">
            <pick objectId="crystalexplosive" />
            <test not="true" hasObject="sommerswerd">
                <choiceState section="sect282" set="disabled" />
            </test>
            <test hasObject="sommerswerd">
                <choiceState section="sect229" set="disabled" />
            </test>
        </section>

        <section id="sect168">
            <choiceState section="sect329" set="disabled" />
            <test hasDiscipline="psiscrn">
                <test expression="[KAILEVEL] >= 8">
                    <choiceState section="sect329" set="enabled" />
                    <choiceState section="sect258" set="disabled" />
                </test>
            </test>
        </section>

        <section id="sect169">
            <choiceState section="sect219" set="disabled" />
            <test hasDiscipline="invsblty">
                <test hasDiscipline="pthmnshp">
                    <choiceState section="sect219" set="enabled" />
                    <choiceState section="sect84" set="disabled" />
                </test>
            </test>
        </section>

        <section id="sect170">
            <choiceState section="all" set="disabled" />

            <!-- Sommerswerd stuff -->
            <message id="msg-sommerswerd" 
                en-text="If you don't want to go to section 208, change the current weapon to other than Sommerswerd" 
                es-text="Si no quieres ir a la secciÃ³n 208, cambia la arma actual a otra que no sea la Sommerswerd"
            />
            <onInventoryEvent>
                <disableCombats disabled="false" />
                <choiceState section="sect208" set="disabled" />
                <test currentWeapon="sommerswerd">
                    <test combatsActive="true">
                        <disableCombats />
                        <choiceState section="sect208" set="enabled" />
                    </test>
                </test>
            </onInventoryEvent>

            <combat noMindblast="true" noPsiSurge="true" />
            <afterCombats>
                <choiceState section="sect280" set="enabled" />
            </afterCombats>
            
        </section>

        <section id="sect171">
            <!-- TODO: Force Dagger of Vashna as current weapon on this combat? -->
            <choiceState section="all" set="disabled" />
            <currentWeapon objectId="daggerofvashna" />

            <!-- Dammage / CS modifiers -->
            <onInventoryEvent>
                <combat dammageMultiplier="1" />
                <test not="true" currentWeapon="sommerswerd|daggerofvashna">
                    <combat dammageMultiplier="0" />
                </test>

                <combat combatSkillModifier="0" />
                <test currentWeapon="daggerofvashna">
                    <combat combatSkillModifier="+7" />
                </test>
            </onInventoryEvent>

            <combat noMindblast="true" />
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect172">
            <choiceState section="all" set="disabled" />
            <randomTable zeroAsTen="true">
                <test expression="[RANDOM] >= 0">
                    <endurance count="-[RANDOM]" />
                </test>
                <choiceState section="all" set="enabled" />
            </randomTable>
            <test hasCircle="circleSolaris">
                <randomTableIncrement increment="-2" />
            </test>
        </section>

        <section id="sect174">
            <choiceState section="sect234" set="disabled" />
            <test hasDiscipline="anmlctrl">
                <test hasDiscipline="dvnation">
                    <choiceState section="sect307" set="disabled" />
                    <choiceState section="sect234" set="enabled" />
                </test>
            </test>
            <meal />
        </section>

        <section id="sect175">
            <choiceState section="all" set="disabled" />
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect176">
            <test not="true" hasObject="sommerswerd">
                <choiceState section="sect208" set="disabled" />
            </test>

            <test not="true" hasObject="daggerofvashna">
                <test not="true" hasObject="helshezag">
                    <!-- TODO: sect230 add +7 CS -->
                    <choiceState section="sect230" set="disabled" />
                </test>
            </test>

            <choiceState section="sect238" set="disabled" />
            <test hasWeaponType="bow">
                <test hasObject="zejardulaga">
                    <choiceState section="sect238" set="enabled" />
                </test>
            </test>
        </section>

        <section id="sect178">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case from="0" to="7">
                    <choiceState section="sect158" set="enabled" />
                </case>
                <case from="8" to="99">
                    <choiceState section="sect11" set="enabled" />
                </case>
            </randomTable>
            <test hasCircle="circleSolaris">
                <test hasCircle="circleFire">
                    <randomTableIncrement increment="+1" />
                </test>
            </test>
            <test hasDiscipline="anmlctrl">
                <test expression="[KAILEVEL] >= 9">
                    <randomTableIncrement increment="+3" />
                </test>
            </test>
        </section>

        <section id="sect179">
            <object objectId="blackkeybook12" />
            <object objectId="blackcube" />
        </section>

        <section id="sect180">
            <choiceState section="all" set="disabled" />
            <randomTable zeroAsTen="true">
                <endurance count="-[RANDOM]" />
                <choiceState section="all" set="enabled" />
            </randomTable>
        </section>

        <section id="sect181">
            <choiceState section="sect4" set="disabled" />
            <test hasDiscipline="hntmstry|pthmnshp|dvnation">
                <choiceState section="sect224" set="disabled" />
                <choiceState section="sect4" set="enabled" />
            </test>
        </section>

        <section id="sect182">
            <choiceState section="all" set="disabled" />
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect183">
            <endurance count="-4" />
        </section>

        <section id="sect184">
            <!-- TODO: We should keep the count of the different currencies (Lunes, Gold Crows,...). Unimplemented -->
            <test not="true" expression="[MONEY] > 0">
                <choiceState section="sect61" set="disabled" />
            </test>
        </section>

        <section id="sect186">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case from="0" to="8">
                    <choiceState section="sect313" set="enabled" />
                </case>
                <case from="9" to="99">
                    <choiceState section="sect105" set="enabled" />
                </case>
                <pick class="arrow" count="-1" />
            </randomTable>
            <randomTableIncrement increment="+[BOWBONUS]" />
        </section>

        <section id="sect187">
            <object objectId="zejardulaga" />
        </section>

        <section id="sect188">
            <!-- Language differences
                 en: Curing **or** have reached the Kai rank of Principalin or higher
                 es: Medicina **y** has alcanzado el rango de Principal
            -->
            <test bookLanguage="es">
                <choiceState section="sect145" set="disabled" />
                <test hasDiscipline="curing">
                    <test expression="[KAILEVEL] >= 6">
                        <choiceState section="sect145" set="enabled" />
                        <choiceState section="sect201" set="disabled" />
                    </test>
                </test>
            </test>
            
            <test bookLanguage="en">
                <choiceState section="sect145" set="disabled" />
                <test hasDiscipline="curing">
                    <choiceState section="sect145" set="enabled" />
                    <choiceState section="sect201" set="disabled" />
                </test>
                <test expression="[KAILEVEL] >= 6">
                    <choiceState section="sect145" set="enabled" />
                    <choiceState section="sect201" set="disabled" />
                </test>
            </test>
        </section>

        <section id="sect189">
            <choiceState section="all" set="disabled" />
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect190">
            <!-- TODO: Disable Sommerswerd on sect289 -->
            <test not="true" hasObject="sommerswerd">
                <choiceState section="sect208" set="disabled" />
            </test>
        </section>

        <section id="sect191">
            <choiceState section="sect251" set="disabled" />
            <test hasDiscipline="hntmstry">
                <test expression="[KAILEVEL] >= 6">
                    <choiceState section="sect251" set="enabled" />
                    <choiceState section="sect37" set="disabled" />
                </test>
            </test>
        </section>

        <section id="sect192">
            <choiceState section="all" set="disabled" />
            <combat noMindblast="true" />
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect193">
            <!-- TODO: Drop arrow? -->
            <!-- TODO: Disable Sommerswerd on sect289 -->
            <test not="true" hasObject="sommerswerd">
                <choiceState section="sect208" set="disabled" />
            </test>
        </section>

        <section id="sect194">
            <choiceState section="all" set="disabled" />

            <test not="true" hasDiscipline="hntmstry">
                <combat combatSkillModifier="-2" />
                <afterCombatTurn turn="1">
                    <combat combatSkillModifier="0" />
                </afterCombatTurn>
            </test>

            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect195">
            <!-- TODO: Force to use sommerswerd on this combat? -->
            <choiceState section="all" set="disabled" />
            <combat noMindblast="true" />
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect197">
            <choiceState section="sect124" set="disabled" />
            <test hasDiscipline="dvnation">
                <test expression="[KAILEVEL] >= 9">
                    <choiceState section="sect124" set="enabled" />
                    <choiceState section="sect283" set="disabled" />
                </test>
            </test>
        </section>

        <section id="sect198">
            <choiceState section="all" set="disabled" />
            <combat noWeapon="true" />
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect199">
            <death />
        </section>

        <section id="sect200">
            <choiceState section="sect17" set="disabled" />
            <test hasDiscipline="psisurge">
                <test expression="[KAILEVEL] >= 6">
                    <choiceState section="sect17" set="enabled" />
                    <choiceState section="sect314" set="disabled" />
                </test>
            </test>

            <choiceState section="sect167" set="disabled" />
            <test hasDiscipline="invsblty">
                <test expression="[KAILEVEL] >= 8">
                    <choiceState section="sect167" set="enabled" />
                    <choiceState section="sect314" set="disabled" />
                </test>
            </test>
        </section>

        <section id="sect202">
            <!-- TODO: Do not come to this section if you don't have money -->
            <!-- TODO: We should keep the count of the different currencies (Lunes, Gold Crows,...). Unimplemented -->
            <pick class="money" count="-1" />
        </section>

        <section id="sect203">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case from="0" to="6">
                    <choiceState section="sect102" set="enabled" />
                </case>
                <case from="7" to="99">
                    <choiceState section="sect114" set="enabled" />
                </case>
            </randomTable>
            <test hasCircle="circleSpirit">
                <randomTableIncrement increment="+5" />
            </test>
        </section>

        <section id="sect204">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case from="0" to="2">
                    <choiceState section="sect20" set="enabled" />
                </case>
                <case from="3" to="9">
                    <choiceState section="sect180" set="enabled" />
                </case>
            </randomTable>
        </section>

        <section id="sect205">
            <choiceState section="all" set="disabled" />
            <combat noMindblast="true" noPsiSurge="true" />
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect206">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case from="0" to="4">
                    <choiceState section="sect62" set="enabled" />
                </case>
                <case from="5" to="99">
                    <choiceState section="sect123" set="enabled" />
                </case>
            </randomTable>
            <test hasObject="rope|largerope">
                <randomTableIncrement increment="+1" />
            </test>
            <test hasDiscipline="hntmstry">
                <test expression="[KAILEVEL] >= 4">
                    <randomTableIncrement increment="+2" />
                </test>
            </test>
            <test hasCircle="circleSolaris">
                <randomTableIncrement increment="+3" />
            </test>
        </section>

        <section id="sect208">
            <death />
        </section>

        <section id="sect209">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case from="0" to="9">
                    <choiceState section="sect309" set="enabled" />
                </case>
                <case from="10" to="99">
                    <choiceState section="sect151" set="enabled" />
                </case>
            </randomTable>
            <randomTableIncrement increment="[KAILEVEL] - 3" />
        </section>

        <section id="sect210">
            <choiceState section="sect31" set="disabled" />
            <test hasDiscipline="dvnation">
                <test expression="[KAILEVEL] >= 6">
                    <choiceState section="sect31" set="enabled" />
                    <choiceState section="sect345" set="disabled" />
                </test>
            </test>
        </section>

        <section id="sect211">
            <pick class="arrow" count="+1" />
        </section>

        <section id="sect213">
            <choiceState section="all" set="disabled" />
            <combat eludeTurn="2" />
            <afterCombats>
                <choiceState section="sect232" set="enabled" />
            </afterCombats>
            <afterElude>
                <choiceState section="sect274" set="enabled" />
            </afterElude>
        </section>

        <section id="sect216">
            <test not="true" hasDiscipline="psiscrn">
                <choiceState section="sect21" set="disabled" />
            </test>
            <test hasDiscipline="psiscrn">
                <choiceState section="sect267" set="disabled" />
            </test>
        </section>

        <section id="sect217">
            <test not="true" hasDiscipline="curing">
                <choiceState section="sect159" set="disabled" />
            </test>
            <test hasDiscipline="curing">
                <choiceState section="sect41" set="disabled" />
            </test>
        </section>

        <section id="sect220">
            <endurance count="-2" />
        </section>

        <section id="sect221">
            <!-- TODO: We should keep the count of the different currencies (Lunes, Gold Crows,...). Unimplemented -->
            <test not="true" expression="[MONEY] > 0">
                <choiceState section="sect108" set="disabled" />
            </test>
        </section>

        <section id="sect222">
            <choiceState section="sect32" set="disabled" />
            <test hasDiscipline="invsblty">
                <test expression="[KAILEVEL] >= 8">
                    <choiceState section="sect32" set="enabled" />
                    <choiceState section="sect198" set="disabled" />
                </test>
            </test>
        </section>

        <section id="sect224">
            <choiceState section="all" set="disabled" />
            <!-- you are unable to evade combat or draw a weapon until the ***beginning*** of the third round == turn 2-->
            <combat eludeTurn="2" noMindblast="true" noWeapon="2" />
            <afterCombats>
                <choiceState section="sect91" set="enabled" />
            </afterCombats>
            <afterElude>
                <choiceState section="sect58" set="enabled" />
            </afterElude>
        </section>

        <section id="sect226">
            <endurance count="-3" />
            <choiceState section="all" set="disabled" />

            <!-- TODO: "every time this creature inflicts a wound during the combat", so, only if the player loss any EP???. Not sure -->
            <combat turnLoss="-1" />
            <test hasDiscipline="nexus">
                <test expression="[KAILEVEL] >= 9">
                    <combat turnLoss="0" />
                </test>
            </test>

            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect228">
            <object objectId="dagger" />
            <object objectId="sword" />
            <object objectId="axe" />
            <object objectId="shortsword" />
            <pick class="money" count="40" currency="kika" />
            <object objectId="blanket" />
            <object objectId="blackkeybook12" />
        </section>

        <section id="sect229">
            <pick objectId="goldenamulet" />
        </section>
        
        <section id="sect230">

            <message id="msg-drop-weapon" 
                en-text="You must use the Dagger of Vashna or the sword Helshezag as current weapon on this combat" 
                es-text="Debes usar la Daga de Vashna o la espada Helshezag como arma actual en este combate"
            />
            <test hasObject="daggerofvashna">
                <currentWeapon objectId="daggerofvashna" />
            </test>
            <test not="true" hasObject="daggerofvashna">
                <currentWeapon objectId="helshezag" />
            </test>

            <onInventoryEvent>
                <disableCombats />
                <combat combatSkillModifier="0" />
                <test currentWeapon="daggerofvashna|helshezag">
                    <disableCombats disabled="false" />
                    <test currentWeapon="helshezag">
                        <!-- +2 to get +7 with Helshezag -->
                        <combat combatSkillModifier="+2" />
                    </test>
                    <test currentWeapon="daggerofvashna">
                        <!-- +7 with Dagger of Vashna -->
                        <combat combatSkillModifier="+7" />
                    </test>
                </test>
            </onInventoryEvent>

            <choiceState section="all" set="disabled" />
            <combat noMindblast="true" />
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect231">
            <pick class="arrow" count="-1" />

            <choiceState section="all" set="disabled" />
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect233">
            <choiceState section="sect136" set="disabled" />
            <test hasDiscipline="curing">
                <test expression="[KAILEVEL] >= 7">
                    <choiceState section="sect136" set="enabled" />
                    <choiceState section="sect73" set="disabled" />
                </test>
            </test>
        </section>

        <section id="sect235">
            <pick objectId="greenmask" />
        </section>
        
        <section id="sect236">
            <pick class="arrow" count="-1" />
        </section>

        <section id="sect237">
            <endurance count="-1" />
        </section>

        <section id="sect238">
            <drop objectId="zejardulaga" />
        </section>

        <section id="sect239">
            <choiceState section="all" set="disabled" />
            <afterCombats>
                <test not="true" expression="[COMBATSDURATION] > 3">
                    <choiceState section="sect272" set="enabled" />
                </test>
                <test expression="[COMBATSDURATION] > 3">
                    <choiceState section="sect155" set="enabled" />
                </test>
            </afterCombats>
        </section>

        <section id="sect240">
            <test not="true" sectionVisited="sect133">
                <!-- TODO: Check other places where the helshezag can be picked -->
                <object objectId="helshezag" />
            </test>
            <test canUseBow="false">
                <choiceState section="sect310" set="disabled" />
            </test>
        </section>

        <section id="sect241">
            <test not="true" hasDiscipline="anmlctrl">
                <choiceState section="sect305" set="disabled" />
            </test>
            <test hasDiscipline="anmlctrl">
                <choiceState section="sect60" set="disabled" />
            </test>
        </section>

        <section id="sect242">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case from="0" to="6">
                    <choiceState section="sect120" set="enabled" />
                </case>
                <case from="7" to="99">
                    <choiceState section="sect173" set="enabled" />
                </case>
            </randomTable>
            <test hasDiscipline="pthmnshp">
                <test expression="[KAILEVEL] >= 7">
                    <randomTableIncrement increment="+5" />
                </test>
            </test>
        </section>

        <section id="sect243">
            <test not="true" hasDiscipline="dvnation">
                <choiceState section="sect26" set="disabled" />
            </test>
            <test hasDiscipline="dvnation">
                <choiceState section="sect266" set="disabled" />
            </test>
        </section>

        <section id="sect244">
            <endurance count="-4" />
        </section>

        <section id="sect245">
            <!-- TODO: Drop a bow. It should be the current bow, but it's not stored what is the current bow. Drop the worst -->
            <drop objectId="jakan|tournamentbow|bow|silverbowduadon" />
        </section>

        <section id="sect246">
            <object objectId="blackkeybook12" />
        </section>

        <section id="sect247">
            <choiceState section="all" set="disabled" />
            <message id="msg-sommerswerd" 
                en-text="You cannot use the Sommerswerd on this combat" 
                es-text="No puedes usar la Sommerswerd en este combate"
            />
            <combat disabledObjects="sommerswerd" noWeapon="2" eludeTurn="2" />
            <afterCombats>
                <choiceState section="sect349" set="enabled" />
            </afterCombats>
            <afterElude>
                <choiceState section="sect96" set="enabled" />
            </afterElude>
        </section>

        <section id="sect248">
            <choiceState section="all" set="disabled" />
            <combat eludeTurn="2" />
            <afterCombats>
                <choiceState section="sect290" set="enabled" />
            </afterCombats>
            <afterElude>
                <choiceState section="sect7" set="enabled" />
            </afterElude>
        </section>

        <section id="sect249">
            <choiceState section="sect83" set="disabled" />
            <test hasDiscipline="pthmnshp">
                <test expression="[KAILEVEL] >= 5">
                    <choiceState section="sect83" set="enabled" />
                    <choiceState section="sect67" set="disabled" />
                </test>
            </test>
        </section>

        <section id="sect250">
            <death />
        </section>

        <section id="sect252">
            <test not="true" hasDiscipline="hntmstry">
                <choiceState section="sect30" set="disabled" />
            </test>
            <test hasDiscipline="hntmstry">
                <choiceState section="sect132" set="disabled" />
            </test>
        </section>

        <section id="sect253">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case from="0" to="3">
                    <choiceState section="sect122" set="enabled" />
                </case>
                <case from="4" to="7">
                    <choiceState section="sect53" set="enabled" />
                </case>
                <case from="8" to="99">
                    <choiceState section="sect321" set="enabled" />
                </case>
            </randomTable>
            <test hasDiscipline="hntmstry">
                <randomTableIncrement increment="+2" />
            </test>
            <test hasCircle="circleSpirit">
                <randomTableIncrement increment="+3" />
            </test>
        </section>

        <section id="sect255">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case from="0" to="5">
                    <choiceState section="sect90" set="enabled" />
                </case>
                <case from="6" to="99">
                    <choiceState section="sect133" set="enabled" />
                </case>
            </randomTable>
            <randomTableIncrement increment="+[KAILEVEL]" />
        </section>

        <section id="sect256">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case from="0" to="1">
                    <choiceState section="sect20" set="enabled" />
                </case>
                <case from="2" to="9">
                    <choiceState section="sect180" set="enabled" />
                </case>
            </randomTable>
        </section>

        <section id="sect257">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case from="0" to="4">
                    <choiceState section="sect333" set="enabled" />
                </case>
                <case from="5" to="99">
                    <choiceState section="sect112" set="enabled" />
                </case>
            </randomTable>
            <test hasDiscipline="anmlctrl">
                <test expression="[KAILEVEL] >= 9">
                    <randomTableIncrement increment="+4" />
                </test>
            </test>
        </section>

        <section id="sect258">
            <executeOnce>
                <test hasObject="psychicring|greycrystalring">
                    <endurance count="-3" />
                </test>
                <test not="true" hasObject="psychicring|greycrystalring">
                    <endurance count="-8" />
                </test>
            </executeOnce>
        </section>

        <section id="sect259">
            <pick class="arrow" count="-2" />

            <choiceState section="all" set="disabled" />
            <test not="true" hasDiscipline="hntmstry">
                <combat noWeapon="2" />
            </test>
            <afterCombats>
                <test not="true" expression="[COMBATSDURATION] > 3">
                    <choiceState section="sect272" set="enabled" />
                </test>
                <test expression="[COMBATSDURATION] > 3">
                    <choiceState section="sect155" set="enabled" />
                </test>
            </afterCombats>
        </section>

        <section id="sect260">
            <choiceState section="sect298" set="disabled" />
            <test hasDiscipline="dvnation">
                <test expression="[KAILEVEL] >= 7">
                    <choiceState section="sect298" set="enabled" />
                    <choiceState section="sect85" set="disabled" />
                    <choiceState section="sect144" set="disabled" />
                </test>
            </test>
        </section>

        <section id="sect264">
            <pick class="arrow" count="-1" />

            <choiceState section="all" set="disabled" />
            <combat mindblastMultiplier="2" />
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect266">
            <test not="true" hasObject="fireseed">
                <choiceState section="sect302" set="disabled" />
            </test>
        </section>

        <section id="sect267">
            <endurance count="-8" />
        </section>

        <section id="sect268">
            <choiceState section="all" set="disabled" />
            <combat noMindblast="true" />

            <!-- Check turn 1 loss -->
            <afterCombatTurn turn="1">
                <executeOnce>
                    <test expression="[COMBATSENDURANCELOST] > [COMBATSENEMYLOST]">
                        <combat permanentDammage="true" />
                    </test>
                </executeOnce>
            </afterCombatTurn>

            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect269">
            <drop objectId="medal" />
        </section>

        <section id="sect270">
            <choiceState section="sect186" set="disabled" />
            <test hasDiscipline="anmlctrl">
                <test hasDiscipline="dvnation">
                    <choiceState section="sect186" set="enabled" />
                    <choiceState section="sect12" set="disabled" />
                </test>
            </test>
        </section>

        <section id="sect271">
            <object objectId="sword" />
            <object objectId="axe" />
            <object objectId="broadsword" />
            <object objectId="bow" />
            <object objectId="arrow" count="6" />
            <object objectId="quiver" />
            <object objectId="dagger" />
            <object objectId="mace" />
            <pick class="money" count="400" currency="kika" />

            <meal />
        </section>

        <section id="sect273">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case from="0" to="4">
                    <choiceState section="sect59" set="enabled" />
                </case>
                <case from="5" to="99">
                    <choiceState section="sect23" set="enabled" />
                </case>
            </randomTable>
            <test hasDiscipline="hntmstry">
                <test hasDiscipline="pthmnshp">
                    <randomTableIncrement increment="+2" />
                </test>
            </test>
        </section>

        <section id="sect275">
            <!-- TODO: Use sommerswerd only on this combat? -->
            <choiceState section="all" set="disabled" />
            <combat noMindblast="true" />
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

         <section id="sect276">
            <endurance count="-3" />

            <choiceState section="all" set="disabled" />
            <combat noWeapon="2" />

            <combat turnLoss="-1" />
            <test hasDiscipline="nexus">
                <test expression="[KAILEVEL] >= 9">
                    <combat turnLoss="0" />
                </test>
            </test>

            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect277">
            <death />
        </section>

        <section id="sect282">
            <pick objectId="korliniumscabbard" />
        </section>

        <section id="sect284">
            <meal />
        </section>

        <section id="sect286">
            <choiceState section="sect57" set="disabled" />
            <choiceState section="sect171" set="disabled" />
            <test hasObject="sommerswerd">
                <choiceState section="sect57" set="enabled" />
                <choiceState section="sect109" set="disabled" />
            </test>

            <test hasObject="daggerofvashna">
                <choiceState section="sect171" set="enabled" />
                <choiceState section="sect109" set="disabled" />
            </test>
        </section>

        <section id="sect287">
            <!-- TODO: sect324, drop arrow -->
        </section>

        <section id="sect288">
            <endurance count="-2" />
        </section>

        <section id="sect289">
            <choiceState section="all" set="disabled" />
            <combat noMindblast="true" noPsiSurge="true" />
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect290">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case from="0" to="3">
                    <choiceState section="sect122" set="enabled" />
                </case>
                <case from="4" to="7">
                    <choiceState section="sect53" set="enabled" />
                </case>
                <case from="8" to="99">
                    <choiceState section="sect321" set="enabled" />
                </case>
            </randomTable>
            <test hasDiscipline="hntmstry">
                <randomTableIncrement increment="+2" />
            </test>
            <test hasCircle="circleSpirit">
                <randomTableIncrement increment="+3" />
            </test>
        </section>

        <section id="sect291">
            <choiceState section="all" set="disabled" />

            <combat noMindblast="true" />

            <!-- Sommerswerd stuff -->
            <message id="msg-sommerswerd" 
                en-text="If you don't want to go to section 208, change the current weapon to other than Sommerswerd" 
                es-text="Si no quieres ir a la secciÃ³n 208, cambia la arma actual a otra que no sea la Sommerswerd"
            />
            <onInventoryEvent>
                <disableCombats disabled="false" />
                <choiceState section="sect208" set="disabled" />
                <test currentWeapon="sommerswerd">
                    <test combatsActive="true">
                        <disableCombats />
                        <choiceState section="sect208" set="enabled" />
                    </test>
                </test>
            </onInventoryEvent>

            <afterCombats>
                <test not="true" expression="[COMBATSDURATION] > 5">
                    <choiceState section="sect95" set="enabled" />
                </test>
                <test expression="[COMBATSDURATION] > 5">
                    <choiceState section="sect199" set="enabled" />
                </test>
            </afterCombats>
        </section>

        <section id="sect292">
            <choiceState section="all" set="disabled" />
            <combat immuneTurns="2" />
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect294">
            <test not="true" hasDiscipline="dvnation">
                <choiceState section="sect89" set="disabled" />
            </test>
            <test hasDiscipline="dvnation">
                <choiceState section="sect172" set="disabled" />
            </test>
        </section>

        <section id="sect302">
            <drop objectId="fireseed" />
        </section>

        <section id="sect303">
            <choiceState section="sect315" set="disabled" />
            <test hasCircle="circleSolaris">
                <test hasCircle="circleSpirit">
                    <choiceState section="sect315" set="enabled" />
                </test>
            </test>
        </section>

        <section id="sect306">
            <choiceState section="sect214" set="disabled" />
            <choiceState section="sect88" set="disabled" />

            <test hasObject="sommerswerd">
                <choiceState section="sect214" set="enabled" />
                <choiceState section="sect3" set="disabled" />
            </test>

            <test hasObject="daggerofvashna|helshezag">
                <choiceState section="sect88" set="enabled" />
                <!-- "and wish to use either of them", so don't disable sect3 -->
            </test>
        </section>

        <section id="sect307">
            <choiceState section="all" set="disabled" />
            <combat mindblastMultiplier="2" />
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect308">
            <test not="true" hasDiscipline="dvnation">
                <choiceState section="sect179" set="disabled" />
                <object objectId="blackkeybook12" />
                <object objectId="blackcube" />
            </test>
            <test hasDiscipline="dvnation">
                <choiceState section="sect263" set="disabled" />
            </test>
        </section>

        <section id="sect309">
            <test canUseBow="false">
                <choiceState section="sect77" set="disabled" />
            </test>
            <test not="true" hasObject="sommerswerd">
                <choiceState section="sect128" set="disabled" />
            </test>
            <!-- Disable sommerswerd on sect213?: No, it has no real effect -->
        </section>

        <section id="sect310">
            <pick class="arrow" count="-1" />

            <object objectId="spear" />
            <object objectId="axe" />
            <object objectId="dagger" />
            <pick class="money" count="60" currency="kika" />
            <object objectId="bottlewine" />
            <object objectId="pouchtobacco" />
            <object objectId="pipe" />
            <object objectId="ironkey" />
            <object objectId="meal" />
        </section>

        <section id="sect314">
            <!-- TODO: We should keep the count of the different currencies (Lunes, Gold Crows,...). Unimplemented -->
            <test not="true" expression="[MONEY] > 0">
                <choiceState section="sect202" set="disabled" />
                <choiceState section="sect126" set="disabled" />
            </test>

            <test not="true" hasObject="medal">
                <choiceState section="sect269" set="disabled" />
            </test>

            <!-- There is a dead end if you have no money and medal. In this case, let the player choose -->
            <test not="true" expression="[MONEY] > 0">
                <test not="true" hasObject="medal">
                    <choiceState section="sect202" set="enabled" />
                    <choiceState section="sect126" set="enabled" />
                    <choiceState section="sect269" set="enabled" />
                </test>
            </test>
        </section>

        <section id="sect315">
            <test canUseBow="false">
                <choiceState section="sect103" set="disabled" />
            </test>
        </section>

        <section id="sect316">
            <choiceState section="sect124" set="disabled" />
            <test hasDiscipline="dvnation">
                <test expression="[KAILEVEL] >= 9">
                    <choiceState section="sect124" set="enabled" />
                    <choiceState section="sect283" set="disabled" />
                </test>
            </test>
        </section>

        <section id="sect317">
            <object objectId="sword" index="0" />
            <object objectId="sword" index="1" />
            <object objectId="sword" index="2" />
            <object objectId="axe" index="0" />
            <object objectId="axe" index="1" />
            <object objectId="dagger" index="0" />
            <object objectId="dagger" index="1" />
            <object objectId="bow" />
            <object objectId="arrow" count="4" />
            <object objectId="rope" />
            <!-- Pouch of herbs is Adgana. Can be picked only on sect145 -->
        </section>

    </sections>

</mechanics>
