<?xml version="1.0" encoding="utf-8"?>

<mechanics book="15" xmlns="https://127.0.0.1:5000" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="https://raw.githubusercontent.com/cracrayol/kaichronicles/master/src/www/data/mechanics.xsd">

    <!-- LIST OF TRANSLATED IMAGES -->
    <translated-images>
        <image>weapons.png</image>
    </translated-images>

    <!-- GAME RULES -->
    <sections>

        <section id="tssf">
            <!-- Restore the endurance to the maximum -->
            <endurance count="+[MAXENDURANCE]" />
            <!-- Drop the previous books map -->
            <drop objectId="map" />
            <!-- Restore Deliverance use each X days -->
            <restoreDeliveranceUse />
        </section>

        <section id="gamerulz">
            <!-- Select the player skills (weapons skill and endurance) UI -->
            <setSkills />
        </section>

        <section id="discplnz">
            <!-- Select the Kai disciplines UI -->
            <setDisciplines />
        </section>
        
        <section id="equipmnt" pickMaximum="5">
            <!-- Do not pick 2 maps! -->
            <test not="true" hasObject="map" >
                <pick objectId="map" />
            </test>
            <test not="true" hasObject="backpack" >
                <pick objectId="backpack" />
            </test>

            <randomTable>
                <pick class="money" count="[RANDOM] + 20" />
            </randomTable>

            <!-- Kai monastery safekeeping -->
            <kaiMonasteryStorage />

            <object objectId="sword" />
            <object objectId="bow" />
            <object objectId="quiver" count="6" />
            <object objectId="axe" />
            <object objectId="meal" index="0" />
            <object objectId="meal" index="1" />
            <object objectId="meal" index="2" />
            <object objectId="meal" index="3" />
            <object objectId="rope" />
            <object objectId="laumspurpotion4" />
            <object objectId="spear" />
            <object objectId="dagger" />

            <chooseEquipment 
                en-text="Click on the Random Table link to get money before continuing" 
                es-text="Haz click en el link de la Tabla de la Suerte para obtener dinero antes de continuar"
            />

            <message 
                en-text="You may take up to five of the following (all meals count as one object):" 
                es-text="Puedes elegir hasta cinco de los objetos (todas las comidas cuentan como un objeto):" 
            />

        </section>

        <section id="sect3">
            <endurance count="-3" />
        </section>

        <section id="sect6">
            <choiceState section="all" set="disabled" />
            <combat combatSkillModifier="3" />
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect7">
            <choiceState section="all" set="disabled" />
            <combat />
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect10">
            <object objectId="signetringbook15" />
            <object objectId="bow" />
            <object objectId="arrow" count="3" />
            <object objectId="sword" />
            <object objectId="laumspurpotion4" index="0" />
            <object objectId="laumspurpotion4" index="1" />
            <object objectId="hourglass" />
            <object objectId="brasskey" />
            <object objectId="dagger" />
        </section>

        <section id="sect11">
            <choiceState section="sect240" set="disabled" />
            <test hasDiscipline="pthmnshp">
                <test expression="[KAILEVEL] >= 6 ">
                    <choiceState section="sect240" set="enabled" />
                    <choiceState section="sect281" set="disabled" />
                </test>
            </test>
        </section>

        <section id="sect12">
            <object objectId="meal" />
            <object objectId="dagger" />
            <object objectId="sword" index="0" />
            <object objectId="sword" index="1" />
            <object objectId="bow" />
            <object objectId="arrow" count="4" />
        </section>

        <section id="sect13">
            <endurance count="-4" />
        </section>

        <section id="sect14">
            <choiceState section="sect308" set="disabled" />
            <test hasDiscipline="alchemy">
                <choiceState section="sect308" set="enabled" />
                <choiceState section="sect45" set="disabled" />
            </test>
        </section>

        <section id="sect15">
            <choiceState section="sect214" set="disabled" />
            <test hasDiscipline="hntmstry|pthmnshp">
                <choiceState section="sect214" set="enabled" />
                <choiceState section="sect229" set="disabled" />
            </test>
        </section>

        <section id="sect18">
            <choiceState section="sect256" set="disabled" />
            <test hasDiscipline="pthmnshp">
                <test expression="[KAILEVEL] >= 6 ">
                    <choiceState section="sect256" set="enabled" />
                    <choiceState section="sect6" set="disabled" />
                </test>
            </test>
        </section>

        <section id="sect20">
            <choiceState section="sect76" set="disabled" />
            <test canUseBow="true">
                <choiceState section="sect76" set="enabled" />
            </test>
        </section>

        <section id="sect22">
            <choiceState section="sect332" set="disabled" />
            <choiceState section="sect312" set="disabled" />
            <test hasDiscipline="alchemy">
                <choiceState section="sect332" set="enabled" />
                <choiceState section="sect289" set="disabled" />
            </test>
            <test hasDiscipline="kaisurge">
                <test expression="[KAILEVEL] >= 5 ">
                    <choiceState section="sect312" set="enabled" />
                    <choiceState section="sect289" set="disabled" />
                </test>
            </test>
        </section>

        <section id="sect23">
            <object objectId="arrow" count="6" />
            <object objectId="quiver" />
            <object objectId="dagger" />
            <object objectId="sword" />
            <object objectId="spear" />
        </section>

        <!-- TODO sect25 : detect if you met Captain Prarg at the Battle of Cetza / Book 10 - not an important choice -->

        <section id="sect27">
            <drop objectId="silverrod" />
        </section>

        <section id="sect29">
            <endurance count="-6" />
        </section>

        <section id="sect30">
            <choiceState section="sect340" set="disabled" />
            <test hasDiscipline="alchemy">
                <choiceState section="sect340" set="enabled" />
                <choiceState section="sect138" set="disabled" />
            </test>
        </section>

        <section id="sect31">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case to="3">
                    <choiceState section="sect246" set="enabled" />
                </case>
                <case from="4" to="7">
                    <choiceState section="sect87" set="enabled" />
                </case>
                <case from="8">
                    <choiceState section="sect165" set="enabled" />
                </case>
            </randomTable>
            <test hasDiscipline="anmlmstr">
                <randomTableIncrement increment="+3" />
            </test>
            <test expression="[KAILEVEL] >= 5 ">
                <randomTableIncrement increment="+1" />
            </test>
        </section>

        <section id="sect32">
            <choiceState section="all" set="disabled" />
            <combat mindblastMultiplier="2" />
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect33">
            <endurance count="+3" />
            <object objectId="floroa" />
        </section>

        <section id="sect35">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case to="4">
                    <choiceState section="sect153" set="enabled" />
                </case>
                <case from="5">
                    <choiceState section="sect28" set="enabled" />
                </case>
            </randomTable>
            <test hasDiscipline="hntmstry">
                <randomTableIncrement increment="+3" />
            </test>
        </section>

        <section id="sect37">
            <choiceState section="sect211" set="disabled" />
            <test hasObject="rope">
                <choiceState section="sect211" set="enabled" />
                <choiceState section="sect346" set="disabled" />
            </test>
        </section>

        <section id="sect38">
            <meal />
        </section>

        <section id="sect40">
            <choiceState section="sect196" set="disabled" />
            <test hasDiscipline="hntmstry">
                <choiceState section="sect196" set="enabled" />
                <choiceState section="sect126" set="disabled" />
            </test>
        </section>

        <section id="sect42">
            <choiceState section="sect271" set="disabled" />
            <test hasObject="sommerswerd">
                <choiceState section="sect271" set="enabled" />
                <choiceState section="sect134" set="disabled" />
            </test>
        </section>

        <section id="sect44">
            <choiceState section="all" set="disabled" />
            <combat />
            <afterCombatTurn turn="6">
                <disableCombats />
                <test combatsWon="false">
                    <choiceState section="sect155" set="enabled" />
                </test>
            </afterCombatTurn>
            <afterCombats>
                <test not="true" expression="[COMBATSDURATION] >= 7">
                    <choiceState section="sect264" set="enabled" />
                </test>
            </afterCombats>
        </section>

        <section id="sect46">
            <object objectId="bow" />
            <object objectId="arrow" count="2" />
            <object objectId="meal" index="0" />
            <object objectId="meal" index="1" />
            <object objectId="potionofstrength" />
            <object objectId="bottlewine" />
            <object objectId="bowstring" />
        </section>

        <section id="sect47">
            <choiceState section="sect180" set="disabled" />
            <test canUseBow="true">
                <choiceState section="sect180" set="enabled" />
            </test>
        </section>

        <section id="sect49">
            <endurance count="-2" />
        </section>

        <section id="sect50">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case to="4">
                    <choiceState section="sect116" set="enabled" />
                </case>
                <case from="5">
                    <choiceState section="sect259" set="enabled" />
                </case>
            </randomTable>
            <test hasDiscipline="assimila">
                <randomTableIncrement increment="+3" />
            </test>
        </section>

        <section id="sect54">
            <choiceState section="all" set="disabled" />
            <combat />
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect56">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case to="4">
                    <choiceState section="sect117" set="enabled" />
                </case>
                <case from="5">
                    <choiceState section="sect298" set="enabled" />
                </case>
            </randomTable>
        </section>

        <section id="sect57">
            <choiceState section="all" set="disabled" />
            <combat />
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect58">
            <endurance count="-1" />
        </section>

        <section id="sect59">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case to="5">
                    <choiceState section="sect268" set="enabled" />
                </case>
                <case from="6">
                    <choiceState section="sect151" set="enabled" />
                </case>
            </randomTable>
            <test expression="[KAILEVEL] == 5 ">
                <randomTableIncrement increment="+1" />
            </test>
            <test expression="[KAILEVEL] >= 6 ">
                <randomTableIncrement increment="+2" />
            </test>
        </section>

        <section id="sect63">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case to="2">
                    <choiceState section="sect82" set="enabled" />
                </case>
                <case from="3">
                    <choiceState section="sect348" set="enabled" />
                </case>
            </randomTable>
            <test expression="[ENDURANCE] >= 12">
                <randomTableIncrement increment="+2" />
            </test>
        </section>

        <section id="sect66">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case to="3">
                    <choiceState section="sect128" set="enabled" />
                </case>
                <case from="4" to="6">
                    <choiceState section="sect75" set="enabled" />
                </case>
                <case from="7">
                    <choiceState section="sect179" set="enabled" />
                </case>
            </randomTable>
            <test hasDiscipline="hntmstry">
                <test expression="[KAILEVEL] >= 5">
                    <randomTableIncrement increment="+2" />
                </test>
            </test>
        </section>

        <section id="sect68">
            <drop objectId="meal" />
        </section>

        <section id="sect69">
            <choiceState section="sect278" set="disabled" />
            <test canUseBow="true">
                <choiceState section="sect278" set="enabled" />
            </test>
        </section>

        <section id="sect70">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case to="2">
                    <choiceState section="sect132" set="enabled" />
                </case>
                <case from="3" to="6">
                    <choiceState section="sect205" set="enabled" />
                </case>
                <case from="7">
                    <choiceState section="sect92" set="enabled" />
                </case>
            </randomTable>
            <test hasDiscipline="pthmnshp">
                <randomTableIncrement increment="+2" />
            </test>
        </section>

        <section id="sect71">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case to="6">
                    <choiceState section="sect21" set="enabled" />
                </case>
                <case from="7">
                    <choiceState section="sect267" set="enabled" />
                </case>
            </randomTable>
        </section>

        <section id="sect72">
            <meal />
        </section>

        <section id="sect75">
            <choiceState section="all" set="disabled" />
            <combat />
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect76">
            <pick class="arrow" count="-1" />
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case to="4">
                    <choiceState section="sect174" set="enabled" />
                </case>
                <case from="5">
                    <choiceState section="sect258" set="enabled" />
                </case>
            </randomTable>
        </section>

        <section id="sect78">
            <choiceState section="sect102" set="disabled" />
            <test hasDiscipline="anmlmstr">
                <choiceState section="sect102" set="enabled" />
                <choiceState section="sect318" set="disabled" />
            </test>
        </section>

        <section id="sect80">
            <choiceState section="sect202" set="disabled" />
            <test hasDiscipline="pthmnshp">
                <choiceState section="sect202" set="enabled" />
                <choiceState section="sect159" set="disabled" />
            </test>
        </section>

        <section id="sect81">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case to="4">
                    <choiceState section="sect226" set="enabled" />
                </case>
                <case from="5">
                    <choiceState section="sect199" set="enabled" />
                </case>
            </randomTable>
            <test hasDiscipline="pthmnshp">
                <randomTableIncrement increment="+2" />
            </test>
        </section>

        <section id="sect82">
            <death />
        </section>

        <section id="sect84">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case to="4">
                    <choiceState section="sect279" set="enabled" />
                </case>
                <case from="5">
                    <choiceState section="sect51" set="enabled" />
                </case>
            </randomTable>
        </section>

        <section id="sect85">
            <choiceState section="sect136" set="disabled" />
            <test hasDiscipline="alchemy">
                <choiceState section="sect136" set="enabled" />
                <choiceState section="sect253" set="disabled" />
            </test>
        </section>

        <section id="sect86">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case to="4">
                    <choiceState section="sect29" set="enabled" />
                </case>
                <case from="5">
                    <choiceState section="sect287" set="enabled" />
                </case>
            </randomTable>
            <test expression="[ENDURANCE] >= 20">
                <randomTableIncrement increment="+2" />
            </test>
        </section>

        <section id="sect89">
            <numberPicker 
                en-text="Choose the number"
                es-text="Elige el número"
                min="1" max="350" 
                en-actionButton="Choose"
                es-actionButton="Elige"
                />
            <numberPickerChoosed>
                <test expression="[NUMBERPICKER] == 40">
                    <goToSection section="sect40" />
                </test>
                <test expression="[NUMBERPICKER] != 40">
                    <goToSection section="sect30" />
                </test>
            </numberPickerChoosed>
        </section>

        <section id="sect93">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case to="0">
                    <choiceState section="sect291" set="enabled" />
                </case>
                <case from="1" to="3">
                    <choiceState section="sect13" set="enabled" />
                </case>
                <case from="4">
                    <choiceState section="sect171" set="enabled" />
                </case>
            </randomTable>
        </section>

        <section id="sect94">
            <choiceState section="sect110" set="disabled" />
            <test hasDiscipline="magi">
                <choiceState section="sect110" set="enabled" />
                <choiceState section="sect326" set="disabled" />
            </test>
        </section>

        <section id="sect96">
            <object objectId="lantern" />
            <object objectId="rope" />
            <object objectId="dagger" />
            <object objectId="meal" index="0" />
            <object objectId="meal" index="1" />
            <object objectId="hourglass" />
        </section>

        <section id="sect100">
            <choiceState section="sect223" set="disabled" />
            <test hasDiscipline="assimila">
                <choiceState section="sect223" set="enabled" />
                <choiceState section="sect59" set="disabled" />
            </test>
        </section>

        <section id="sect101">
            <choiceState section="sect241" set="disabled" />
            <test canUseBow="true">
                <choiceState section="sect241" set="enabled" />
            </test>
        </section>

        <section id="sect102">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case to="5">
                    <choiceState section="sect218" set="enabled" />
                </case>
                <case from="6">
                    <choiceState section="sect119" set="enabled" />
                </case>
            </randomTable>
            <randomTableIncrement increment="[KAILEVEL] - 2" />
        </section>

        <section id="sect105">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <test expression="[RANDOM] % 2 == 0">
                    <choiceState section="sect267" set="enabled" />
                </test>
                <test expression="[RANDOM] % 2 == 1">
                    <choiceState section="sect21" set="enabled" />
                </test>
            </randomTable>
        </section>

        <section id="sect106">
        </section>

        <section id="sect107">
            <choiceState section="sect129" set="disabled" />
            <test hasDiscipline="anmlmstr">
                <test expression="[KAILEVEL] >= 5">
                    <choiceState section="sect129" set="enabled" />
                    <choiceState section="sect88" set="disabled" />
                </test>
            </test>
        </section>

        <section id="sect108">
        </section>

        <section id="sect109">
            <choiceState section="sect304" set="disabled" />
            <test hasObject="greenkey">
                <choiceState section="sect304" set="enabled" />
                <choiceState section="sect89" set="disabled" />
            </test>
        </section>

        <section id="sect111">
            <choiceState section="all" set="disabled" />
            <combat />
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect113">
            <choiceState section="all" set="disabled" />
            <combat />
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect115">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case to="2">
                    <choiceState section="sect288" set="enabled" />
                </case>
                <case from="3" to="6">
                    <choiceState section="sect145" set="enabled" />
                </case>
                <case from="7">
                    <choiceState section="sect342" set="enabled" />
                </case>
            </randomTable>
        </section>

        <section id="sect116">
            <choiceState section="all" set="disabled" />
            <combat />
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect118">
            <choiceState section="sect270" set="disabled" />
            <test canUseBow="true">
                <choiceState section="sect270" set="enabled" />
            </test>
        </section>

        <section id="sect121">
            <choiceState section="all" set="disabled" />
            <combat noMindblast="true" noPsiSurge="true" kaiSurgeBonus="1" />
            <test hasDiscipline="alchemy">
                <test expression="[KAILEVEL] >= 5">
                    <combat noMindblast="true" noPsiSurge="true" kaiSurgeBonus="1" combatSkillModifier="+5" />
                    <endurance count="+5" noToast="true" permanent="true" />
                </test>
            </test>
            <afterCombats>
                <test hasDiscipline="alchemy">
                    <test expression="[KAILEVEL] >= 5">
                        <test expression="[ENDURANCE] &lt;= 5">
                            <endurance count="6 - [ENDURANCE]" noToast="true" />
                        </test>
                        <endurance count="-5" noToast="true" permanent="true" />
                    </test>
                </test>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect122">
            <choiceState section="all" set="disabled" />
            <combat />
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect128">
            <death />
        </section>

        <section id="sect131">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case to="4">
                    <choiceState section="sect216" set="enabled" />
                </case>
                <case from="5">
                    <choiceState section="sect46" set="enabled" />
                </case>
            </randomTable>
        </section>

        <section id="sect132">
            <endurance count="-4" />
        </section>

        <section id="sect133">
            <endurance count="-3" />
        </section>

        <section id="sect134">
            <test not="true" hasDiscipline="kaiscrn">
                <endurance count="-5" />
            </test>
        </section>

        <section id="sect139">
            <choiceState section="sect110" set="disabled" />
            <test hasDiscipline="magi">
                <choiceState section="sect110" set="enabled" />
                <choiceState section="sect326" set="disabled" />
            </test>
        </section>

        <section id="sect142">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case to="2">
                    <choiceState section="sect206" set="enabled" />
                </case>
                <case from="3" to="6">
                    <choiceState section="sect337" set="enabled" />
                </case>
                <case from="7">
                    <choiceState section="sect164" set="enabled" />
                </case>
            </randomTable>
        </section>

        <section id="sect144">
            <meal />
        </section>

        <section id="sect145">
            <endurance count="-3" />
        </section>

        <section id="sect147">
            <choiceState section="all" set="disabled" />
            <randomTable zeroAsTen="true">
                <endurance count="-[RANDOM]" />
                <test canUseBow="true">
                    <choiceState section="sect241" set="enabled" />
                </test>
                <choiceState section="sect113" set="enabled" />
            </randomTable>
        </section>

        <section id="sect148">
            <meal />
        </section>

        <section id="sect153">
            <endurance count="-3" />
        </section>

        <section id="sect154">
            <choiceState section="all" set="disabled" />
            <combat />
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect156">
            <test expression="[ENDURANCE] > 15">
                <endurance count="-([ENDURANCE] - 15)" />
            </test>
            <drop objectId="allmeals" />
            <!-- TODO Drop potions -->
        </section>

        <section id="sect158">
            <choiceState section="sect17" set="disabled" />
            <choiceState section="sect86" set="disabled" />
            <test hasDiscipline="alchemy">
                <test expression="[KAILEVEL] >= 6">
                    <choiceState section="sect17" set="enabled" />
                </test>
                <test not="true" expression="[KAILEVEL] >= 6">
                    <choiceState section="sect86" set="enabled" />
                </test>
                <choiceState section="sect345" set="disabled" />
            </test>
        </section>

        <section id="sect159">
            <choiceState section="sect19" set="disabled" />
            <test hasDiscipline="assimila">
                <test expression="[KAILEVEL] >= 5">
                    <choiceState section="sect19" set="enabled" />
                    <choiceState section="sect93" set="disabled" />
                </test>
            </test>
        </section>

        <section id="sect160">
            <endurance count="-3" />
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case to="5">
                    <choiceState section="sect153" set="enabled" />
                </case>
                <case from="6">
                    <choiceState section="sect28" set="enabled" />
                </case>
            </randomTable>
            <test hasDiscipline="hntmstry">
                <randomTableIncrement increment="+3" />
            </test>
        </section>

        <section id="sect163">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case to="6">
                    <choiceState section="sect242" set="enabled" />
                </case>
                <case from="7">
                    <choiceState section="sect99" set="enabled" />
                </case>
            </randomTable>
            <test hasDiscipline="kaisurge">
                <randomTableIncrement increment="+4" />
            </test>
        </section>

        <section id="sect167">
            <endurance count="-4" />
        </section>

        <section id="sect173">
            <endurance count="+3" />
            <choiceState section="sect227" set="disabled" />
            <test hasDiscipline="anmlmstr">
                <test expression="[KAILEVEL] >= 5">
                    <choiceState section="sect227" set="enabled" />
                    <choiceState section="sect131" set="disabled" />
                </test>
            </test>
        </section>

        <section id="sect175">
            <choiceState section="sect240" set="disabled" />
            <test hasDiscipline="pthmnshp">
                <test expression="[KAILEVEL] >= 6">
                    <choiceState section="sect240" set="enabled" />
                    <choiceState section="sect281" set="disabled" />
                </test>
            </test>
        </section>

        <section id="sect176">
            <endurance count="-5" />
        </section>

        <section id="sect178">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case to="4">
                    <choiceState section="sect237" set="enabled" />
                </case>
                <case from="5">
                    <choiceState section="sect58" set="enabled" />
                </case>
            </randomTable>
            <test hasDiscipline="hntmstry">
                <randomTableIncrement increment="+1" />
            </test>
        </section>

        <section id="sect179">
            <choiceState section="all" set="disabled" />
            <combat />
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect180">
            <pick class="arrow" count="-3" />
        </section>

        <section id="sect181">
            <death />
        </section>

        <section id="sect182">
            <choiceState section="sect241" set="disabled" />
            <test canUseBow="true">
                <choiceState section="sect241" set="enabled" />
            </test>
        </section>

        <section id="sect185">
            <meal />
        </section>

        <section id="sect186">
            <endurance count="-3" />
        </section>

        <section id="sect187">
            <choiceState section="sect68" set="disabled" />
            <test expression="[MEALS] > 0">
                <choiceState section="sect68" set="enabled" />
                <choiceState section="sect282" set="disabled" />
            </test>
        </section>

        <section id="sect188">
            <endurance count="+3" />
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case to="4">
                    <choiceState section="sect73" set="enabled" />
                </case>
                <case from="5">
                    <choiceState section="sect293" set="enabled" />
                </case>
            </randomTable>
        </section>

        <section id="sect189">
            <meal />
        </section>

        <section id="sect190">
            <endurance count="-1" />
        </section>

        <section id="sect191">
            <choiceState section="sect214" set="disabled" />
            <test hasDiscipline="pthmnshp|hntmstry">
                <choiceState section="sect214" set="enabled" />
                <choiceState section="sect229" set="disabled" />
            </test>
        </section>

        <section id="sect192">
            <choiceState section="sect55" set="disabled" />
            <test hasDiscipline="pthmnshp">
                <test expression="[KAILEVEL] >= 6">
                    <choiceState section="sect55" set="enabled" />
                    <choiceState section="sect37" set="disabled" />
                </test>
            </test>
        </section>

        <section id="sect193">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case to="6">
                    <choiceState section="sect210" set="enabled" />
                </case>
                <case from="7">
                    <choiceState section="sect114" set="enabled" />
                </case>
            </randomTable>
            <test hasDiscipline="hntmstry">
                <randomTableIncrement increment="+2" />
            </test>
            <test hasObject="rope">
                <randomTableIncrement increment="+1" />
            </test>
            <test expression="[KAILEVEL] >= 5">
                <randomTableIncrement increment="+1" />
            </test>
        </section>

        <section id="sect194">
            <endurance count="-4" />
        </section>

        <section id="sect198">
            <choiceState section="all" set="disabled" />
            <combat immuneTurns="1" />
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect199">
            <endurance count="-1" />
        </section>

        <section id="sect203">
            <drop backpackItemSlots="1|4" />
            <message id="msg-drop-object" 
                en-text="Drop one Special Item of your choice or your bow" 
                es-text="Deja el Objeto Especial que prefieras o su arco"
            />
            <onInventoryEvent>
                <test expression="([SPECIAL-ITEMS-ON-ACTIONCHART] == 0 &amp;&amp; [BOW-CNT-ON-ACTIONCHART] == 0) || [SPECIAL-ITEMS-ON-SECTION] >= 1 || [BOW-CNT-ON-SECTION] >= 1">
                    <message id="msg-drop-object" op="hide" />
                    <choiceState section="all" set="enabled" />
                </test>
                <test not="true" expression="([SPECIAL-ITEMS-ON-ACTIONCHART] == 0 &amp;&amp; [BOW-CNT-ON-ACTIONCHART] == 0) || [SPECIAL-ITEMS-ON-SECTION] >= 1 || [BOW-CNT-ON-SECTION] >= 1">
                    <message id="msg-drop-object" op="show" />
                    <choiceState section="all" set="disabled" />
                </test>
            </onInventoryEvent>
        </section>

        <section id="sect204">
            <choiceState section="sect169" set="disabled" />
            <test hasObject="signetringbook15">
                <choiceState section="sect169" set="enabled" />
                <choiceState section="sect57" set="disabled" />
            </test>
        </section>

        <section id="sect206">
            <endurance count="-4" />
            <choiceState section="all" set="disabled" />
            <combat />
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect207">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case to="7">
                    <choiceState section="sect147" set="enabled" />
                </case>
                <case from="8">
                    <choiceState section="sect255" set="enabled" />
                </case>
            </randomTable>
            <test expression="[ENDURANCE] >= 20">
                <randomTableIncrement increment="+1" />
            </test>
        </section>

        <section id="sect208">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case to="4">
                    <choiceState section="sect81" set="enabled" />
                </case>
                <case from="5">
                    <choiceState section="sect275" set="enabled" />
                </case>
            </randomTable>
            <test hasDiscipline="pthmnshp">
                <randomTableIncrement increment="+3" />
            </test>
        </section>

        <section id="sect209">
            <endurance count="-8" />
            <choiceState section="sect181" set="disabled" />
            <test not="true" expression="[ENDURANCE] > 15">
                <choiceState section="sect181" set="enabled" />
                <choiceState section="sect301" set="disabled" />
            </test>
        </section>

        <section id="sect210">
            <death />
        </section>

        <section id="sect211">
            <endurance count="-3" />
        </section>

        <section id="sect212">
            <!-- TODO only remove 1 use for sabitojar -->
            <drop objectId="oedeherb|oedejar|sabitojar" />
            <choiceState section="sect304" set="disabled" />
            <test hasObject="greenkey">
                <choiceState section="sect304" set="enabled" />
                <choiceState section="sect89" set="disabled" />
            </test>
        </section>

        <section id="sect213">        
            <object objectId="dagger" />
            <object objectId="sword" />
            <object objectId="laumspurpotion4" index="0" />
            <object objectId="laumspurpotion4" index="1" />
            <object objectId="hourglass" />
            <object objectId="signetringbook15" />
            <object objectId="bow" />
            <object objectId="arrow" count="3" />
            <object objectId="brasskey" />
        </section>

        <section id="sect216">
            <meal />
        </section>

        <section id="sect217">
            <choiceState section="sect331" set="disabled" />
            <choiceState section="sect9" set="disabled" />
            <choiceState section="sect152" set="disabled" />
            <test hasDiscipline="anmlmstr">
                <choiceState section="sect331" set="enabled" />
            </test>
            <test hasDiscipline="kaisurge">
                <choiceState section="sect9" set="enabled" />
            </test>
            <test hasDiscipline="alchemy">
                <choiceState section="sect152" set="enabled" />
            </test>
        </section>

        <section id="sect218">
            <choiceState section="all" set="disabled" />
            <combat />
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect220">
            <choiceState section="sect27" set="disabled" />
            <test hasObject="silverrod">
                <choiceState section="sect27" set="enabled" />
                <choiceState section="sect290" set="disabled" />
            </test>
        </section>

        <section id="sect221">
            <numberPicker 
                en-text="Choose the number"
                es-text="Elige el número"
                min="1" max="350" 
                en-actionButton="Choose"
                es-actionButton="Elige"
                />
            <numberPickerChoosed>
                <test expression="[NUMBERPICKER] == 5">
                    <goToSection section="sect5" />
                </test>
                <test expression="[NUMBERPICKER] != 5">
                    <goToSection section="sect70" />
                </test>
            </numberPickerChoosed>
        </section>

        <section id="sect223">
            <choiceState section="sect127" set="disabled" />
            <test expression="[KAILEVEL] >= 5">
                <choiceState section="sect127" set="enabled" />
                <choiceState section="sect204" set="disabled" />
            </test>
        </section>

        <section id="sect224">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case to="4">
                    <choiceState section="sect210" set="enabled" />
                </case>
                <case from="5">
                    <choiceState section="sect98" set="enabled" />
                </case>
            </randomTable>
            <test hasDiscipline="hntmstry">
                <randomTableIncrement increment="+2" />
            </test>
            <test expression="[KAILEVEL] >= 5">
                <randomTableIncrement increment="+1" />
            </test>
        </section>

        <section id="sect226">
            <endurance count="-3" />
        </section>

        <section id="sect228">
            <choiceState section="all" set="disabled" />
            <combat />
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect229">
            <endurance count="-5" />
        </section>

        <section id="sect232">
            <choiceState section="all" set="disabled" />
            <combat immuneTurns="1" />
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect233">
            <choiceState section="sect340" set="disabled" />
            <test hasDiscipline="alchemy">
                <choiceState section="sect340" set="enabled" />
                <choiceState section="sect138" set="disabled" />
            </test>
        </section>

        <section id="sect235">
            <choiceState section="sect340" set="disabled" />
            <test hasDiscipline="alchemy">
                <choiceState section="sect104" set="enabled" />
                <choiceState section="sect47" set="disabled" />
            </test>
        </section>

        <section id="sect236">
            <endurance count="+3" />
        </section>

        <section id="sect237">
            <endurance count="-3" />
        </section>

        <section id="sect238">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case to="4">
                    <choiceState section="sect139" set="enabled" />
                </case>
                <case from="5">
                    <choiceState section="sect3" set="enabled" />
                </case>
            </randomTable>
            <test currentWeaponSpecial="true">
                <randomTableIncrement increment="+2" />
            </test>
            <test currentWeapon="mace|warhammer|axe|broadsword">
                <randomTableIncrement increment="+1" />
            </test>
            <test currentWeapon="dagger|quarterstaff|shortsword">
                <randomTableIncrement increment="-1" />
            </test>
        </section>

        <section id="sect239">
            <choiceState section="sect109" set="disabled" />
            <test hasDiscipline="nexus">
                <choiceState section="sect109" set="enabled" />
                <choiceState section="sect292" set="disabled" />
            </test>
        </section>

        <section id="sect241">
            <pick class="arrow" count="-1" />
            <choiceState section="sect321" set="disabled" />
            <test canUseBow="true">
                <choiceState section="sect321" set="enabled" />
            </test>
        </section>

        <section id="sect242">
            <choiceState section="sect339" set="disabled" />
            <test hasDiscipline="alchemy">
                <choiceState section="sect339" set="enabled" />
            </test>
        </section>

        <section id="sect243">
            <endurance count="-5" />
        </section>

        <section id="sect244">
            <!-- TODO unable to use any potions prior to combat -->
            <choiceState section="all" set="disabled" />
            <combat combatSkillModifier="-10" />
            <afterCombatTurn turn="2">
                <combat combatSkillModifier="0" />
            </afterCombatTurn>
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect246">
            <endurance count="-3" />
        </section>

        <section id="sect247">      
            <object objectId="dagger" />
            <object objectId="sword" />
            <object objectId="emptybottle" />
            <object objectId="bow" />
            <object objectId="arrow" count="2" />
            <object objectId="ballofstring" />
            <object objectId="silverrod" />
            <pick class="money" count="40" currency="kika" />
        </section>

        <section id="sect248">
            <choiceState section="all" set="disabled" />
            <combat />
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect249">
            <choiceState section="all" set="disabled" />
            <combat />
            <test hasDiscipline="anmlmstr">
                <combat combatSkillModifier="+2" />
            </test>
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect250">
            <endurance count="-2" />
            <choiceState section="all" set="disabled" />
            <combat mindblastMultiplier="2" />
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect253">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case to="3">
                    <choiceState section="sect244" set="enabled" />
                </case>
                <case from="4" to="8">
                    <choiceState section="sect49" set="enabled" />
                </case>
                <case from="9">
                    <choiceState section="sect172" set="enabled" />
                </case>
            </randomTable>
            <test hasDiscipline="hntmstry">
                <randomTableIncrement increment="+3" />
            </test>
        </section>

        <section id="sect254">
            <choiceState section="all" set="disabled" />
            <combat />
            <afterCombats>
                <test not="true" expression="[COMBATSDURATION] >= 4">
                    <choiceState section="sect35" set="enabled" />
                </test>
                <test expression="[COMBATSDURATION] >= 4">
                    <choiceState section="sect160" set="enabled" />
                </test>
            </afterCombats>
        </section>

        <section id="sect261">
            <choiceState section="sect48" set="disabled" />
            <test hasDiscipline="pthmnshp">
                <choiceState section="sect48" set="enabled" />
                <choiceState section="sect335" set="disabled" />
            </test>
        </section>

        <section id="sect262">
            <choiceState section="sect168" set="disabled" />
            <test hasDiscipline="anmlmstr">
                <choiceState section="sect168" set="enabled" />
                <choiceState section="sect302" set="disabled" />
            </test>
        </section>

        <section id="sect268">
            <choiceState section="all" set="disabled" />
            <combat />
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect269">
            <endurance count="-6" />
        </section>

        <section id="sect270">
            <pick class="arrow" count="-1" />
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case to="5">
                    <choiceState section="sect183" set="enabled" />
                </case>
                <case from="6">
                    <choiceState section="sect201" set="enabled" />
                </case>
            </randomTable>
            <test hasWeaponskillWith="bow">
                <randomTableIncrement increment="+5" />
            </test>
        </section>

        <section id="sect272">
            <choiceState section="all" set="disabled" />
            <combat />
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect274">
            <choiceState section="sect143" set="disabled" />
            <choiceState section="sect338" set="disabled" />
            <choiceState section="sect265" set="disabled" />
            <test hasDiscipline="magi">
                <choiceState section="sect143" set="enabled" />
            </test>
            <test hasDiscipline="alchemy">
                <choiceState section="sect338" set="enabled" />
            </test>
            <test hasDiscipline="nexus">
                <choiceState section="sect265" set="enabled" />
            </test>
        </section>

        <section id="sect277">
            <meal />
        </section>

        <section id="sect278">
            <pick class="arrow" count="-1" />
        </section>

        <section id="sect279">
            <choiceState section="sect190" set="disabled" />
            <test hasDiscipline="kaisurge">
                <test expression="[KAILEVEL] >= 5">
                    <choiceState section="sect190" set="enabled" />
                    <choiceState section="sect44" set="disabled" />
                </test>
            </test>
        </section>

        <section id="sect280">
            <choiceState section="sect170" set="disabled" />
            <test canUseBow="true">
                <choiceState section="sect170" set="enabled" />
            </test>
        </section>

        <section id="sect281">
            <choiceState section="all" set="disabled" />
            <combat noMindblast="true" noPsiSurge="true" noKaiSurge="true" />
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect283">
            <choiceState section="all" set="disabled" />
            <combat />
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect285">
            <choiceState section="all" set="disabled" />
            <combat />
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect288">
            <death />
        </section>

        <section id="sect289">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case to="3">
                    <choiceState section="sect209" set="enabled" />
                </case>
                <case from="4" to="8">
                    <choiceState section="sect133" set="enabled" />
                </case>
                <case from="9">
                    <choiceState section="sect62" set="enabled" />
                </case>
            </randomTable>
            <test hasDiscipline="wpnmstry">
                <test expression="[KAILEVEL] >= 6">
                    <randomTableIncrement increment="+3" />
                </test>
            </test>
        </section>

        <section id="sect290">
            <choiceState section="sect207" set="disabled" />
            <test hasDiscipline="alchemy">
                <choiceState section="sect207" set="enabled" />
            </test>
        </section>

        <section id="sect291">
            <choiceState section="sect167" set="disabled" />
            <test hasDiscipline="alchemy">
                <test expression="[KAILEVEL] >= 6">
                    <choiceState section="sect167" set="enabled" />
                    <choiceState section="sect334" set="disabled" />
                </test>
            </test>
        </section>

        <section id="sect292">
            <choiceState section="sect212" set="disabled" />
            <test hasObject="oedeherb|oedejar|sabitojar">
                <choiceState section="sect212" set="enabled" />
                <choiceState section="sect233" set="disabled" />
            </test>
        </section>

        <section id="sect295">
            <choiceState section="sect232" set="disabled" />
            <test hasDiscipline="alchemy">
                <choiceState section="sect232" set="enabled" />
                <choiceState section="sect198" set="disabled" />
            </test>
        </section>

        <section id="sect297">
            <choiceState section="all" set="disabled" />
            <combat noMindblast="true" noPsiSurge="true" kaiSurgeBonus="1" />
            <test hasDiscipline="alchemy">
                <test expression="[KAILEVEL] >= 5">
                    <combat noMindblast="true" noPsiSurge="true" kaiSurgeBonus="1" combatSkillModifier="+5" />
                    <endurance count="+5" noToast="true" permanent="true" />
                </test>
            </test>
            <afterCombats>
                <test hasDiscipline="alchemy">
                    <test expression="[KAILEVEL] >= 5">
                        <test expression="[ENDURANCE] &lt;= 5">
                            <endurance count="6 - [ENDURANCE]" noToast="true" />
                        </test>
                        <endurance count="-5" noToast="true" permanent="true" />
                    </test>
                </test>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect299">  
            <object objectId="bow" />
            <object objectId="arrow" count="2" />
            <object objectId="ballofstring" />
            <object objectId="dagger" />
            <object objectId="sword" />
            <object objectId="emptybottle" />
            <pick class="money" count="40" currency="kika" />
            <object objectId="silverrod" />
        </section>

        <section id="sect300">
            <choiceState section="sect173" set="disabled" />
            <test hasDiscipline="pthmnshp">
                <choiceState section="sect173" set="enabled" />
                <choiceState section="sect320" set="disabled" />
            </test>
        </section>

        <section id="sect301">
        </section>

        <section id="sect302">
        </section>

        <section id="sect303">
        </section>

        <section id="sect304">
            <drop objectId="greenkey" />
        </section>

        <section id="sect305">
        </section>

        <section id="sect306">
        </section>

        <section id="sect307">
        </section>

        <section id="sect308">
        </section>

        <section id="sect309">
        </section>

        <section id="sect310">
        </section>

        <section id="sect311">
        </section>

        <section id="sect312">
        </section>

        <section id="sect313">
        </section>

        <section id="sect314">
        </section>

        <section id="sect315">
        </section>

        <section id="sect316">
        </section>

        <section id="sect317">
        </section>

        <section id="sect318">
        </section>

        <section id="sect319">
        </section>

        <section id="sect320">
        </section>

        <section id="sect321">
            <pick class="arrow" count="-1" />
        </section>

        <section id="sect322">
        </section>

        <section id="sect323">
        </section>

        <section id="sect324">
        </section>

        <section id="sect325">
        </section>

        <section id="sect326">
        </section>

        <section id="sect327">
        </section>

        <section id="sect328">
        </section>

        <section id="sect329">
        </section>

        <section id="sect330">
        </section>

        <section id="sect331">
        </section>

        <section id="sect332">
        </section>

        <section id="sect333">
        </section>

        <section id="sect334">
        </section>

        <section id="sect335">
        </section>

        <section id="sect336">
        </section>

        <section id="sect337">
        </section>

        <section id="sect338">
        </section>

        <section id="sect339">
        </section>

        <section id="sect340">
        </section>

        <section id="sect341">
        </section>

        <section id="sect342">
        </section>

        <section id="sect343">
        </section>

        <section id="sect344">
        </section>

        <section id="sect345">
        </section>

        <section id="sect346">
        </section>

        <section id="sect347">
        </section>

        <section id="sect348">
        </section>

        <section id="sect349">
        </section>

        <section id="sect350">
        </section>

    </sections>

</mechanics>
