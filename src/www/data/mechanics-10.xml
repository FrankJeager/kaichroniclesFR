<?xml version="1.0" encoding="utf-8"?>

<mechanics book="10">

    <!-- LIST OF TRANSLATED IMAGES -->
    <translated-images>
        <image>weapons.png</image>
    </translated-images>

    <!-- GAME RULES -->
    <sections>

        <section id="tssf">
            <!-- Restore the endurace to the maximum -->
            <endurance count="+[MAXENDURANCE]" />
            <!-- Drop the previous books map -->
            <drop objectId="map" />
        </section>

        <section id="gamerulz">
            <!-- Select the player skills (weapons skill and endurance) UI -->
            <setSkills />
        </section>

        <section id="discplnz">
            <!-- Select the Kai disciplines UI -->
            <setDisciplines />
        </section>
        
        <section id="equipmnt" pickMaximum="5">
            <!-- Do not pick 2 maps! -->
            <test not="true" hasObject="map" >
                <pick objectId="map" />
            </test>
            <test not="true" hasObject="backpack" >
                <pick objectId="backpack" />
            </test>

            <randomTable>
                <pick class="money" count="[RANDOM] + 10" />
            </randomTable>

            <!-- Kai monastery safekeeping -->
            <kaiMonasteryStorage />

            <object objectId="sword" />
            <object objectId="bow" />
            <object objectId="quiver" count="6" />
            <object objectId="rope" />
            <object objectId="laumspurpotion4" />
            <object objectId="lantern" />
            <object objectId="mace" />
            <object objectId="meal" index="0" />
            <object objectId="meal" index="1" />
            <object objectId="meal" index="2" />
            <object objectId="dagger" />

            <chooseEquipment 
                en-text="Click on the Random Table link to get money before continue" 
                es-text="Haz click en el link de la Tabla de la Suerte para obtener dinero antes de continuar"
            />

            <message 
                en-text="You may take up to five of the following (all meals count as one object):" 
                es-text="Puedes elegir hasta cinco de los objetos (todas las comidas cuentan como un objeto):" 
            />

        </section>

        <section id="sect2">
            <choiceState section="all" set="disabled" />
            <combat />
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect4">
            <choiceState section="sect324" set="disabled" />
            <choiceState section="sect241" set="disabled" />

            <test hasDiscipline="hntmstry">
                <test expression="[KAILEVEL] >= 6">
                    <choiceState section="sect324" set="enabled" />
                    <choiceState section="sect108" set="disabled" />
                </test>
            </test>

            <test hasDiscipline="pthmnshp">
                <test expression="[KAILEVEL] >= 5">
                    <choiceState section="sect241" set="enabled" />
                    <choiceState section="sect108" set="disabled" />
                </test>
            </test>
        </section>

        <section id="sect6">
            <!--
                TODO: If you have ever visited the land of Talestria...
                Do the same here than in book 3 / sect268 (a TODO too)
            -->
        </section>

        <section id="sect7">
            <test hasCircle="circleSpirit">
                <choiceState section="sect111" set="disabled" />
                <choiceState section="sect287" set="disabled" />
                <choiceState section="sect152" set="disabled" />
            </test>
            <test not="true" hasCircle="circleSpirit">
                <choiceState section="sect46" set="disabled" />
            </test>
        </section>

        <section id="sect8">
            <test canUseBow="false">
                <!-- TODO: sect131, drop arrow -->
                <choiceState section="sect131" set="disabled" />
            </test>
        </section>

        <section id="sect9">
            <test not="true" hasObject="sommerswerd">
                <choiceState section="sect113" set="disabled" />
            </test>
            <test hasObject="sommerswerd">
                <choiceState section="sect126" set="disabled" />
            </test>
        </section>

        <section id="sect10">
            <death />
        </section>

        <section id="sect11">
            <!-- TODO: Drop weapon. Foot page is not clear, and there are differences between language.
                 Let the player choose -->
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case from="0" to="3">
                    <choiceState section="sect310" set="enabled" />
                </case>
                <case from="4" to="99">
                    <choiceState section="sect229" set="enabled" />
                </case>
            </randomTable>
            <test hasDiscipline="hntmstry">
                <randomTableIncrement increment="+2" />
            </test>
        </section>

        <section id="sect15">
            <endurance count="-1" />
        </section>

        <section id="sect16">
            <choiceState section="all" set="disabled" />
            <randomTable>
                <case from="0" to="2">
                    <choiceState section="sect264" set="enabled" />
                </case>
                <case from="3" to="5">
                    <choiceState section="sect121" set="enabled" />
                </case>
                <case from="6" to="99">
                    <choiceState section="sect319" set="enabled" />
                </case>
            </randomTable>
            <test hasDiscipline="hntmstry">
                <randomTableIncrement increment="+3" />
            </test>
        </section>

        <section id="sect17">
            <death />
        </section>

        <section id="sect18">
            <choiceState section="sect83" set="disabled" />
            <choiceState section="sect255" set="disabled" />

            <test hasDiscipline="nexus">
                <test expression="[KAILEVEL] >= 4">
                    <choiceState section="sect83" set="enabled" />
                    <choiceState section="sect167" set="disabled" />
                </test>
            </test>

            <test hasDiscipline="curing">
                <choiceState section="sect255" set="enabled" />
                <choiceState section="sect167" set="disabled" />
            </test>
        </section>

        <section id="sect19">
            <choiceState section="sect93" set="disabled" />

            <test hasDiscipline="psiscrn">
                <test expression="[KAILEVEL] >= 7">
                    <choiceState section="sect93" set="enabled" />
                    <choiceState section="sect228" set="disabled" />
                </test>
            </test>
        </section>

        <section id="sect22">
            <test canUseBow="false">
                <!-- TODO: sect293, drop arrow -->
                <choiceState section="sect293" set="disabled" />
            </test>
        </section>

        <section id="sect23">
            <choiceState section="all" set="disabled" />
            <combat />
            <afterCombats>
                <choiceState section="all" set="enabled" />
            </afterCombats>
        </section>

        <section id="sect24">
            <death />
        </section>

        <!-- Up to sect25 -->
        
    </sections>

</mechanics>
